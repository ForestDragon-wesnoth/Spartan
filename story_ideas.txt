------------------------------------------------------------------------------------
WARNING: MASSIVE SPOILERS AHEAD
------------------------------------------------------------------------------------
































------------------------------------------------------------------------------------
YOU HAVE BEEN WARNED
------------------------------------------------------------------------------------

Chronological order of events before the start of the campaign:
1 - Mallion created Galatea
2 - Mallion accidentally freed the merchant with his experiments with portals (Merchant does not yet have a physical body in Irdya)
3 - the merchant tries to learn the method of creating portals from Mallion, but he refuses to give them to him
4 - the merchant leaves, visits the local lizards, manages to brainwash them (including Xerxix and Anexir). He then takes over Xerxix's body and uses it as his own, while gives Anexir a bit more autonomy
5 - The Merchant applies dark magic on the whole cave that creates Orbs of Insight from death. He starts the time loop around the cave, then uses his mind-control powers to force some factions to fight eachother, and once the carnage ends he rewinds time to start again, 
the merchant set up a farm of balls with time cycles and without a hoplite
6 - Mallion was able to outwit the rewind of time, retained his memory and realized who the merchant really is. began to use these cycles to prepare all sorts of magic that can kill/seal the merchant (maybe something for Galatea), and leave clues about the time loop/Merchant in case he fails (something that the Hoplite will use later)
7 - Mallion tries to kill the merchant, but he kills him first (maybe the Merchant also rewinds time so that Mallion cannot warn Galatea about his death)
8 - the merchant shifts the time cycle so that Mallion remains dead
9 - the merchant wants to get Mallion's secrets about portals to other worlds
10 - the merchant lies to Galatea that Mallion was kidnapped by someone from another world, and offers her a deal - he helps her "free" Mallion, and in return she teaches him about portals so that he can supposedly help her
11 - Galatea signs the Pact of Overlord and teaches the merchant about portals
12 - the merchant returns to Mallion's corpse, uses black magic to revive his heart to use as bait, because Galatea is able to magically sense where Mallion's heart is
13 - the merchant goes to the first randomly world he comes across, which turns out to be the world the hoplite lives in, merchant places the heart in Sparta
14 - the merchant returns to Irdya, tells Galatea that "the evil Spartans kidnapped Mallion"
15 - Galatea, with her power, assembles an army by mind-controls most of the locals and summoning some allies from other worlds via her portals (including Arachne/Minotaur from hoplite's world)
16 - attack on Sparta, the hoplite ends up in Irdia, etc. in general, everything is like in the prologue
17 - seeing the hoplite's potential as a way to farm kills for orbs, the merchant shifts the beginning of the time cycle to the moment when the hoplite ended up in Irdia
18 - now both the hoplite and Galatea become pawns in the Merchants's plan to gather Orbs of Insight while he sits back and watches, and trades for orbs with the hoplite


Story concepts/notes/plans for when writing/designing the true ending:

Time Loop:
-campaign being replayed multiple times is actually canon. the cave is stuck in an endless time loop, that resets when the Spartan either dies or defeats the "final boss"
-Most characters do not remember what happens in previous playthroughs, however, The Merchant does
-The Merchant is the one responsible for starting the time loop in the cave

Galatea:
-she is some sort of living statue made out of marble, made alive by magic in Irdya
-her creator, Mallion (more in detail below) is able to travel between worlds
-she is also able to travel between worlds, likely due to being taught by Mallion
-possibly has some kind of powerful inherent magic inside her (maybe made out of special magical stone, or has a magical heart)?
-she tries to find her creator, then the Merchant tricks her into signing the Pact of Overlord (like the one available to the hoplite)
 -she becomes very powerful and can mind-control whole armies, but as a side-effect becomes the Merchant's pawn (but still keeps some autonomy and pursues after Mallion regardless of the methods)
 -the price could be that she taught the Merchant mallion's portal spells?
 -a twist could be that the merchant has secretly killed her creator some time before the events of the campaign
  -then the Merchant takes Mallion's heart, keeps the heart alive with some dark magic and uses it as bait to make Galatea attack Sparta
-idea:
 -if the Spartan goes deep enough in the caves, he may run into the Main Antagonist, and convince the antagonist about the time loop
  -after that, Main Antagonist loses much of his/her powers, but ends up switching sides and joins the Spartan as a companion
   -enemies in the cave become mind-controlled directly by the Merchant instead
   -motivation for switching sides is that Merchant secretly killed her creator some time before the story begins


Mallion:
-creator of Galatea
-is an elf, maybe a male equivalent of a Sylph
-the underworld portal in depth 30 (and some randomly-spawning ones after that) is most likely his creation, though some are probably made by the Merchant with the information he took from Mallion
-maybe his portal experiments are what unleashed the Merchant into Irdya after being sealed in some other world for millenia

Xerxix:
-originally a normal saurian shaman


Anexir:


The Merchant:

connection with Xerxix - Xerxix used to be an independent saurian shaman, but somehow got involved with the Merchant and become fully possessed by him
the merchant players speak to is actually Xerxix's body under the hood, puppeteered by the Merchant
the Merchant probably has no "true" physical form


-the merchant is secretly the true final boss at depth 100, has extremely strong stats/abilities/ranged attacks, is multiphase, similarly to the normal final boss fight
-he is actually responsible for the time loop
-Orbs of Insight are harvested via kills, concentrating the dead unit's power (plus the merchant's magic spell on the cave itself?), so the purpose of the time loop is to have the Spartan kill enemies/bosses over and over for the Merchant, so he doesn't need to put in the effort himself
 -originally he just pitted the cave's factions against eachother, but then decided having the hoplite fight them (and galatea) would be more entertaining
-acts friendly with the Spartan (for some time), sells various things in return for orbs
-is some kind of eldritch horror previously sealed in another world but accidentally released by Mallion's portal experiments
-does not have a real physical body, he instead fully possessed Xerxix (and the cloaked merchant the hoplite talks to has Xerxix's body underneath)
 -to get the point across, in the final fight he can take off the hood for a short while, revealing Xerxix underneath, then put the hood back on (and then again switch to the Xerxix sprite in one of the phases)
-dialog from previous merchant lines that could be later moved to the end, as part of the big reveal:
 -UPD: probably doesn't fit the intended mood of the final boss fight, so might scrap it instead or heavily rewrite it
            [message]
                speaker=merchant
                message=_"Do you perhaps notice how, when you enter the cave, sometimes <span color='#a456ff'>Orbs of Insight</span> just appear out of thin air into your pocket?"
            [/message]
            [message]
                id=Hoplite,Hoplite2
                message=_"Now that you mention it, I did notice that..."
            [/message]
            [message]
                speaker=merchant
                message=_"Time is not the simple one-directional flow many think it is, certainly not in this place."
            [/message]
            {IF_VAR spartan_orbshop_data1.visited_across_playthroughs greater_than 5 (
            [then]
            [message]
                id=Hoplite
                message=_"I wonder... how many times have we 'met for the first time'?"
            [/message]
            [message]
                speaker=merchant
                message=_"It is precisely $spartan_orbshop_data1.visited_across_playthroughs| times, <span size='small'><i>at least in this subcategory of timelines</i></span>."
            [/message]
            #ifdef MULTIPLAYER
            [message]
                id=Hoplite2
                message=_"And what about me?"
            [/message]
            [message]
                speaker=merchant
                message=_"$spartan_orbshop_data2.visited_across_playthroughs| times in your case."
            [/message]
            #endif
            [message]
                id=Hoplite
                message=_"Wow... that is quite something... and how many orbs have I spent in your shop total?"
            [/message]
            [message]
                speaker=merchant
                message=_"It is exactly $spartan_orbshop_data1.orbs_spent| orbs."
            [/message]
            #ifdef MULTIPLAYER
            [message]
                id=Hoplite2
                message=_"And how much did I spend?"
            [/message]
            [message]
                speaker=merchant
                message=_"$spartan_orbshop_data2.orbs_spent| orbs in your case."
            [/message]
            #endif

            [if]
            [have_unit]
                id=Algadur
            [/have_unit]
            [then]
            [message]
                speaker=Algadur
                message=_"I must admit, I'm... confused about tis' whole thing."
            [/message]
            [message]
                id=Hoplite,Hoplite2
                message=_"Can't say I fully understand what is happening either, but it seems I already met this 'merchant' before, in a past life of sorts."
            [/message]
            [/then]
            [/if]

            #scrapped merchant line, maybe might reuse later:

            message=_"It's hard to explain to most mortals, but let's just say we both did, and we did not..."



True Ending steps approximate plan:
potential required steps to get true ending (haven't fully decided on the order yet though):
-sparing archmage Arcanus's life with a healing potion while he is heavily wounded
 -should definitely be a requirement on final playthrough at least, but some early steps should require it too
 -maybe if archmage is not spared, Merchant convinces Elizabeth to take revenge on Odysseus during a true ending step, preventing the true ending
-finding Mallion's workshop, maybe with a potion recipe and some hints about the time cycle, Galatea and the Merchant
 -workshop should be somewhere after depth 40
-using Orbs of Insight (spending at least 10 or even more) to brew a special potion (maybe name it something like Chronos Potion)
 -the potion allows the main character to "remember" things from previous playthroughs
  -will require a lot of adjustments to dialog
   -but to make this rewrite a bit easier, the main character could decide early on to pretend like he does not remember past events unless necessary, to avoid blowing his cover and being noticed by whoever is the true villain (aka the Merchant)
    -when talking to the Merchant in this mode, the Spartan will be suspicious that Merchant also has memory between cycles, and intentionally plays dumb (pretending not to understand that the merchant also remembers past playthroughs)
 -UPD: new idea: maybe instead of "item that lets you keep memories", make an "item that makes the player character remember everything from past time loops"
  -this way it 1. reduces how much dialog I have to add, and 2. players can still get the normal ending this way even after meeting true ending requirements
-idea: besides the memory potion, I can also have a few other things that can carry over between playthroughs
 -for example, a orb-of-insight-enchanted key, so players can reach an true ending step area on a new playthrough, but don't gain the huge story advantage of the memory potion
  -maybe make it so that preserving those items requires doing a full playthrough to avoid savescumming abuse for the true ending?
-having both Algadur and Elizabeth could be a requirement (some steps could require one of them)
 -maybe Algadur allows the player to enter a dwarven city that is hidden from Galatea's forces
  -this area could use the City_of_Dwarves.ogg music
-discovering that Galatea is being manipulated by the Merchant
-while under the effects of the potion, and after completing some other steps, in the "final boss fight", after completing other steps, convince Galatea that she has been tricked by the Merchant
 -might require defeating her normally again anyway, so that her cursed armor is broken (and talking to her in her defeated form)
 -UPD: maybe the player will need some kind of magic item to dispel the Pact of Overlord from Galatea, since the pact allows the merchant to possess Galatea if he needs to
  -maybe that item could be something made by Mallion before?
 -she switched sides and becomes a companion, but now much weaker since she no longer has powers granted by the Merchant
   -she could probably still keep some abilities/attacks from her boss fight but weaker (and maybe a menu to toggle between ranged attack types)
    -for example she could definitely still have a charged slash as one of her options
    -she can also keep some knockback resistance (maybe 1 instead of 2)
  -enemies now serve the Merchant directly instead
  -Merchant shop levels no longer have the Merchant in them, either
   a) shops now spawn enemies
   b) shops are just eerily empty
-with Galatea's help, unlock access to some very late-game depths, maybe post-depth-80 or post-depth-90 or so
 -that area will have the toughest new lategame biome(s), with the Merchant's strongest minions there
-epic boss fight against the Merchant himself
 -with the merchant killed or banished from Irdya, the time loop ends and the campaign ends for real
 -Galatea maybe also finds Mallion's heart. I could maybe add her sorta reviving him by putting his heart into a statue, as a happy end
NOTE: unlocking the true ending should require multiple playthroughs, maybe at least 3

IMPORTANT NOTE 2: if the player took the Pact of Overlord (aka what Galatea took herself), it should be impossible to get the true ending in that specific playthrough (since the player character becomes a puppet of the Merchant)



true ending music choice ideas:


dwarf city: City_of_Dwarves.ogg

merchant boss intro (or maybe one of the boss fight phases): march of the divine


during the Merchant intro, when the hoplite/Galatea/other companions do some epic speech about stopping the Merchant, before the fight itself: fragments_of_time_cut.ogg


merchant boss fight music: in the land of madness

maybe find somewhere to use sing.ogg, probably something Galatea-related, maybe when the hoplite saves her from being finished off by Xerxix, and she sides with the hoplite after he tells her the truth about the Merchant