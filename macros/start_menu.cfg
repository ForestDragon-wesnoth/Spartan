#textdomain wesnoth-Hoplite

#define SPARTAN_DEPTH_OPTIONS

#        {IF_VAR hoplite_depth11_unlocked1 equals yes (
#            [then]
                [message]
                    speaker=narrator
#                    caption=_ "Checkpoints:"
                    message=_"Choose where to start the game from:"
#ifdef MULTIPLAYER
                    side_for=1
#endif
                    [option]
                        image="scenery/temple1.png"
                        description=_"Prologue/Tutorial (then start at Depth 1 after tutorial ends)"
                        [show_if]
                            #for now, the prologue is only available when both players use the default Hoplite class, since the tutorial is not designed for other classes at the moment
                            {VARIABLE_CONDITIONAL spartan_selected_character1 equals hoplite}
#ifdef MULTIPLAYER
                            {VARIABLE_CONDITIONAL spartan_selected_character2 equals hoplite}
#endif
                        [/show_if]
                        [command]
                            {VARIABLE hoplite_tutorial yes}
                            {VARIABLE hoplite_tutorialdepth 0}
                            {VARIABLE hoplite_depth 0}
                            {VARIABLE depthdescent_nofade yes}
                            [fire_event]
                                id=hoplite_depthdescent
                            [/fire_event]
                            {SPARTAN_UNHIDE_SCREEN}
                        [/command]
                    [/option]
                    [option]
                        image="scenery/dwarven-doors-closed.png"
                        description=_"Depth 1 (no upgrades)"
                        [command]
                            {SPARTAN_UNHIDE_SCREEN}
                        [/command]
                    [/option]
                    [option]
                        image="scenery/trapdoor-open.png"
                        description=_"Depth 11 (10 upgrades)"
                        [show_if]
                        [variable]
                          name=hoplite_depth11_unlocked1
                          equals=yes
                        [/variable]
                        #ironman mode disables starting after depth 1
                        [and]
                            {VARIABLE_CONDITIONAL spartan_ironman not_equals yes}                            
                        [/and]
                        [/show_if]
                        [command]
                            {VARIABLE hoplite_debugmenu yes}
                            {SPARTAN_BOSSES_BEATEN_BASED_ON_START 11}
                            {VARIABLE dungeon_seen yes}
                            {VARIABLE waterdepth_seen yes}
#                           {VARIABLE forge_delay 0}#to prevent a forge appearing on the first depth            

                            [if]
                                [have_unit]
                                    id=Hoplite2
                                [/have_unit]
                                [then]
                                    {VARIABLE hoplite_upgradesleft1 10}
                                    {VARIABLE hoplite_upgradesleft2 10}
                                [/then]
                                [else]
                                    {VARIABLE hoplite_upgradesleft 10}
                                [/else]
                            [/if]
                            [fire_event]
                                id=forge_dialog
                            [/fire_event]

#                            {REPEAT 10 (
#                            )}
                            {CLEAR_VARIABLE hoplite_debugmenu}
                            {CLEAR_VARIABLE hoplite_upgrade}
                            {CLEAR_VARIABLE hoplite_upgradesleft}
                            {CLEAR_VARIABLE hoplite_upgradesleft1}
                            {CLEAR_VARIABLE hoplite_upgradesleft2}
                            {VARIABLE hoplite_depth 10}
                            {VARIABLE depthdescent_nofade yes}
                            [fire_event]
                                id=hoplite_depthdescent
                            [/fire_event]
                            {SPARTAN_UNHIDE_SCREEN}
                        [/command]
                    [/option]
                    [option]
                        image="scenery/trapdoor-open.png"
                        description=_"Depth 21 (20 upgrades, artifact gear, algadur)"
                        [show_if]
                        [variable]
                          name=hoplite_depth21_unlocked1
                          equals=yes
                        [/variable]
                        #ironman mode disables starting after depth 1
                        [and]
                            {VARIABLE_CONDITIONAL spartan_ironman not_equals yes}                            
                        [/and]
                        [/show_if]
                        [command]
            {VARIABLE algadurmet yes}
            {VARIABLE algadurlinestart yes}
            {SPARTAN_PLACE_ALGADUR 6 9}
                            {HOPLITE_ARTIFACTS}
                            {VARIABLE hoplite_debugmenu yes}
                            {SPARTAN_BOSSES_BEATEN_BASED_ON_START 21}
                            {VARIABLE dungeon_seen yes}
                            {VARIABLE waterdepth_seen yes}
                            {VARIABLE forge_delay 0}#to prevent a forge appearing on the first depth            

                            [if]
                                [have_unit]
                                    id=Hoplite2
                                [/have_unit]
                                [then]
                                    {VARIABLE hoplite_upgradesleft1 20}
                                    {VARIABLE hoplite_upgradesleft2 20}
                                [/then]
                                [else]
                                    {VARIABLE hoplite_upgradesleft 20}
                                [/else]
                            [/if]
                            [fire_event]
                                id=forge_dialog
                            [/fire_event]
#                            {REPEAT 20 (
#                            )}
                            {CLEAR_VARIABLE hoplite_debugmenu}
                            {CLEAR_VARIABLE hoplite_upgrade}
                            {CLEAR_VARIABLE hoplite_upgradesleft}
                            {CLEAR_VARIABLE hoplite_upgradesleft1}
                            {CLEAR_VARIABLE hoplite_upgradesleft2}
                            {VARIABLE hoplite_depth 20}
                            {VARIABLE depthdescent_nofade yes}
                            [fire_event]
                                id=hoplite_depthdescent
                            [/fire_event]
                            {SPARTAN_UNHIDE_SCREEN}
                        [/command]
                    [/option]
                    [option]
                        image="scenery/summoning-center.png~GS()~CS(150,0,180)"
                        description=_"Underworld (30 upgrades, artifact gear, algadur)"
                        [show_if]
                        [variable]
                          name=hoplite_depth0_unlocked1
                          equals=yes
                        [/variable]
                        #ironman mode disables starting after depth 1
                        [and]
                            {VARIABLE_CONDITIONAL spartan_ironman not_equals yes}                            
                        [/and]
                        [/show_if]
                        [command]
            {VARIABLE algadurmet yes}
            {VARIABLE algadurlinestart yes}
            {SPARTAN_PLACE_ALGADUR 6 9}
                            {HOPLITE_ARTIFACTS}
                            {VARIABLE hoplite_debugmenu yes}
                            {SPARTAN_BOSSES_BEATEN_BASED_ON_START -1}
                            {VARIABLE dungeon_seen yes}
                            {VARIABLE waterdepth_seen yes}
                            {VARIABLE forge_delay 0}#to prevent a forge appearing on the first depth            

                            [if]
                                [have_unit]
                                    id=Hoplite2
                                [/have_unit]
                                [then]
                                    {VARIABLE hoplite_upgradesleft1 30}
                                    {VARIABLE hoplite_upgradesleft2 30}
                                [/then]
                                [else]
                                    {VARIABLE hoplite_upgradesleft 30}
                                [/else]
                            [/if]
                            [fire_event]
                                id=forge_dialog
                            [/fire_event]
#                            {REPEAT 12 (
#                            )}
                            {CLEAR_VARIABLE hoplite_debugmenu}
                            {CLEAR_VARIABLE hoplite_upgrade}
                            {CLEAR_VARIABLE hoplite_upgradesleft}
                            {CLEAR_VARIABLE hoplite_upgradesleft1}
                            {CLEAR_VARIABLE hoplite_upgradesleft2}
           [set_variable]
             name=darkportal_entrydepth
             value=30
           [/set_variable]
           {COLOR_ADJUST 80 80 80}
           {COLOR_ADJUST 150 150 150}
       [sound]
         name=lightning.ogg
       [/sound]
      {IF_VAR portal_entrydepth less_than 0 (
          [then]
           {VARIABLE hoplite_depth $portal_entrydepth}
      [/then]
      [else]
       {RANDOM -1..-7}
           {VARIABLE hoplite_depth $random}
          [/else])}
          {VARIABLE darkportal_active yes}
          {VARIABLE hoplite_stairway no}
          [sound]
             name={SOUND_LIST:LICH_HIT}
      [/sound]
       {COLOR_ADJUST -512 -512 -512}
       [delay]
          time=1000
       [/delay]
        {VARIABLE depthdescent_nofade yes}
        [fire_event]
            id=hoplite_depthdescent
        [/fire_event]
        {SPARTAN_UNHIDE_SCREEN}
        {CLEAR_VARIABLE random}
        {VARIABLE hoplite_usedportal yes}
                        [/command]
                    [/option]
                    [option]
                        image="scenery/trapdoor-open.png"
                        description=_"Depth 31 (35 upgrades, artifact gear, algadur and elizabeth)"
                        [show_if]
                        [variable]
                          name=hoplite_depth31_unlocked1
                          equals=yes
                        [/variable]
                        #ironman mode disables starting after depth 1
                        [and]
                            {VARIABLE_CONDITIONAL spartan_ironman not_equals yes}                            
                        [/and]
                        [/show_if]
                        [command]
            {VARIABLE algadurmet yes}
            {VARIABLE algadurlinestart yes}
            {SPARTAN_PLACE_ALGADUR 6 9}
            {VARIABLE elizabethmet yes}
            {SPARTAN_PLACE_ELIZABETH 6 9}
        {UNIT $hoplite_allyside (Hoplite_Fireguardian) 5 9 (
        placement=map
            passable=yes
            )}
        {UNIT $hoplite_allyside (Hoplite_Fireguardian) 7 9 (
        placement=map
            passable=yes
            )}
#ifdef MULTIPLAYER      
            [object]
        silent=yes
        duration=forever
        [filter]
          id=Elizabeth
        [/filter]
        [effect]
          apply_to=attack
          range=melee
          increase_damage=2#to two-shot normal enemies in MP
            [/effect]
        [effect]
          apply_to=attack
          range=ranged
          increase_damage=3#to one-shot normal enemies in MP
            [/effect]
            [/object]
#endif
                            {HOPLITE_ARTIFACTS}
                            {VARIABLE hoplite_debugmenu yes}
                            {SPARTAN_BOSSES_BEATEN_BASED_ON_START 31}
                            {VARIABLE dungeon_seen yes}
                            {VARIABLE waterdepth_seen yes}
                            {VARIABLE spiderqueen_seen yes}
                            {VARIABLE forge_delay 0}#to prevent a forge appearing on the first depth

                            [if]
                                [have_unit]
                                    id=Hoplite2
                                [/have_unit]
                                [then]
                                    {VARIABLE hoplite_upgradesleft1 35}
                                    {VARIABLE hoplite_upgradesleft2 35}
                                [/then]
                                [else]
                                    {VARIABLE hoplite_upgradesleft 35}
                                [/else]
                            [/if]
                            [fire_event]
                                id=forge_dialog
                            [/fire_event]
#                            {REPEAT 23 (
#                            )}
                            {CLEAR_VARIABLE hoplite_debugmenu}
                            {CLEAR_VARIABLE hoplite_upgrade}
                            {CLEAR_VARIABLE hoplite_upgradesleft}
                            {CLEAR_VARIABLE hoplite_upgradesleft1}
                            {CLEAR_VARIABLE hoplite_upgradesleft2}
                            {VARIABLE hoplite_depth 30}
                            {VARIABLE depthdescent_nofade yes}
                            [fire_event]
                                id=hoplite_depthdescent
                            [/fire_event]
                            {SPARTAN_UNHIDE_SCREEN}
                        [/command]
                    [/option]
                    [option]
                        image="terrain/stairs-spiral.png"
                        description=_"Depth 41 (40 upgrades, artifact gear, prometheus' heart (+50 max energy), algadur and elizabeth)"
                        [show_if]
                        [variable]
                          name=hoplite_depth41_unlocked1
                          equals=yes
                        [/variable]
                        #ironman mode disables starting after depth 1
                        [and]
                            {VARIABLE_CONDITIONAL spartan_ironman not_equals yes}                            
                        [/and]
                        [/show_if]
                        [command]
                        {HOPLITE_APPLY_PROMETHEUS_HEART}
            {VARIABLE algadurmet yes}
            {VARIABLE algadurlinestart yes}
            {SPARTAN_PLACE_ALGADUR 6 9}
            {VARIABLE elizabethmet yes}
            {SPARTAN_PLACE_ELIZABETH 6 9}
                            {HOPLITE_ARTIFACTS}
                            {VARIABLE hoplite_debugmenu yes}
                            {SPARTAN_BOSSES_BEATEN_BASED_ON_START 41}
                            {VARIABLE dungeon_seen yes}
                            {VARIABLE waterdepth_seen yes}
                            {VARIABLE spiderqueen_seen yes}
                            {VARIABLE forge_delay 0}#to prevent a forge appearing on the first depth            

                            [if]
                                [have_unit]
                                    id=Hoplite2
                                [/have_unit]
                                [then]
                                    {VARIABLE hoplite_upgradesleft1 40}
                                    {VARIABLE hoplite_upgradesleft2 40}
                                [/then]
                                [else]
                                    {VARIABLE hoplite_upgradesleft 40}
                                [/else]
                            [/if]
                            [fire_event]
                                id=forge_dialog
                            [/fire_event]
#                            {REPEAT 23 (
#                            )}
                            {CLEAR_VARIABLE hoplite_debugmenu}
                            {CLEAR_VARIABLE hoplite_upgrade}
                            {CLEAR_VARIABLE hoplite_upgradesleft}
                            {CLEAR_VARIABLE hoplite_upgradesleft1}
                            {CLEAR_VARIABLE hoplite_upgradesleft2}
                            {VARIABLE hoplite_depth 40}
                            {VARIABLE depthdescent_nofade yes}
                            [fire_event]
                                id=hoplite_depthdescent
                            [/fire_event]
                            {SPARTAN_UNHIDE_SCREEN}
                        [/command]
                    [/option]
                    [option]
                        image="units/human-magi/elder-mage-ranged3.png~RC(magenta>red)"
                        description=_"Sandbox mode (choose the starting depth/upgrades, debug menu is available, but achievements can't be completed in this mode. The companions can be spawned with the spartan debug menu)"
                        [show_if]
                        [variable]
                          name=hoplite_depth99_unlocked1
                          equals=yes
                        [/variable]
                        #ironman mode disables sandbox mode
                        [and]
                            {VARIABLE_CONDITIONAL spartan_ironman not_equals yes}                            
                        [/and]
                        [/show_if]
                        [command]
                        [message]
                            speaker=narrator
                            message=_"Which depth to start at?"
            
                           [text_input]
                              variable=depth
                           [/text_input]
                        [/message]
                        [message]
                            speaker=narrator
                            message=_"How many upgrades to start with?"
            
                           [text_input]
                              variable=hoplite_startupgrades
                           [/text_input]
                        [/message]
                            {VARIABLE hoplite_debug yes}
                            {VARIABLE hoplite_noachieve yes}
                            {VARIABLE hoplite_debugmenu yes}
                            {SPARTAN_BOSSES_BEATEN_BASED_ON_START $depth}
                {IF_VAR depth greater_than 15 (
                [or]
                {VARIABLE_CONDITIONAL depth less_than 0}
                [/or]
                [then]
                            {HOPLITE_ARTIFACTS}
                            {VARIABLE ares_beaten yes}
                    [/then])}

                            {VARIABLE dungeon_seen yes}
                            {VARIABLE waterdepth_seen yes}

                            {IF_VAR depth greater_than 40 (
                [then]
                        {HOPLITE_APPLY_PROMETHEUS_HEART}
                [/then])}
                        
                            {IF_VAR hoplite_startupgrades greater_than 0 (
                [then]
                            [if]
                                [have_unit]
                                    id=Hoplite2
                                [/have_unit]
                                [then]
                                    {VARIABLE hoplite_upgradesleft1 $hoplite_startupgrades}
                                    {VARIABLE hoplite_upgradesleft2 $hoplite_startupgrades}
                                [/then]
                                [else]
                                    {VARIABLE hoplite_upgradesleft $hoplite_startupgrades}
                                [/else]
                            [/if]
                            [fire_event]
                                id=forge_dialog
                            [/fire_event]
#                            {REPEAT $hoplite_startupgrades (
#                            )}
                [/then])}
                            {CLEAR_VARIABLE hoplite_debugmenu}
                {CLEAR_VARIABLE hoplite_startupgrades}
                            {CLEAR_VARIABLE hoplite_upgrade}
                            {CLEAR_VARIABLE hoplite_upgradesleft}
                            {CLEAR_VARIABLE hoplite_upgradesleft1}
                            {CLEAR_VARIABLE hoplite_upgradesleft2}
                {IF_VAR depth not_equals 1 (
                [then]
                            {VARIABLE hoplite_depth $depth}
                {IF_VAR depth less_than 0 (
                [then]
                            {VARIABLE_OP hoplite_depth add 1}
                [/then]
                [else]
                            {VARIABLE_OP hoplite_depth sub 1}
                [/else])}
                {VARIABLE depthdescent_nofade yes}
                [fire_event]
                    id=hoplite_depthdescent
                [/fire_event]
                [/then])}
                            {CLEAR_VARIABLE depth}
                            {SPARTAN_UNHIDE_SCREEN}
                        [/command]
                    [/option]
                [/message]
#            [/then]
#            #if there are no depths to choose from, just unhide the screen
#            [else]
#                {SPARTAN_UNHIDE_SCREEN}                
#            [/else]
#        )}
#enddef

#define SPARTAN_APPLY_SELECTED_CHARACTER SIDE
#for [if]s
{VARIABLE tmp_applycharacter_side {SIDE}}
[switch]
    variable=spartan_selected_character{SIDE}
    [case]
        value=hoplite
        {IF_VAR tmp_applycharacter_side equals 2 (
        [then]
            {VARIABLE spartan_artifact_unit_type{SIDE} Hoplite2_teal}
        [/then]
        [else]
            {VARIABLE spartan_artifact_unit_type{SIDE} Hoplite2}
        [/else]
        )}
    [/case]
    [case]
        value=sorcerer
        #TODO: make a custom unit type for this class, and make a custom artifact version
        {IF_VAR tmp_applycharacter_side equals 2 (
        [then]
            {VARIABLE spartan_artifact_unit_type{SIDE} Hoplite2_teal}
        [/then]
        [else]
            {VARIABLE spartan_artifact_unit_type{SIDE} Hoplite2}
        [/else]
        )}
        [object]
            silent=yes
            duration=forever
            [filter]
               side=1
               canrecruit=yes
            [/filter]
            [effect]
               apply_to=remove_attacks
               name=spear,sword,shield,spear2
            [/effect]   
            [effect]
               apply_to=hitpoints
               increase=-10
               increase_total=-10
            [/effect]
        [/object]
        {SPARTAN_ADD_UPGRADES_MANUALLY_NON_SHARED {SIDE} energyI,teleport,teleportII,wizardbeam,wizardbeamII}
        {VARIABLE banned_upgrades{SIDE} axe,bow}
        {VARIABLE_OP hoplite_wizardbeam_max_cooldown{SIDE} sub 2}
    [/case]
[/switch]
{CLEAR_VARIABLE tmp_applycharacter_side}
#enddef

#define SPARTAN_START_MENU
    #set the default names for protagonists, overwritten by selecting classes

    {SPARTAN_SET_PROTAGONIST_NAME 1 _"Odysseus"}
    {VARIABLE spartan_classname1 _"Hoplite"}
    {VARIABLE spartan_selected_character1 hoplite}
    #ifdef MULTIPLAYER
    {SPARTAN_SET_PROTAGONIST_NAME 2 _"Theseus"}
    {VARIABLE spartan_classname2 _"Hoplite"}
    {VARIABLE spartan_selected_character2 hoplite}
    #endif

    {VARIABLE spartan_startmenu yes}
    {VARIABLE spartan_ironman no}

    [while]
    [variable]
       name=spartan_startmenu
       equals=yes
    [/variable]
    [do]
        [message]
            speaker=narrator
            caption=_"Hoplite Start menu"
#ifdef MULTIPLAYER
            message=_"Player 1 Character: <span color='#ffff99'>$protagonist_name1|</span> ($spartan_classname1|)
Player 2 Character: <span color='#ffff99'>$protagonist_name2|</span> ($spartan_classname2|)
Ironman Mode: <span color='#ffff99'>$spartan_ironman|</span>"
            side_for=1
#else
            message=_"Player 1 Character: <span color='#ffff99'>$protagonist_name1|</span> ($spartan_classname1|)
Ironman Mode: <span color='#ffff99'>$spartan_ironman|</span>"
#endif
            [option]
                image="scenery/dwarven-doors-closed.png"
                description=_"Enter the cave"
                [command]
                    {CLEAR_VARIABLE spartan_startmenu}
                    {SPARTAN_APPLY_SELECTED_CHARACTER 1}
                    {SPARTAN_APPLY_SELECTED_CHARACTER 2}
                    {SPARTAN_DEPTH_OPTIONS}
                [/command]
            [/option]
            #TODO: make character selection work in multiplayer too. maybe player 2 gets the character selection option first, then player 1 selects character, and selects starting options
            [option]
                image="units/player/protector.png~RC(magenta>red)"
                description=_"Select Character"
                #debug-only for now
                [show_if]
                    {SPARTAN_TRUE_DEBUG_CHECK}
                [/show_if]
                [command]

                [message]
                    speaker=narrator
                    caption=_"Hoplite Character"
                    message=_""
#ifdef MULTIPLAYER
                    side_for=1
#endif
                    [option]
                        image="units/player/protector.png~RC(magenta>red)"
                        description=_"Hoplite (Odysseus/Theseus)
<i>Elite Spartan warriors, skilled in many forms of combat. On top of that, Odysseus and Theseus specifically seem to have some untapped magical potential...</i>
<span color='#99ff66'>-standard Spartan gameplay</span>"
                        [command]
                            {VARIABLE spartan_selected_character1 hoplite}
                            {SPARTAN_SET_PROTAGONIST_NAME 1 _"Odysseus"}
                            {VARIABLE spartan_classname1 _"Hoplite"}
                        [/command]
                    [/option]
                    [option]
                        image="units/player/protector.png~GS()"
                        description=_"Spartan Sorcerer (Wizardius/Sorcerus)
<i>Mages aren't exactly a common sight in Sparta, but some individuals manage to study the arcane arts quite well. However, their physical strength is signficantly weaker than that of trained Hoplites, so they rely mainly on fire magic for combat.</i>
<span color='#99ff66'>-start with Flame Blast, Flame Blast II, Energy I, Teleport and Teleport II upgrades
-flame blast cooldown is reduced by 2 (from 4 to 2 turns)</span>
<span color='#ff6666'>-you no longer have a spear, sword or shield, nor access to upgrades that require these weapons
-you cannot get new weapons (axe/bow)
-start with 10 less max HP</span>"
                        [command]
                            {VARIABLE spartan_selected_character1 sorcerer}
                            {VARIABLE spartan_classname1 _"Spartan Sorcerer"}
                            #placeholder name, as a test for the protagonist name system
                            {SPARTAN_SET_PROTAGONIST_NAME 1 _"Wizardius"}
                        [/command]
                    [/option]
                [/message]

                [/command]
            [/option]
            [option]
                image="units/player/protector.png~GS()"
                description=_"Enable Ironman mode
WARNING: you cannot reload saves from previous turns
loading saves from previous ironman runs will sometimes not work too
while ironman mode is enabled, you also cannot start on later depths (like depth 11)"
                [show_if]
                    {VARIABLE_CONDITIONAL spartan_ironman not_equals yes}
                [/show_if]
                [command]
                    {VARIABLE spartan_ironman yes}
                    {VARIABLE spartan_ironman_latest_turn $turn_number}
                [/command]
            [/option]
            [option]
                image="units/player/protector.png~GS()"
                description=_"Disable Ironman mode (you can reload saves from previous turns as usual)"
                [show_if]
                    {VARIABLE_CONDITIONAL spartan_ironman equals yes}
                [/show_if]
                [command]
                    {VARIABLE spartan_ironman no}
                    {CLEAR_VARIABLE spartan_ironman_latest_turn}
                [/command]
            [/option]
        [/message]
    [/do]
    [/while]
#enddef