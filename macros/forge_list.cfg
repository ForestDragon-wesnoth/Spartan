#textdomain wesnoth-Hoplite
#define FORGE_UPGRADE_EFFECT ID EFFECTS MISC
                [sound]
			name=mace.wav
		[/sound]
                [if]
                [have_unit]
	           id=Hoplite2
                [/have_unit]
                [then]
                {HOPLITE_PLAYERFILTER1b (
		{VARIABLE hoplite_upgradeid Hoplite}
		{VARIABLE_OP hoplite_upgrades1 add 1}
		{CLEAR_VARIABLE hoplite_upgrademenu1}
		) (
		{VARIABLE hoplite_upgradeid Hoplite2}
		{VARIABLE_OP hoplite_upgrades2 add 1}
		{CLEAR_VARIABLE hoplite_upgrademenu2}
		)}
		[/then]
		[else]
		{VARIABLE hoplite_upgradeid Hoplite}
		{VARIABLE_OP hoplite_upgrades add 1}
		{CLEAR_VARIABLE hoplite_upgrademenu}
		[/else]
		[/if]
		{IF_VAR hoplite_upgrades equals 30 (
		[or]
		{VARIABLE_CONDITIONAL hoplite_upgrades1 equals 30}
		[/or]
		[or]
		{VARIABLE_CONDITIONAL hoplite_upgrades2 equals 30}
		[/or]
		[then]
                {ACHIEVEMENT_MESSAGE _"Powerhouse: obtain 30 upgades in one playthrough," powerhouse}
		[/then])}
                [object]
                  silent=yes
                  duration=forever
		  [filter]
		     id=$hoplite_upgradeid
		  [/filter]
		  {EFFECTS}
                [/object]
		{MISC}
		{CLEAR_VARIABLE hoplite_upgradeid}
		[delay]
		  time=300
		[/delay]
                [sound]
			name=mace.wav
		[/sound]
		[delay]
		  time=300
		[/delay]
                [sound]
			name=mace.wav
		[/sound]
		{IF_VAR hoplite_debugmenu not_equals yes (
		[then]
		[delay]
		  time=1000
		[/delay]
		[/then])}
                [if]
                [have_unit]
	           id=Hoplite2
                [/have_unit]
        	[then]
                {HOPLITE_PLAYERFILTER1b (
                [set_variable]
                   name={ID}_unlocked1
                   value=yes
                [/set_variable]
    	        ) (
                [set_variable]
                   name={ID}_unlocked2
                   value=yes
                [/set_variable]
                )}
		[/then]
		[else]
                [set_variable]
                   name={ID}_unlocked
                   value=yes
                [/set_variable]
		[/else]
		[/if]
                {IF_VAR hoplite_upgradesleft greater_than 0 (
                [or]
		[variable]
		   name=hoplite_upgradesleft1
		   greater_than=0
		[/variable]
                [/or]
                [or]
		[variable]
		   name=hoplite_upgradesleft2
		   greater_than=0
		[/variable]
                [/or]
                [then]
                [if]
                [have_unit]
	           id=Hoplite2
                [/have_unit]
                [then]
                  {HOPLITE_PLAYERFILTER1b (
                  [set_variable]
                   name=hoplite_upgradesleft1
                   sub=1
                  [/set_variable]
		  ) (
                  [set_variable]
                   name=hoplite_upgradesleft2
                   sub=1
                  [/set_variable]
		  )}
		[/then]
		[else]
                 [set_variable]
                   name=hoplite_upgradesleft
                   sub=1
                 [/set_variable]
		[/else]
		[/if]
		[/then])}
		{IF_VAR hoplite_debugmenu not_equals yes (
		[then]
                [set_variable]
                   name=usedforge
                   value=yes
                [/set_variable]
            [remove_item]
	       image="terrain/forge-working.png"
	       x,y=$forge_x,$forge_y
  	    [/remove_item]
	    [item]
	       image=terrain/forge.png
	       x,y=$forge_x,$forge_y
	    [/item]
	        [/then])}
#enddef

#define FORGE_UPGRADE_EFFECT_COMPANION UNITID ID EFFECTS MISC
                [sound]
			name=mace.wav
		[/sound]
                [if]
                [have_unit]
	           id=Hoplite2
                [/have_unit]
                [then]
		{VARIABLE_OP hoplite_upgrades1 add 1}
		{VARIABLE_OP hoplite_upgrades2 add 1}
                {HOPLITE_PLAYERFILTER1b (
		{CLEAR_VARIABLE hoplite_upgrademenu1}
		) (
		{CLEAR_VARIABLE hoplite_upgrademenu2}
		)}
		[/then]
		[else]
		{VARIABLE_OP hoplite_upgrades add 1}
		{CLEAR_VARIABLE hoplite_upgrademenu}
		[/else]
		[/if]
		{IF_VAR hoplite_upgrades equals 30 (
		[or]
		{VARIABLE_CONDITIONAL hoplite_upgrades1 equals 30}
		[/or]
		[or]
		{VARIABLE_CONDITIONAL hoplite_upgrades2 equals 30}
		[/or]
		[then]
                {ACHIEVEMENT_MESSAGE _"Powerhouse: obtain 30 upgades in one playthrough," powerhouse}
		[/then])}
		[if]
		[have_unit]
		  id={UNITID}
		[/have_unit]
		[then]
		[/then]
		[else]
		{VARIABLE companionid {UNITID}}
		{IF_VAR companionid equals Algadur (
		[then]
		[unstore_unit]
		  variable=algadur_stored
		  x,y=1,1
		[/unstore_unit]
		[hide_unit]
		  id=Algadur
		[/hide_unit]
		[/then])}
		{IF_VAR companionid equals Elizabeth (
		[then]
		[unstore_unit]
		  variable=elizabeth_stored
		  x,y=1,1
		[/unstore_unit]
		[hide_unit]
		  id=Elizabeth
		[/hide_unit]
		[/then])}
		[/else]
		[/if]
                [object]
                  silent=yes
                  duration=forever
		  [filter]
		     id={UNITID}
		  [/filter]
		  {EFFECTS}
                [/object]
		{IF_VAR algadur_cooldown greater_than 0 (
		[then]
		[unhide_unit]
		   id=Algadur
		[/unhide_unit]
		[store_unit]
		  [filter]
		    id=Algadur
		  [/filter]
		  variable=algadur_stored
		  kill=yes
		[/store_unit]
		[/then])}
		{IF_VAR elizabeth_cooldown greater_than 0 (
		[then]
		[unhide_unit]
		   id=Elizabeth
		[/unhide_unit]
		[store_unit]
		  [filter]
		    id=Elizabeth
		  [/filter]
		  variable=elizabeth_stored
		  kill=yes
		[/store_unit]
		[/then])}
		{MISC}
		[delay]
		  time=300
		[/delay]
                [sound]
			name=mace.wav
		[/sound]
		[delay]
		  time=300
		[/delay]
                [sound]
			name=mace.wav
		[/sound]
		{IF_VAR hoplite_debugmenu not_equals yes (
		[then]
		[delay]
		  time=1000
		[/delay]
		[/then])}
                [set_variable]
                   name={ID}_unlocked
                   value=yes
                [/set_variable]
                {IF_VAR hoplite_upgradesleft greater_than 0 (
                [or]
		[variable]
		   name=hoplite_upgradesleft1
		   greater_than=0
		[/variable]
                [/or]
                [or]
		[variable]
		   name=hoplite_upgradesleft2
		   greater_than=0
		[/variable]
                [/or]
                [then]
                [if]
                [have_unit]
	           id=Hoplite2
                [/have_unit]
                [then]
                  {HOPLITE_PLAYERFILTER1b (
                  [set_variable]
                   name=hoplite_upgradesleft1
                   sub=1
                  [/set_variable]
		  ) (
                  [set_variable]
                   name=hoplite_upgradesleft2
                   sub=1
                  [/set_variable]
		  )}
		[/then]
		[else]
                 [set_variable]
                   name=hoplite_upgradesleft
                   sub=1
                 [/set_variable]
		[/else]
		[/if]
		[/then])}
		{IF_VAR hoplite_debugmenu not_equals yes (
		[then]
                [set_variable]
                   name=usedforge
                   value=yes
                [/set_variable]
            [remove_item]
	       image="terrain/forge-working.png"
	       x,y=$forge_x,$forge_y
  	    [/remove_item]
	    [item]
	       image=terrain/forge.png
	       x,y=$forge_x,$forge_y
	    [/item]
	        [/then])}
#enddef

#define FORGE_UPGRADE ID DESCR ICON EFFECTS MISC
[option]
                        image="{ICON}"
			description={DESCR}
			[show_if]
#ifdef MULTIPLAYER
                {HOPLITE_PLAYERFILTER_VAR (
                [variable]
                   name={ID}_unlocked1
                   not_equals=yes
                [/variable]
		) (
                [variable]
                   name={ID}_unlocked2
                   not_equals=yes
                [/variable]
		)}
#else
                [variable]
                   name={ID}_unlocked
                   not_equals=yes
                [/variable]
#endif
			[/show_if]
                        [command]
         		{FORGE_UPGRADE_EFFECT {ID} {EFFECTS} {MISC}}	
                        [/command]
		[/option]
#enddef
#define FORGE_UPGRADE2 ID DESCR ICON REQUIREMENT EFFECTS MISC
[option]
                        image="{ICON}"
			description={DESCR}
			[show_if]
#ifdef MULTIPLAYER
                {HOPLITE_PLAYERFILTER_VAR (
                [variable]
                   name={ID}_unlocked1
                   not_equals=yes
                [/variable]
                [variable]
                   name={REQUIREMENT}_unlocked1
                   equals=yes
                [/variable]
		) (
                [variable]
                   name={ID}_unlocked2
                   not_equals=yes
                [/variable]
                [variable]
                   name={REQUIREMENT}_unlocked2
                   equals=yes
                [/variable]
		)}
#else
                [variable]
                   name={ID}_unlocked
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name={REQUIREMENT}_unlocked
                   equals=yes
                [/variable]
		[/and]
#endif
			[/show_if]
                        [command]
         		{FORGE_UPGRADE_EFFECT {ID} {EFFECTS} {MISC}}	
                        [/command]
		[/option]
#enddef
#third type, only shown after an upgrade has been unlocked AND a specific boss was beaten
#define FORGE_UPGRADE3 ID DESCR ICON REQUIREMENT REQUIREMENT_BOSS EFFECTS MISC
[option]
                        image="{ICON}"
			description={DESCR}
			[show_if]
#ifdef MULTIPLAYER
                {HOPLITE_PLAYERFILTER_VAR (
                [variable]
                   name={ID}_unlocked1
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name={REQUIREMENT}_unlocked1
                   equals=yes
                [/variable]
                [variable]
                   name={REQUIREMENT_BOSS}_beaten
                   equals=yes
                [/variable]
		[/and]
		) (
                [variable]
                   name={ID}_unlocked2
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name={REQUIREMENT}_unlocked2
                   equals=yes
                [/variable]
                [variable]
                   name={REQUIREMENT_BOSS}_beaten
                   equals=yes
                [/variable]
		[/and]
		)}
#else
                [variable]
                   name={ID}_unlocked
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name={REQUIREMENT}_unlocked
                   equals=yes
                [/variable]
                [variable]
                   name={REQUIREMENT_BOSS}_beaten
                   equals=yes
                [/variable]
		[/and]
#endif
			[/show_if]
                        [command]
         		{FORGE_UPGRADE_EFFECT {ID} {EFFECTS} {MISC}}	
                        [/command]
		[/option]
                [option]
                        image=units/unknown-unit.png~RC(magenta>white)
                        description=_"???: beat a certain boss to unlock this upgrade."
			[show_if]
#ifdef MULTIPLAYER
                {HOPLITE_PLAYERFILTER_VAR (
                [variable]
                   name={ID}_unlocked1
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name={REQUIREMENT}_unlocked1
                   equals=yes
                [/variable]
                [variable]
                   name={REQUIREMENT_BOSS}_beaten
                   not_equals=yes
                [/variable]
		[/and]
		) (
                [variable]
                   name={ID}_unlocked2
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name={REQUIREMENT}_unlocked2
                   equals=yes
                [/variable]
                [variable]
                   name={REQUIREMENT_BOSS}_beaten
                   not_equals=yes
                [/variable]
		[/and]
		)}
#else
                [variable]
                   name={ID}_unlocked
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name={REQUIREMENT}_unlocked
                   equals=yes
                [/variable]
                [variable]
                   name={REQUIREMENT_BOSS}_beaten
                   not_equals=yes
                [/variable]
		[/and]
#endif
		[/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define FORGE_UPGRADE4 ID DESCR ICON REQUIREMENTS1 REQUIREMENTS2 REQUIREMENTS EFFECTS MISC
[option]
                        image="{ICON}"
			description={DESCR}
			[show_if]
#ifdef MULTIPLAYER
                {HOPLITE_PLAYERFILTER_VAR (
                [variable]
                   name={ID}_unlocked1
                   not_equals=yes
                [/variable]
                [and]
		   {REQUIREMENTS1}
		[/and]
		) (
                [variable]
                   name={ID}_unlocked2
                   not_equals=yes
                [/variable]
                [and]
		   {REQUIREMENTS2}
		[/and]
		)}
#else
                [variable]
                   name={ID}_unlocked
                   not_equals=yes
                [/variable]
                [and]
		   {REQUIREMENTS}
		[/and]
#endif
			[/show_if]
                        [command]
         		{FORGE_UPGRADE_EFFECT {ID} {EFFECTS} {MISC}}	
                        [/command]
		[/option]
#enddef

#define FORGE_UPGRADE_COMPANION UNITID ID DESCR ICON EFFECTS MISC
[option]
                        image="{ICON}"
			description={DESCR}
			[show_if]
                        [variable]
                          name={ID}_unlocked
                          not_equals=yes
                        [/variable]
                        [and]
			[have_unit]
			  id={UNITID}
			[/have_unit]
			[or]
			{VARIABLE_CONDITIONAL algadur_stored.id equals {UNITID}}
			[/or]
			[or]
			{VARIABLE_CONDITIONAL elizabeth_stored.id equals {UNITID}}
			[/or]
			[/and]
			[/show_if]
                        [command]
                {FORGE_UPGRADE_EFFECT_COMPANION {UNITID} {ID} {EFFECTS} {MISC}}
                        [/command]
		[/option]
                [option]
                        image=units/unknown-unit.png~RC(magenta>white)
                        description=_"???: recruit a certain companion to unlock this upgrade."
			[show_if]
                        [variable]
                          name={ID}_unlocked
                          not_equals=yes
                        [/variable]
                        [and]
			[not]
			[have_unit]
			  id={UNITID}
			[/have_unit]
			[or]
			{VARIABLE_CONDITIONAL algadur_stored.id equals {UNITID}}
			[/or]
			[or]
			{VARIABLE_CONDITIONAL elizabeth_stored.id equals {UNITID}}
			[/or]
			[/not]
			[/and]
                        [and]
			{VARIABLE_CONDITIONAL algadurmet equals yes}
			[or]
			{VARIABLE_CONDITIONAL elizabethmet equals yes}
			[/or]
			[/and]
		[/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define FORGE_UPGRADE_COMPANION2 UNITID ID DESCR ICON REQUIREMENT EFFECTS MISC
[option]
                        image="{ICON}"
			description={DESCR}
			[show_if]
                        [variable]
                          name={ID}_unlocked
                          not_equals=yes
                        [/variable]
                        [and]
			[have_unit]
			  id={UNITID}
			[/have_unit]
			[or]
			{VARIABLE_CONDITIONAL algadur_stored.id equals {UNITID}}
			[/or]
			[or]
			{VARIABLE_CONDITIONAL elizabeth_stored.id equals {UNITID}}
			[/or]
			[/and]
			[and]
                        [variable]
                          name={REQUIREMENT}_unlocked
                          equals=yes
                        [/variable]
			[/and]
			[/show_if]
                        [command]
                {FORGE_UPGRADE_EFFECT_COMPANION {UNITID} {ID} {EFFECTS} {MISC}}
                        [/command]
		[/option]
#enddef

#define FORGE_UPGRADE_COMPANION3 UNITID ID DESCR ICON REQUIREMENT REQUIREMENT_BOSS EFFECTS MISC
[option]
                        image="{ICON}"
			description={DESCR}
			[show_if]
                        [variable]
                          name={ID}_unlocked
                          not_equals=yes
                        [/variable]
                        [and]
			[have_unit]
			  id={UNITID}
			[/have_unit]
			[or]
			{VARIABLE_CONDITIONAL algadur_stored.id equals {UNITID}}
			[/or]
			[or]
			{VARIABLE_CONDITIONAL elizabeth_stored.id equals {UNITID}}
			[/or]
			[/and]
			[and]
                        [variable]
                          name={REQUIREMENT}_unlocked
                          equals=yes
                        [/variable]
			[/and]
			[and]
                        [variable]
                          name={REQUIREMENT_BOSS}_beaten
                          equals=yes
                        [/variable]
			[/and]
			[/show_if]
                        [command]
                {FORGE_UPGRADE_EFFECT_COMPANION {UNITID} {ID} {EFFECTS} {MISC}}
                        [/command]
		[/option]
                [option]
                        image=units/unknown-unit.png~RC(magenta>white)
                        description=_"???: beat a certain boss to unlock this upgrade."
			[show_if]
                        [variable]
                          name={ID}_unlocked
                          not_equals=yes
                        [/variable]
                        [and]
                        [variable]
                          name={REQUIREMENT}_unlocked
                          equals=yes
                        [/variable]
			[/and]
                        [and]
                        [variable]
                          name={REQUIREMENT_BOSS}_beaten
                          not_equals=yes
                        [/variable]
			[/and]
		[/show_if]
        [command]
        [/command]
    [/option]
#enddef

#for the "show upgrades" menu:
#define UPGRADE_ICON ID DESCR ICON
[option]
                        image={ICON}
			description={DESCR}
			[show_if]
			   [variable]
			      name={ID}_unlocked
			      equals=yes
			   [/variable]
			   [or]
			   [variable]
			      name={ID}_unlocked1
			      equals=yes
			   [/variable]
			   [and]
			    [have_unit]
			       id=Hoplite
			       side=$side_number
			    [/have_unit]
			   [/and]
			   [and]
			   [variable]
			      name=upgradelist_menu2
			      not_equals=yes
			   [/variable]
			   [/and]
			   [/or]
			   [or]
			   [variable]
			      name={ID}_unlocked2
			      equals=yes
			   [/variable]
			   [and]
			    [have_unit]
			       id=Hoplite2
			       side=$side_number
			    [/have_unit]
			   [/and]
			   [and]
			   [variable]
			      name=upgradelist_menu2
			      not_equals=yes
			   [/variable]
			   [/and]
			   [/or]
			[/show_if]
                        [command]
                        [/command]
[/option]
[option]
                        image={ICON}
			description={DESCR}
			[show_if]
			   [variable]
			      name={ID}_unlocked2
			      equals=yes
			   [/variable]
			   [and]
			    [have_unit]
			       id=Hoplite
			       side=$side_number
			    [/have_unit]
			   [/and]
			   [and]
                           [variable]
                             name=upgradelist_menu2
                             equals=yes
                           [/variable]
			   [/and]
			   [or]
			   [variable]
			      name={ID}_unlocked1
			      equals=yes
			   [/variable]
			   [and]
			    [have_unit]
			       id=Hoplite2
			       side=$side_number
			    [/have_unit]
			   [/and]
			   [and]
			   [variable]
			      name=upgradelist_menu2
			      equals=yes
			   [/variable]
			   [/and]
			   [/or]
			[/show_if]
                        [command]
                        [/command]
[/option]
#enddef

#define FORGE_WIZARDBEAM NUMBER
		[effect]
			apply_to=remove_attacks
			name=wizardbeamI
          	[/effect]
		[effect]
			apply_to=new_attack
        name=wizardbeam{NUMBER}
        description=_"flame blast"
        type=fire
        [specials]
    [dummy]
        id=hoplite_wizardbeam
        name= _ "wizard beam"
        description=_ "This attack can attack units in a line, in the direction that you select via rightlick menu on an adjacent hex. It has a 3-turn cooldown. The line attack length is equal to the spear throw radius. However, it only is used if there is at least one enemy on the first 2 tiles of the line, thus you need to line up enemies to snipe ones in the back."
    [/dummy]
        [/specials]
        range=ranged
        damage=10
        number=1
        icon=attacks/fire-blast.png
        attack_weight=0.0
        defense_weight=0.0
	[/effect]	
#enddef

#define HOPLITE_ARMORHEAL
            [if]
            [have_unit]
	       id=Hoplite2
            [/have_unit]
            [then]
            {HOPLITE_PLAYERFILTER1b (
            [store_unit]
               [filter]
                 id=Hoplite
               [/filter]
               variable=hoplitehealed
	       kill=no
            [/store_unit]
            [set_variable]
               name=hoplitehealed.hitpoints
               add=10
            [/set_variable]
	    [unstore_unit]
	       variable=hoplitehealed
	    [/unstore_unit]
	    {CLEAR_VARIABLE hoplitehealed}
            ) (
            [store_unit]
               [filter]
                 id=Hoplite2
               [/filter]
               variable=hoplitehealed
	       kill=no
            [/store_unit]
            [set_variable]
               name=hoplitehealed.hitpoints
               add=10
            [/set_variable]
	    [unstore_unit]
	       variable=hoplitehealed
	    [/unstore_unit]
 	    {CLEAR_VARIABLE hoplitehealed}
            )}
	    [/then]
	    [else]
            [store_unit]
               [filter]
                 id=Hoplite
               [/filter]
               variable=hoplitehealed
	       kill=no
            [/store_unit]
            [set_variable]
               name=hoplitehealed.hitpoints
               add=10
            [/set_variable]
	    [unstore_unit]
	       variable=hoplitehealed
	    [/unstore_unit]
	   {CLEAR_VARIABLE hoplitehealed}
	   [/else]
	   [/if]
#enddef

#define FORGE_UPGRADE_LIST
        {FORGE_UPGRADE_COMPANION Algadur algadurI _"Algadur I: +2 melee damage/+8 max hitpoints for Algadur" attacks/battleaxe.png (
	[effect]
	apply_to=attack
	range=melee
	increase_damage=2
	[/effect]
	[effect]
	apply_to=hitpoints
	increase=8
	increase_total=8
	[/effect]
	) ()}
        {FORGE_UPGRADE_COMPANION3 Algadur algadurII _"Algadur II: +2 melee damage/+10% physical resistances/+10% magical resistances for Algadur" "attacks/battleaxe.png~BLIT(icons/overlay_II.png)" algadurI spiderqueen (
	[effect]
	apply_to=attack
	range=melee
	increase_damage=2
	[/effect]
        [effect]
            apply_to=resistance
            replace=no
            [resistance]
                blade=-10
                pierce=-10
                impact=-10
                arcane=-10
                fire=-10
                cold=-10
            [/resistance]
        [/effect]
	) ()}
        {FORGE_UPGRADE_COMPANION Elizabeth elizabethI _"Elizabeth I: +2 damage/+5 hitpoints/+10% magical resistances for Elizabeth" attacks/staff-ruby.png (
	[effect]
	apply_to=attack
	increase_damage=2
	[/effect]
	[effect]
	apply_to=hitpoints
	increase=5
	increase_total=5
	[/effect]
        [effect]
            apply_to=resistance
            replace=no
            [resistance]
                arcane=-10
                fire=-10
                cold=-10
            [/resistance]
        [/effect]
	) (
	)}
        {FORGE_UPGRADE_COMPANION2 Elizabeth elizabethII _"Elizabeth II: elizabeth now summons 2 allied fire guardians whenever entering a depth." icons/fireguardian.png elizabethI (
	) (
#effect is kicked in in the depth descent event	
	)}
        {FORGE_UPGRADE_COMPANION Algadur,Elizabeth companion_recovery _"Quick recovery I: the cooldown for companions after getting wounded is now only only 2 depths instead of 3." icons/companionrecovery.png (
	) (
	{VARIABLE_OP algadur_cooldown sub 1}
	{VARIABLE_OP elizabeth_cooldown sub 1}
	)}
        {FORGE_UPGRADE_COMPANION2 Algadur,Elizabeth companion_recoveryII _"Quick recovery II: the companions' cooldown is now only 1 depth." "icons/companionrecoveryII.png~BLIT(icons/overlay_II.png)" companion_recovery (
	) (
	{VARIABLE_OP algadur_cooldown sub 1}
	{VARIABLE_OP elizabeth_cooldown sub 1}
	)}
        {FORGE_UPGRADE armorI _"Improved Armor: +10 max hp." icons/breastplate.png (
	[effect]
	apply_to=hitpoints
	increase=10
	increase_total=10
	[/effect]
        ) (
	{HOPLITE_ARMORHEAL}
	)}
	{FORGE_UPGRADE2 armorII _"Improved Armor II: +10 max hp." "icons/breastplate.png~BLIT(icons/overlay_II.png)" armorI (
	[effect]
	apply_to=hitpoints
	increase=10
	increase_total=10
	[/effect]
        ) (
	{HOPLITE_ARMORHEAL}
	)}
	{FORGE_UPGRADE3 armorIII _"Improved Armor III: +15% resistances. The effect doesn't stack with that of the Shield Up upgrades." "icons/breastplate.png~BLIT(icons/overlay_III.png)" armorII spiderqueen (
        [effect]
            apply_to=resistance
            replace=no
            [resistance]
                blade=-15
                pierce=-15
                impact=-15
                arcane=-15
                fire=-15
                cold=-15
            [/resistance]
        [/effect]
        ) (
	{IF_VAR shieldup_unlocked equals yes (
	[or]
	[variable]
            name=shieldupII_unlocked
	    equals=yes
        [/variable]
	[/or]
	[then]
	{VARIABLE_OP shieldup_resistance sub 15}
	[/then])}
)}
#todo: fix the 40 hp cap bug, and add an armor IV upgrade
	{FORGE_UPGRADE3 regeneration _"Regeneration: you are healed by 2 hp every turn." icons/regeneration.png armorII spiderqueen (
	[effect]
		apply_to=new_ability
		[abilities]
                  [regenerate]
                     value=2
                     id=hoplite_regenerates2
                     name= _ "regenerates +2"
                     female_name= _ "female^regenerates +2"
                     description= _ "The unit will heal itself 2 HP per turn."
                     affect_self=yes
                     poison=slowed
                  [/regenerate]
		[/abilities]
	[/effect]	
	) ()}
	{FORGE_UPGRADE2 firmstance _"Immunity to knockback." icons/cuirass_muscled.png armorI (
	[effect]
		apply_to=new_ability
		[abilities]
			{ABILITY_HOPLITE_KNOCKBACKIMMUNE}
		[/abilities]
	[/effect]	
	) ()}
	{FORGE_UPGRADE healpotionI _"Healing Potion: You can recover 10 hitpoints via a rightclick menu item on the hero. Only usable once per two depths." icons/potion_red_small.png () (
        [if]
        [have_unit]
	  id=Hoplite2
        [/have_unit]
        [then]
        {HOPLITE_PLAYERFILTER1b (	
	{VARIABLE healpotion_restore1 10}
	) (
	{VARIABLE healpotion_restore2 10}
	)}
	[/then]
	[else]
	{VARIABLE healpotion_restore 10}
	[/else]
	[/if]
        )}
	{FORGE_UPGRADE2 healpotionII _"Healing Potion II: The healing potion recovers 20 hitpoints instead of 10." "icons/healpotionII.png~BLIT(icons/overlay_II.png)" healpotionI () (
        [if]
        [have_unit]
	  id=Hoplite2
        [/have_unit]
        [then]
        {HOPLITE_PLAYERFILTER1b (	
	{VARIABLE_OP healpotion_restore1 add 10}
	) (
	{VARIABLE_OP healpotion_restore2 add 10}
	)}
	[/then]
	[else]
	{VARIABLE_OP healpotion_restore add 10}
	[/else]
	[/if]
        )}
	{FORGE_UPGRADE3 healpotionIII _"Healing Potion III: The healing potion recovers 30 hitpoints instead of 20." "icons/healpotionIII.png~BLIT(icons/overlay_III.png)" healpotionII spiderqueen () (
        [if]
        [have_unit]
	  id=Hoplite2
        [/have_unit]
        [then]
        {HOPLITE_PLAYERFILTER1b (	
	{VARIABLE_OP healpotion_restore1 add 10}
	) (
	{VARIABLE_OP healpotion_restore2 add 10}
	)}
	[/then]
	[else]
	{VARIABLE_OP healpotion_restore add 10}
	[/else]
	[/if]
        )}
	{FORGE_UPGRADE2 healpotionenergy _"Envigorating Healing: Drinking a healing potion additionally restores 50 energy." icons/healpotionenergy.png healpotionI () (
#effect is kicked in in the abilities file	
        )}
	{FORGE_UPGRADE2 healpotionbag _"Potion Bag: Now potions can be used once per depth, instead of every 2 depths." icons/healpotionbag.png healpotionI () (
#effect is kicked in in the abilities file	
        )}
	{FORGE_UPGRADE2 phoenixamulet _"Phoenix Amulet: Instead of dying, you recover 10 hitpoints, deal 10 fire damage to all adjacent enemies, and slow all enemies on the map. The effect has a cooldown of 3 depths." icons/phoenix_amulet.png healpotionI () (
#nothing to put here, as the effect is kicked in in the abilities file.
        )}
	{FORGE_UPGRADE4 phoenixamuletII _"Phoenix Amulet II: Reviving now heals the same amount as the healing potion, as well as restoring 50 energy." "icons/phoenix_amulet.png~BLIT(icons/overlay_II.png)" (
        {VARIABLE_CONDITIONAL phoenixamulet_unlocked1 equals yes}
	[and]
        {VARIABLE_CONDITIONAL healpotionII_unlocked1 equals yes}
	[/and]
	) (
        {VARIABLE_CONDITIONAL phoenixamulet_unlocked2 equals yes}
	[and]
        {VARIABLE_CONDITIONAL healpotionII_unlocked2 equals yes}
	[/and]
	) (
        {VARIABLE_CONDITIONAL phoenixamulet_unlocked equals yes}
	[and]
        {VARIABLE_CONDITIONAL healpotionII_unlocked equals yes}
	[/and]
	) ()
        (
#nothing to put here, as the effect is kicked in in the abilities file.
        )}
	{FORGE_UPGRADE2 amuletcharge _"Amulet Charge: the phoenix amulet cooldown is reduced from 3 depths to 2." icons/phoenix_amulet.png phoenixamulet () (
#nothing to put here, as the effect is kicked in in the abilities file.
        )}
	{FORGE_UPGRADE impale _"Impale: spear attacks damage the unit behind the target, if the target dies from the attack." attacks/spear.png (
	[effect]
	apply_to=attack
	name=spear
        [set_specials]
             mode=append
             {WEAPON_SPECIAL_IMPALE}
        [/set_specials]
	[/effect]
        ) ()}
	{FORGE_UPGRADE2 impaleII _"Impale II: the target will deal 33% less damage for a turn after being struck with the spear." "attacks/spear.png~BLIT(icons/overlay_II.png)" impale (
	[effect]
	apply_to=attack
	name=spear
        [set_specials]
             mode=replace#append
             {WEAPON_SPECIAL_IMPALEII}
        [/set_specials]
	[/effect]	
	) ()}
	{FORGE_UPGRADE3 impaleIII _"Impale III: If there isn't an enemy behind the killed target, the enemy behind you gets attacked instead." "attacks/spear.png~BLIT(icons/overlay_III.png)" impaleII spiderqueen (
	[effect]
	apply_to=attack
	name=spear
        [set_specials]
             mode=replace#append
             {WEAPON_SPECIAL_IMPALEIII}
        [/set_specials]
	[/effect]	
	) ()}
	{FORGE_UPGRADE swordhitandrun _"Hit and Run: attacking with the short sword now lets you flee 1 tile after attacking." attacks/sword-human-short.png (
	[effect]
	apply_to=attack
	name=sword
        [set_specials]
             mode=append
    [dummy]
        id=hoplite_hitandrun
        name= _ "hit and run"
        description=_"This unit gains 1 movepoint back after attacking when using this attack, but cannot attack again on the same turn."
    [/dummy]
        [/set_specials]
	[/effect]
        ) ()}
	{FORGE_UPGRADE2 swordlunge _"Sword lunge: the shortsword deals 5 more damage if the attack is done after leaping. (the bonus is 7 if you have the artifacts)" "attacks/sword-human-short.png~BLIT(icons/overlay_II.png)" swordhitandrun (
        ) ()}
	{FORGE_UPGRADE swordcounterattack _"Counterattack: the short sword can now be used in defense." attacks/sword-human-short.png (
	[effect]
	apply_to=attack
	name=sword
	defense_weight=1.0
    [set_specials]
         mode=append
         {SPECIAL_HOPLITE_COUNTERATTACK}
    [/set_specials]
	[/effect]
        ) ()}

	{FORGE_UPGRADE axe _"Axe: new powerful melee attack (14 damage), but which can only be used when you start your turn new to the target." attacks/axe.png (
        [effect]
            apply_to=new_attack
            name="axe"
            description= _ "axe"
            icon=attacks/axe.png
            type=blade
            range=melee
            [specials]
                [dummy]
                    id=shortranged2
                    name= _ "short-ranged"
                    description=_ "This attack can only used if the unit is standing next to the target at the start of the unit's turn."
                [/dummy]
            [/specials]
            damage=14
            number=1
            defense_weight=0.0
        [/effect]
        [effect]
            apply_to=new_animation
            [attack_anim]
                [filter_attack]
                    name=axe
                [/filter_attack]
                start_time=-200
        
                [frame]
	            duration=300
                [/frame]
        
                {SOUND:HIT_AND_MISS axe.ogg {SOUND_LIST:MISS} -100}
            [/attack_anim]
        [/effect]
    ) ()}

	{FORGE_UPGRADE2 axeII _"Axe II: axe deals 3 more damage." "attacks/axe.png~BLIT(icons/overlay_II.png)" axe (
	[effect]
	apply_to=attack
	name=axe
	increase_damage=3
	[/effect]
        ) ()}

	{FORGE_UPGRADE3 axeIII _"Axe III: axe deals 4 more damage." "attacks/axe.png~BLIT(icons/overlay_III.png)" axe ares (
	[effect]
	apply_to=attack
	name=axe
	increase_damage=4
	[/effect]
        ) ()}

	{FORGE_UPGRADE spikedshield _"Spiked Shield: now the shield bash deals 5 damage on hit." attacks/rectangular-shield.png (
	[effect]
	apply_to=attack
	name=shield
	increase_damage=4
	[/effect]
        ) ()}
	{FORGE_UPGRADE shieldup _"Shield Up: your resistances increase by 33% for a turn after shield bashing. (up to a max. of 70%)" attacks/rectangular-shield.png (
        ) (
	{VARIABLE shieldup_resistance 33}
	{IF_VAR armorIII_unlocked equals yes (
	[then]
	{VARIABLE_OP shieldup_resistance sub 15}
	[/then])}
	)}
	{FORGE_UPGRADE2 shieldupII _"Shield Up II: the resistance increase is now 50% instead of 33%. (up to a max. of 70%)" "attacks/rectangular-shield.png~BLIT(icons/overlay_II.png)" shieldup (
        ) (
	{VARIABLE shieldup_resistance 50}
	{IF_VAR armorIII_unlocked equals yes (
	[then]
	{VARIABLE_OP shieldup_resistance sub 15}
	[/then])}
	)}
	{FORGE_UPGRADE4 shieldwall _"Shield Wall: the shield up effect is also activated when you skip your turn." attacks/rectangular-shield.png (
        {VARIABLE_CONDITIONAL shieldup_unlocked1 equals yes}
	[and]
        {VARIABLE_CONDITIONAL patience_unlocked1 equals yes}
	[/and]
	) (
        {VARIABLE_CONDITIONAL shieldup_unlocked2 equals yes}
	[and]
        {VARIABLE_CONDITIONAL patience_unlocked2 equals yes}
	[/and]
	) (
        {VARIABLE_CONDITIONAL shieldup_unlocked equals yes}
	[and]
        {VARIABLE_CONDITIONAL patience_unlocked equals yes}
	[/and]
	) ()
        (
#nothing to put here, as the effect is kicked in in the abilities file.
        )}
	{FORGE_UPGRADE sweepingbash _"Sweeping Bash: When you knock back an enemy, units that were adjacent to you and the enemy are slowed." attacks/rectangular-shield.png (
        ) (
	)}
#commented out, due to being quite buggy
#	{FORGE_UPGRADE shieldbashII _"Herculean Bash: shield bash now knocks enemies back two hexes." attacks/rectangular-shield.png (
#        ) ()}
	{FORGE_UPGRADE spearthrowrangeI _"Increased spear throw range by 1 tile." attacks/javelin-human.png (
        ) (
	{IF_VAR current_side_2 equals yes (
	[then]
        {VARIABLE_OP hoplite_spearthrow_radius2 add 1}
	[/then]
	[else]
        {VARIABLE_OP hoplite_spearthrow_radius add 1}
	[/else])}
	)}
	{FORGE_UPGRADE3 spearthrowrangeII _"Spear Throw II: Increased spear throw damage by 5, and spear throw range by 1 tile." "attacks/javelin-human.png~BLIT(icons/overlay_II.png)" spearthrowrangeI spiderqueen (
	[effect]
	apply_to=attack
	name=spear2
	increase_damage=5
	[/effect]
) (
	{IF_VAR current_side_2 equals yes (
	[then]
        {VARIABLE_OP hoplite_spearthrow_radius2 add 1}
	[/then]
	[else]
        {VARIABLE_OP hoplite_spearthrow_radius add 1}
	[/else])}
	)}
	{FORGE_UPGRADE2 spearthrowexplode _"Explosive Spear: spear throw harms all enemies around the target by half the spear throw damage, and slows them." "attacks/fireball.png" spearthrowrangeI () (
        {VARIABLE_OP hoplite_spearthrow_radius add 1}
	)}
	{FORGE_UPGRADE spearmove _"Spear throw doesn't end your turn, allowing you to move and/or attack after throwing the spear." attacks/javelin-human.png () (
#effect kicked in in the spear throw menu	
	)}
	{FORGE_UPGRADE harpoon _"Harpoon: the spear is instantly retreived after being thrown, but can't be used for the next 3 turns. The effect can only be used once per depth, but allows throwing the spear into water when the ability is used." attacks/javelin-human.png () (
#effect kicked in in the spear throw menu	
	)}
	{FORGE_UPGRADE3 harpoonII _"Harpoon II: The harpoon effect can now be used twice per depth." "attacks/javelin-human.png~BLIT(icons/overlay_II.png)" harpoon spiderqueen () (
#effect kicked in in the spear throw menu
	)}
        [option]
                        image=units/unknown-unit.png~RC(magenta>white)
                        description=_"???: beat a certain boss to unlock this upgrade."
			[show_if]
#ifdef MULTIPLAYER
                {HOPLITE_PLAYERFILTER_VAR (
                [variable]
                   name=wizardbeam_unlocked1
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name=spearthrowrangeI_unlocked1
                   equals=yes
                [/variable]
		[or]
                [variable]
                   name=harpoon_unlocked1
                   equals=yes
                [/variable]
		[/or]
		[/and]
		[and]
                [variable]
                   name=archmage_beaten
                   not_equals=yes
                [/variable]
		[/and]
		) (
                [variable]
                   name=wizardbeam_unlocked2
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name=spearthrowrangeI_unlocked2
                   equals=yes
                [/variable]
		[or]
                [variable]
                   name=harpoon_unlocked2
                   equals=yes
                [/variable]
		[/or]
		[/and]
		[and]
                [variable]
                   name=archmage_beaten
                   not_equals=yes
                [/variable]
		[/and]
		)}
#else
                [variable]
                   name=wizardbeam_unlocked
                   not_equals=yes
                [/variable]
		[and]
                [variable]
                   name=spearthrowrangeI_unlocked
                   equals=yes
                [/variable]
		[or]
                [variable]
                   name=harpoon_unlocked
                   equals=yes
                [/variable]
		[/or]
		[/and]
		[and]
                [variable]
                   name=archmage_beaten
                   not_equals=yes
                [/variable]
		[/and]
#endif
		[/show_if]
        [command]
        [/command]
        [/option]
	{FORGE_UPGRADE4 wizardbeam _"Flame Blast: You gain an extra ranged attack along with spear throw, that is able hit multiple enemies at once. (explained more in the 'Flame Blast' section of the information menu)" attacks/fire-blast.png (
        {VARIABLE_CONDITIONAL archmage_beaten equals yes}
        {VARIABLE_CONDITIONAL harpoon_unlocked1 equals yes}
	[or]
        {VARIABLE_CONDITIONAL archmage_beaten equals yes}
        {VARIABLE_CONDITIONAL spearthrowrangeI_unlocked1 equals yes}
	[/or]
	) (
        {VARIABLE_CONDITIONAL archmage_beaten equals yes}
        {VARIABLE_CONDITIONAL harpoon_unlocked2 equals yes}
	[or]
        {VARIABLE_CONDITIONAL archmage_beaten equals yes}
        {VARIABLE_CONDITIONAL spearthrowrangeI_unlocked2 equals yes}
	[/or]
	) (
        {VARIABLE_CONDITIONAL archmage_beaten equals yes}
        {VARIABLE_CONDITIONAL harpoon_unlocked equals yes}
	[or]
        {VARIABLE_CONDITIONAL archmage_beaten equals yes}
        {VARIABLE_CONDITIONAL spearthrowrange_unlocked equals yes}
	[/or]
	) (
	{FORGE_WIZARDBEAM I}
        ) (

        {HOPLITE_PLAYERFILTER1b (
        {VARIABLE hoplite_wizardbeam_max_cooldown1 4}
        ) (
        {VARIABLE hoplite_wizardbeam_max_cooldown2 4}
        )}

        )}
	{FORGE_UPGRADE2 wizardbeamII _"Flame Blast II: Flame blast has longer reach." "attacks/fire-blast.png~BLIT(icons/overlay_II.png)" wizardbeam (
	{FORGE_WIZARDBEAM II}
        ) ()}
	{FORGE_UPGRADE3 wizardbeamIII _"Flame Blast III: Flame blast deals 15 damage instead of 10, and its cooldown is reduced from 4 turns to 3." "attacks/fire-blast.png~BLIT(icons/overlay_III.png)" wizardbeamII ares (
	[effect]
	apply_to=attack
	name=wizardbeamII
	increase_damage=5
	[/effect]
        ) (

        {HOPLITE_PLAYERFILTER1b (
        {VARIABLE hoplite_wizardbeam_max_cooldown1 3}
        ) (
        {VARIABLE hoplite_wizardbeam_max_cooldown2 3}
        )}

        )}

	{FORGE_UPGRADE3 wizardbeamIV _"Flame Blast Mastery: Flame blast deals 20 damage instead of 15, and its cooldown is reduced from 3 turns to 2." "attacks/fire-blast.png~BLIT(icons/overlay_IV.png)" wizardbeamIII archmage2 (
	[effect]
	apply_to=attack
	name=wizardbeamII
	increase_damage=5
	[/effect]
        ) (

        {HOPLITE_PLAYERFILTER1b (
        {VARIABLE hoplite_wizardbeam_max_cooldown1 2}
        ) (
        {VARIABLE hoplite_wizardbeam_max_cooldown2 2}
        )}

        )}

	{FORGE_UPGRADE energyI _"Increased maximum energy (+25)" icons/boots_elven.png (
        ) (
	{IF_VAR hoplite_maxenergy greater_than 0 (
	[then]
        {VARIABLE_OP hoplite_energy add 25}
        {VARIABLE_OP hoplite_maxenergy add 25}
	{SET_LABEL 10 1 "Energy: $hoplite_energy|/$hoplite_maxenergy|"}
	[/then])}
	{IF_VAR hoplite_maxenergy1 greater_than 0 (
	[then]
        {HOPLITE_PLAYERFILTER1b (
        {VARIABLE_OP hoplite_energy1 add 25}
        {VARIABLE_OP hoplite_maxenergy1 add 25}
	{SET_LABEL 9 1 "Side 1 Energy: $hoplite_energy1|/$hoplite_maxenergy1|"}
        ) (
        {VARIABLE_OP hoplite_energy2 add 25}
        {VARIABLE_OP hoplite_maxenergy2 add 25}
	{SET_LABEL 10 1 "Side 2 Energy: $hoplite_energy2|/$hoplite_maxenergy2|"}
        )}
	[/then])}
	)}
	{FORGE_UPGRADE2 energyII _"Energy II: Increased maximum energy (+25)" "icons/boots_elven.png~BLIT(icons/overlay_II.png)" energyI () (
	{IF_VAR hoplite_maxenergy greater_than 0 (
	[then]
        {VARIABLE_OP hoplite_energy add 25}
        {VARIABLE_OP hoplite_maxenergy add 25}
	{SET_LABEL 10 1 "Energy: $hoplite_energy|/$hoplite_maxenergy|"}
	[/then])}
	{IF_VAR hoplite_maxenergy1 greater_than 0 (
	[then]
        {HOPLITE_PLAYERFILTER1b (
        {VARIABLE_OP hoplite_energy1 add 25}
        {VARIABLE_OP hoplite_maxenergy1 add 25}
	{SET_LABEL 9 1 "Side 1 Energy: $hoplite_energy1|/$hoplite_maxenergy1|"}
        ) (
        {VARIABLE_OP hoplite_energy2 add 25}
        {VARIABLE_OP hoplite_maxenergy2 add 25}
	{SET_LABEL 10 1 "Side 2 Energy: $hoplite_energy2|/$hoplite_maxenergy2|"}
        )}
	[/then])}
        )}	
	{FORGE_UPGRADE3 energyIII _"Energy III: Increased maximum energy (+30)" "icons/boots_elven.png~BLIT(icons/overlay_III.png)" energyII spiderqueen () (
	{IF_VAR hoplite_maxenergy greater_than 0 (
	[then]
        {VARIABLE_OP hoplite_energy add 30}
        {VARIABLE_OP hoplite_maxenergy add 30}
	{SET_LABEL 10 1 "Energy: $hoplite_energy|/$hoplite_maxenergy|"}
	[/then])}
	{IF_VAR hoplite_maxenergy1 greater_than 0 (
	[then]
        {HOPLITE_PLAYERFILTER1b (
        {VARIABLE_OP hoplite_energy1 add 30}
        {VARIABLE_OP hoplite_maxenergy1 add 30}
	{SET_LABEL 9 1 "Side 1 Energy: $hoplite_energy1|/$hoplite_maxenergy1|"}
        ) (
        {VARIABLE_OP hoplite_energy2 add 30}
        {VARIABLE_OP hoplite_maxenergy2 add 30}
	{SET_LABEL 10 1 "Side 2 Energy: $hoplite_energy2|/$hoplite_maxenergy2|"}
        )}
	[/then])}
	)}
	{FORGE_UPGRADE3 energyIV _"Energy IV: Increased maximum energy (+40)" "icons/boots_elven.png~BLIT(icons/overlay_IV.png)" energyIII ares () (
	{IF_VAR hoplite_maxenergy greater_than 0 (
	[then]
        {VARIABLE_OP hoplite_energy add 40}
        {VARIABLE_OP hoplite_maxenergy add 40}
	{SET_LABEL 10 1 "Energy: $hoplite_energy|/$hoplite_maxenergy|"}
	[/then])}
	{IF_VAR hoplite_maxenergy1 greater_than 0 (
	[then]
        {HOPLITE_PLAYERFILTER1b (
        {VARIABLE_OP hoplite_energy1 add 40}
        {VARIABLE_OP hoplite_maxenergy1 add 40}
	{SET_LABEL 9 1 "Side 1 Energy: $hoplite_energy1|/$hoplite_maxenergy1|"}
        ) (
        {VARIABLE_OP hoplite_energy2 add 40}
        {VARIABLE_OP hoplite_maxenergy2 add 40}
	{SET_LABEL 10 1 "Side 2 Energy: $hoplite_energy2|/$hoplite_maxenergy2|"}
        )}
	[/then])}
	)}
	{FORGE_UPGRADE2 adrenaline _"Adrenaline Rush: If your hitpoints fall below half the maximum, you regain half your maximum energy. Additionally, if you have Bloodlust III, you also become enraged. The effect is only activated once per depth." "icons/adrenaline.png" energyI (
	[effect]
		apply_to=new_ability
		[abilities]
                    [dummy]
                       id=hoplite_adrenaline
                    [/dummy]
		[/abilities]
	[/effect]	
	) (
	)}
#TODO	
#	{FORGE_UPGRADE3 energyIIIb _"Athleticism: leaping/teleporting only costs 40 energy, instead of 50." "icons/boots_elven.png~BLIT(icons/overlay_III.png)" energyII spiderqueen () (
#	)}
	{FORGE_UPGRADE2 teleport _"Teleport: Leap is replaced by short-ranged teleportation, allowing you to move to the other side of walls." icons/teleport.png energyI () (
#effect is applied in the leap ability event	
	)}
	{FORGE_UPGRADE3 teleportII _"Teleport II: The teleport radius is increased from 2 hexes to 3." "icons/teleport.png~BLIT(icons/overlay_II.png)" teleport spiderqueen () (
	{IF_VAR current_side_2 equals yes (
	[then]
        {VARIABLE_OP hoplite_teleport_radius2 add 1}
	[/then]
	[else]
        {VARIABLE_OP hoplite_teleport_radius add 1}
	[/else])}
	)}
	{FORGE_UPGRADE3 teleportaway _"Teleport Away: when you're attacked, you teleport away to a nearby location, negating damage taken and slowing nearby enemies. However, this drains 75 energy per 10 damage you would receive from the attack." "icons/teleport.png" teleport archmage (
		[effect]
			apply_to=new_ability
			[abilities]
                            [dummy]
                                id=hoplite_teleportaway
                                name= _ "teleport away"
                                description=_ "This unit teleports to a random location after being attacked, negating damage. However, this drains 75 energy per 10 damage you would receive from the attack."	
                            [/dummy]
			[/abilities]
		[/effect]	
	) (
	{VARIABLE teleportaway_enabled yes}
	[if]
	 [have_unit]
	    id=Hoplite2
	 [/have_unit]
	 [then]
  	 {VARIABLE teleportaway_enabled2 yes}
	 [/then]
	[/if]
	)}
	{FORGE_UPGRADE bloodlust _"Bloodlust: Killing enemies gives 5 more energy." icons/bloodlust.png () (
#effect is applied in the scenario file	
        )}
	{FORGE_UPGRADE2 bloodlustII _"Bloodlust II: Whenever you kill a unit, you recover an amount of hitpoints equal to twice the level of the target." "icons/bloodlustII.png~BLIT(icons/overlay_II.png)" bloodlust () (
#effect is applied in the scenario file	
        )}
	{FORGE_UPGRADE3 bloodlustIII _"Bloodlust III: Killing enemies for 3 turns in a row activates rage. While enraged, the hero will deal 5 more damage with all attacks, and the effects of the previous bloodlust upgrades are strengthened. The enragement effect remains as long as you keep killing enemies." "icons/bloodlustIII.png~BLIT(icons/overlay_III.png)" bloodlustII spiderqueen () (
#effect is applied in the scenario file	
        )}
#ally summon upgrades:	
	{FORGE_UPGRADE ratsI _"Rat tamer: when entering a depth, spawn 3 allied AI-controlled giant rats at random coordinates to fight for you. They are pretty good at distracting foes, as well as hunting down archers." icons/rats.png () (
#effect is kicked in in the depth descent event
	)}
	{FORGE_UPGRADE2 ratsII _"Rat master: the amount of rats spawned is increased from 3 to 6." "icons/rats.png~BLIT(icons/overlay_II.png)" ratsI () (
#effect is kicked in in the depth descent event
	)}
	{FORGE_UPGRADE3 ratsIII _"Rat army: the amount of rats spawned is increased from 6 to 9." "icons/rats.png~BLIT(icons/overlay_III.png)" ratsII spiderqueen () (
#effect is kicked in in the depth descent event
	)}
	{FORGE_UPGRADE3 ratsIV _"Rat legion: every 4 turns, a rat will spawn at a random location. (the delay is 3 turns if you don't have the frenzied rats or colossal rats upgrades)" "icons/rats.png~BLIT(icons/overlay_IV.png)" ratsIII archmage () (
#effect is kicked in in the scenario file
        {VARIABLE rat_cooldown 0}
	)}
#Alt. path:	
	{FORGE_UPGRADE2 rat_power _"Frenzied rats: Increases rats' damage dealt from 3-1 to 5-1, and max hitpoints from 5 to 10." attacks/fangs-rodent.png ratsI () (
#effect is kicked in in the depth descent event
	)}
	{FORGE_UPGRADE3 rat_powerII _"Colossal rats: Increases rats' damage dealt from 5-1 to 8-1, and max hitpoints from 10 to 15. However, the amount of rats spawned will be reduced (from 3 to 2, 6 to 4, and 9 to 6)." "attacks/fangs-rodent.png~BLIT(icons/overlay_II.png)" rat_power spiderqueen () (
#effect is kicked in in the depth descent event
	)}
	{FORGE_UPGRADE3 rat_powerIII _"Rat King: at the start of a depth, turn a random rat into the rat king, with 25 hitpoints, 10 damage and knockback immunity, but only 1 movement." "attacks/fangs-rodent.png~BLIT(icons/overlay_III.png)" rat_powerII ares () (
#effect is kicked in in the depth descent event
	)}
	{FORGE_UPGRADE2 ambush _"Ambush: Allies aren't targeted by enemies on the first turn of entering a depth." icons/cloak_leather_brown.png ratsI () (
#effect is kicked in in the depth descent event
	)}
	{FORGE_UPGRADE3 shadowclone _"Shadow Clone: summon an allied shadow clone of yourself to fight your enemies via a rightclick menu on the hero (While the clone lacks most of your abilities, it is quite strong). This costs 100 energy, and has a cooldown of 2 depths." icons/shadowclone.png ratsI spiderqueen () (
#effect is kicked in in the abilities file
	)}
	{FORGE_UPGRADE2 shadowcloneII _"Shadow Clone II: the clone now has 30 hitpoints, and can leap every 3 turns. The effect does not apply to existing clones." "icons/shadowclone.png~BLIT(icons/overlay_II.png)" shadowclone () (
#effect is kicked in in the shadow clone file
	)}
	{FORGE_UPGRADE3 shadowcloneIII _"Shadow Clone III: the clone now has 35 hitpoints, 15% resistances and the impale special on its melee attack. The effect does not apply to existing clones." "icons/shadowclone.png~BLIT(icons/overlay_III.png)" shadowcloneII ares () (
#effect is kicked in in the shadow clone file
	)}
	{FORGE_UPGRADE2 shadowcloneIIb _"Cloning Proficiency: Summoning a clone costs less energy (80 instead of 100), and you can now summon a clone once per depth, instead of every 2 depths." icons/shadowclone.png shadowclone () (
#effect is kicked in in the shadow clone file
	)}
	{FORGE_UPGRADE3 enthrall _"Enthrall: you may turn adjacent enemies (except ranged units, summoners or bosses) to your side via a rightclick option on them, as well as healing them. However, this costs 50 energy per enemy level (25 if the enemy is lvl0.), has a 3-turn cooldown, and the enthralled units do not retain advanced AI behavior, if they had any." "attacks/gaze.png" shadowclone archmage () (
#triggered in the abilities file
	)}
	{FORGE_UPGRADE3 enthrallII _"Enthrall II: enthralled enemies now gain 5 more max hitpoints, deal 2 more damage, and regenerate 2 hitpoints per turn." "attacks/gaze.png~BLIT(icons/overlay_II.png)" enthrall ares () (
#triggered in the abilities file	
	)}
#misc. stuff:
	{FORGE_UPGRADE patience _"Patience: You can can now end your turn without moving." attacks/blank-attack.png () (
	[allow_end_turn]
	[/allow_end_turn]
	)}
	{FORGE_UPGRADE2 rest _"Rest: Recover 8 energy each time you skip your turn" icons/rest.png patience () (
#nothing is put here, as the effect is kicked in by the rest_unlocked variable
	)}
	{FORGE_UPGRADE2 restII _"Rest II: Recover 10 energy when skipping your turn, as well as recovering 2 hitpoints." "icons/rest.png~BLIT(icons/overlay_II.png)" rest () (
#nothing is put here, as the effect is kicked in by the restII_unlocked variable
	)}
	{FORGE_UPGRADE3 chameleon _"Chameleon: You become invisible if you skip your turn. The invisibility wears off if you move or attack" icons/chameleon.png patience archmage (
		[effect]
			apply_to=new_ability
			[abilities]
                        [dummy]
                          id=spartan_chameleon2
                          name=_"chameleon"
                          female_name=_"female^chameleon"
                          description=_"This unit is invisible as long as it is not moving.

Enemy units cannot see this unit when it's standing on place, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
                        [filter]
                        [and]
                        [filter_wml]
                        moves=$this_unit.max_moves
                        [/filter_wml]
                        [or]
                        [not]
                        side=$hoplite_playerside
                        [/not]
                        [/or] 
                        [/and]
                        [/filter]
			[/dummy]
			[/abilities]
		[/effect]	
	) (
	[redraw]
	[/redraw])}
#removed	
#	{FORGE_UPGRADE surprise _"Advantage of Surprise: When you enter a depth, all enemies are slowed for a turn." attacks/blank-attack.png () (
#the effect is kicked in the depth descent event	
#	)}
#enddef