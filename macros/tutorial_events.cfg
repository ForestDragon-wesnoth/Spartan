#textdomain wesnoth-Hoplite

#slightly different color for mentor, to give a hint that he's not a real saurian. his help menu shows normal colors, intentionally

#define SPARTAN_SPAWN_MENTOR X Y
    {UNIT $hoplite_allyside (Hoplite_Mentor) {X} {Y} (
        id=Mentor
        # wmllint: local spelling Xerxix
        name=_"Xerxix"
        facing=nw
        [modifications]
            [object]
                silent=yes
                sort=potion-like
                [filter]
                    find_in=second_unit
                [/filter]
                [effect]
                    apply_to=image_mod
                    replace="BLEND(70,00,120,0.15)"
                [/effect]
                [effect]
                    apply_to=profile
                    portrait="portraits/saurians/augur.png~BLEND(70,00,120,0.15)"
                [/effect]
            [/object]
        [/modifications]
    )}
#enddef

#define SPARTAN_TUTORIAL_LOCK_EXIT
    [remove_item]
        image="scenery/trapdoor-open.png"
        x=6,7
        y=2,2
    [/remove_item]
    [item]
        image="scenery/trapdoor-closed.png"
        x,y=6,2
    [/item]
    {VARIABLE spartan_exitlocked_this_depth yes}
#enddef

#define SPARTAN_TUTORIAL_UNLOCK_EXIT
    [remove_item]
        image="scenery/trapdoor-closed.png"
        x=6,7
        y=2,2
    [/remove_item]
    [item]
        image="scenery/trapdoor-open.png"
        x,y=6,2
    [/item]
    {CLEAR_VARIABLE spartan_exitlocked_this_depth}
#enddef

#define SPARTAN_TUTORIAL_EVENTS
    [event]
        id=spartan_tutorial_level_generation
        first_time_only=no
        [switch]
            variable=hoplite_tutorialdepth
            [case]
                value=1
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Hoplite_Prologue_Spartanworld.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {INDOORS}
                [/replace_schedule]
                [remove_item]
                    image="scenery/trapdoor-open.png"
                    x,y=6,2
                [/remove_item]

                #TODO: add proper unit type for the villain
                {UNIT $hoplite_enemyside Hoplite_Demonstorm 6 3 (
                    id=Galatea
                    name=_"Queen Galatea"
                    facing=s
                    gender=female
                )}
                #TODO: remove this when antagonist has a proper unit type
                {MODIFY_UNIT id=Galatea max_hitpoints 100}
                {MODIFY_UNIT id=Galatea hitpoints 100}
                {UNIT $hoplite_allyside Hoplite 2 8 (
                    id=hoplite_squad1
                    name=_"Hoplite Teammate"
                    facing=se
                    [modifications]
                        [object]
                            silent=yes
                            duration=scenario
                            [effect]
                                apply_to=profile
                                portrait="portraits/hoplite.png~BLIT(portraits/hoplite-color-overlay-green.png)"
                            [/effect]
                        [/object]
                    [/modifications]
                )}
                {UNIT $hoplite_allyside Hoplite 4 9 (
                    id=hoplite_squad2
                    name=_"Hoplite Teammate"
                    facing=se
                    [modifications]
                        [object]
                            silent=yes
                            duration=scenario
                            [effect]
                                apply_to=profile
                                portrait="portraits/hoplite.png~BLIT(portraits/hoplite-color-overlay-green.png)"
                            [/effect]
                        [/object]
                    [/modifications]
                )}
#ifdef MULTIPLAYER
                {TELEPORT_UNIT id=Hoplite2 8 9}
                {TELEPORT_UNIT id=Hoplite 6 10}
#else
                {UNIT $hoplite_allyside Hoplite 8 9 (
                    id=hoplite_squad3
                    name=_"Hoplite Teammate"
                    facing=sw
                    [modifications]
                        [object]
                            silent=yes
                            duration=scenario
                            [effect]
                                apply_to=profile
                                portrait="portraits/hoplite.png~BLIT(portraits/hoplite-color-overlay-green.png)"
                            [/effect]
                        [/object]
                    [/modifications]
                )}
#endif
                {UNIT $hoplite_allyside Hoplite 10 8 (
                    id=hoplite_squad4
                    name=_"Hoplite Teammate"
                    facing=sw
                    [modifications]
                        [object]
                            silent=yes
                            duration=scenario
                            [effect]
                                apply_to=profile
                                portrait="portraits/hoplite.png~BLIT(portraits/hoplite-color-overlay-green.png)"
                            [/effect]
                        [/object]
                    [/modifications]
                )}
            [/case]
            [case]
                value=2
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Surface_Tutorial.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {AFTERNOON}
                [/replace_schedule]
            [/case]
            [case]
                value=3
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Tutorial_Trainingroom.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {INDOORS}
                [/replace_schedule]
                {SPARTAN_SPAWN_MENTOR 10 10}
                {SPARTAN_TUTORIAL_LOCK_EXIT}
            [/case]
            [case]
                value=4
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Tutorial_Trainingroom_Leap.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {INDOORS}
                [/replace_schedule]
                {SPARTAN_SPAWN_MENTOR 10 10}
                {VARIABLE noautomove_this_depth yes}#preventing automove
                #            {SPARTAN_TUTORIAL_LOCK_EXIT}
            [/case]
            [case]
                value=5
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Tutorial_Trainingroom_Spearthrow.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {INDOORS}
                [/replace_schedule]
                {SPARTAN_SPAWN_MENTOR 10 10}
                {UNIT $hoplite_enemyside Hoplite_Quintain 6 5 ()}
                {SPARTAN_TUTORIAL_LOCK_EXIT}
                {VARIABLE noautomove_this_depth yes}#preventing automove
            [/case]
            [case]
                value=6
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Tutorial_Trainingroom_Rangedenemies.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {INDOORS}
                [/replace_schedule]
                {SPARTAN_SPAWN_MENTOR 10 10}
                {UNIT $hoplite_enemyside Hoplite_Ballista_Trap 4 3 ()}
                {UNIT $hoplite_enemyside Hoplite_Ballista_Trap 4 6 ()}
                {UNIT $hoplite_enemyside Hoplite_Ballista_Trap 9 7 ()}
                {SPARTAN_TUTORIAL_LOCK_EXIT}
            [/case]
            [case]
                value=7
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Tutorial_Trainingroom_Shieldbash.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {INDOORS}
                [/replace_schedule]
                {SPARTAN_SPAWN_MENTOR 10 10}
                {UNIT $hoplite_enemyside Hoplite_Giant_Quintain 6 3 ()}
                {SPARTAN_TUTORIAL_LOCK_EXIT}
            [/case]
            [case]
                value=8
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Tutorial_Trainingroom_Swap.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {INDOORS}
                [/replace_schedule]
                {SPARTAN_SPAWN_MENTOR 10 10}
                #allied quintain:
                {UNIT $hoplite_allyside Hoplite_Quintain 6 4 ()}
                {VARIABLE noautomove_this_depth yes}#preventing automove
            [/case]
            #ally command tutorial:
            [case]
                value=9
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Tutorial_Trainingroom_Command.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {INDOORS}
                [/replace_schedule]
                {SPARTAN_SPAWN_MENTOR 10 10}
                #allied quintain:
                {UNIT $hoplite_enemyside Hoplite_Giant_Ballista_Trap 6 3 ()}
                {UNIT $hoplite_allyside Hoplite_Giant_Quintain 9 3 (ai_special=guardian)}#ai_special guardian to ensure the quintain does not move by itself
                {VARIABLE noautomove_this_depth yes}#preventing automove
            [/case]
            [case]
                value=10
                #forge tutorial:
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Tutorial_Trainingroom.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {INDOORS}
                [/replace_schedule]
                {SPARTAN_SPAWN_MENTOR 10 10}
                {VARIABLE noautomove_this_depth yes}#preventing automove
                {HOPLITE_GENERATE_FORGE 6 5}
            [/case]
            [case]
                value=11
                [replace_map]
                    map_file=~add-ons/Spartan/maps/Surface_Tutorial.map
                    expand=yes
                    shrink=yes
                [/replace_map]
                [replace_schedule]
                    {AFTERNOON}
                [/replace_schedule]
                {SPARTAN_SPAWN_MENTOR 10 7}
                #this level will just be a quick cutscene of the hoplite entering the cave
            [/case]
        [/switch]
    [/event]
    [event]
        id=spartan_tutorial_depthdescent_events
        first_time_only=no
        [switch]
            variable=hoplite_tutorialdepth
            [case]
                value=1
                {SPARTAN_UNHIDE_SCREEN}

                {SPARTAN_SMOOTH_REPLACE_MUSIC gathering_storm.ogg 1000 0}

                [message]
                    speaker=Galatea
                    message=_"I asked your vile nation hundreds of times, yet I ask again: Give me Mallion, my creator, and I may yet spare your lives!"
                [/message]
                [message]
                    speaker=Hoplite
                    message=_"No matter how many of my countrymen you or your minions murder in cold blood, it does not change the fact that we don't know who or where the hell he is!"
                [/message]
                [message]
                    speaker=Galatea
                    message=_"Lies, lies! Lying bastards, all of you! I can feel his heart beating somewhere within the walls of your wretched city! Clearly you have abducted him! Since you refuse to hand him over, you leave me no choice. I, Galatea, will leave no stone unturned to rescue my creator, no matter how many I have to kill along the way!"
                [/message]
                [sound]
                    name=magic-faeriefire.ogg
                [/sound]
                [message]
                    speaker=Galatea
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>My loyal subordinates, come to me!</span>"
                [/message]

                #TODO: maybe eventually add a fancier unit summoning cutscene

                {FLASH_WHITE (
                    [sound]
                        name=lightning.ogg
                    [/sound]
                    {UNIT $hoplite_enemyside Hoplite_Orcwarrior 6 7 (
                        id=minion1
                        generate_name=yes
                        facing=s
                        placement=map
                        passable=yes
                    )}
                    {UNIT $hoplite_enemyside Hoplite_Demilich 6 7 (
                        id=minion2
                        generate_name=yes
                        facing=s
                        placement=map
                        passable=yes
                    )}
                    {UNIT $hoplite_enemyside Hoplite_Orcgrunt 6 7 (
                        generate_name=yes
                        facing=s
                        placement=map
                        passable=yes
                    )}
                    {UNIT $hoplite_enemyside Hoplite_Orcgrunt 6 7 (
                        generate_name=yes
                        facing=s
                        placement=map
                        passable=yes
                    )}
                    {UNIT $hoplite_enemyside Hoplite_Orcarcher 6 7 (
                        generate_name=yes
                        facing=s
                        placement=map
                        passable=yes
                    )}
                    {UNIT $hoplite_enemyside Hoplite_Spearman 6 7 (
                        generate_name=yes
                        facing=s
                        placement=map
                        passable=yes
                    )}
                    {UNIT $hoplite_enemyside Hoplite_Skelearcher 6 7 (
                        generate_name=yes
                        facing=s
                        placement=map
                        passable=yes
                    )}
                    {UNIT $hoplite_enemyside Hoplite_Spearman 6 7 (
                        generate_name=yes
                        facing=s
                        placement=map
                        passable=yes
                    )}
                )}

                [message]
                    speaker=minion1
                    message=_"You called us, Your Majesty?"
                [/message]
                [message]
                    speaker=Galatea
                    message=_"Yes. Those soldiers stand in the way of my plans. Kill them!"
                [/message]
                [message]
                    speaker=minion2
                    message=_"Gladly, Your Majesty! All who stand in your path shall die by our hands!"
                [/message]
                [message]
                    speaker=minion1
                    message=_"Death to Her Majesty's enemies!"
                [/message]
                [message]
                    speaker=Hoplite
                    message=_"Seems any further negotiation is pointless... Very well then. Everyone, charge! FOR SPARTA!!!"
                [/message]
                #TODO: maybe eventually replace fade to black with an epic fight cutscene

                {FADE_TO_BLACK}

                #hide everyone
                [hide_unit]
                [/hide_unit]

                {REPEAT 30 (
                    [sound]
                        name={SOUND_LIST:SWORD_SWISH},spear.ogg,spear.ogg,bow.ogg
                    [/sound]
                    {QUAKE ()}
                    [sound]
                        name={SOUND_LIST:HUMAN_HIT},{SOUND_LIST:ORC_HIT},{SOUND_LIST:SKELETON_HIT},{SOUND_LIST:ZOMBIE_HIT}
                    [/sound]
                    [delay]
                        time=300
                    [/delay]
                )}

                #simulate the units getting wounded
                {MODIFY_UNIT id=Hoplite hitpoints 20}
                {MODIFY_UNIT id=hoplite_squad1 hitpoints 15}
                {MODIFY_UNIT id=hoplite_squad2 hitpoints 10}
#ifdef MULTIPLAYER
                {MODIFY_UNIT id=Hoplite2 hitpoints 20}
#else
                {MODIFY_UNIT id=hoplite_squad3 hitpoints 15}
#endif
                {MODIFY_UNIT id=hoplite_squad4 hitpoints 5}

                [kill]
                    side=$hoplite_enemyside
                    [not]
                        id=Galatea
                    [/not]
                    animate=no
                    fire_event=no
                [/kill]

                #place enemy corpses

                [item]
                    image="units/orcs/grunt-die-8.png~TC($hoplite_enemyside|,magenta)"
                    x,y=5,7
                [/item]
                [item]
                    image="units/undead-necromancers/adept-die8.png~TC($hoplite_enemyside|,magenta)"
                    x,y=7,7
                [/item]
                [item]
                    image="units/orcs/grunt-die-8.png~TC($hoplite_enemyside|,magenta)"
                    x,y=3,8
                [/item]
                [item]
                    image="units/human-loyalists/spearman-death4.png~TC($hoplite_enemyside|,magenta)~BLEND(160,82,45,0.3)~CS(-35,-35,-35)"
                    x,y=2,7
                [/item]
                [item]
                    image="units/orcs/grunt-die-8.png~TC($hoplite_enemyside|,magenta)"
                    x,y=9,9
                [/item]
                [item]
                    image="units/human-loyalists/spearman-death4.png~TC($hoplite_enemyside|,magenta)~BLEND(160,82,45,0.3)~CS(-35,-35,-35)"
                    x,y=9,6
                [/item]
                [item]
                    image="units/undead-skeletal/archer/archer-die-13.png~TC($hoplite_enemyside|,magenta)"
                    x,y=3,6
                [/item]

                #reposition the hoplites so that the main character is closest to the portal

                {TELEPORT_UNIT id=Hoplite 6 7}
                {TELEPORT_UNIT id=hoplite_squad1 4 8}
                {TELEPORT_UNIT id=hoplite_squad2 5 8}
#ifdef MULTIPLAYER
                {TELEPORT_UNIT id=Hoplite2 7 8}
#else
                {TELEPORT_UNIT id=hoplite_squad3 7 8}
#endif
                {TELEPORT_UNIT id=hoplite_squad4 8 8}

                #unhide everyone
                [unhide_unit]
                [/unhide_unit]
                {FADE_IN}

                [message]
                    speaker=Hoplite
                    message=_"No matter how many of your minions you throw at us, Sparta will not fall!"
                [/message]
                [message]
                    speaker=Galatea
                    message=_"You may be quite tenacious foes, but I still have more troops!"
                [/message]
                [message]
                    speaker=Galatea
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>My loyal subordinates, come to me once again!</span>"
                [/message]

                {FLASH_WHITE (
                    [sound]
                        name=lightning.ogg
                    [/sound]
                    {UNIT $hoplite_enemyside Hoplite_Orcgrunt 8 4 (
                        id=minion_last
                        generate_name=yes
                        facing=sw
                        placement=map
                        passable=yes
                    )}
                )}

                [message]
                    speaker=Galatea
                    message=_"..."
                [/message]
                [delay]
                    time=500
                [/delay]
                [message]
                    speaker=Galatea
                    message=_"Wait, that's it?"
                [/message]
                [message]
                    speaker=minion_last
                    message=_"Your Majesty, we don't have anyone else left on the other side of the portal! We lost most of the army already trying to storm the damn city..."
                [/message]
                [message]
                    speaker=Galatea
                    message=_"..."
                [/message]
                [delay]
                    time=1000
                [/delay]
                [message]
                    speaker=Galatea
                    message=_"...seems I underestimated the enemy, and the incompetence of my generals, by a significant margin."
                [/message]
                [message]
                    speaker=Galatea
                    message=_"Don't think this is over, damn hoplites. You may have prevented me from reuniting with my creator this time, but soon I shall return from Irdya with an army that is stronger tenfold compared to the one I sent this time! The liars standing between me and Mallion will be buried under rubble, and I will finally free him."
                [/message]
                [message]
                    speaker=hoplite_squad2
                    message=_"Irdya? What does she mean?"
                [/message]
                [message]
                    speaker=Galatea
                    message=_"There are plenty of worlds beside your own. I can travel freely between them, and so could Mallion, who your despicable kind has abducted."
                [/message]
                [message]
                    speaker=Galatea
                    message=_"And one final warning - if Mallion's heart stops beating when I return, I will personally make sure that Sparta is turned into one massive lake of blood and a mountain of corpses. If you want to make sure that most ordinary citizens of your nation stay unharmed, you'd better heed my words."
                [/message]
                [message]
                    speaker=Hoplite
                    message=_"Quick, we must chase her!"
                [/message]

                {MOVE_UNIT id=Galatea 6 5}
                [kill]
                    id=Galatea
                    animate=no
                    fire_event=no
                [/kill]
                [move_unit]
                    id=minion_last
                    to_x,to_y=6,5
                    check_passability=no#so that he jumps straight in the portal instead of taking a detour
                [/move_unit]
                [kill]
                    id=minion_last
                    animate=no
                    fire_event=no
                [/kill]

                [message]
                    speaker=Hoplite
                    message=_"I won't let you escape!"
                [/message]

                [move_unit]
                    id=Hoplite
                    to_x,to_y=6,5
                    check_passability=no#so that he jumps straight in the portal instead of taking a detour
                [/move_unit]

                [hide_unit]
                    id=Hoplite
                [/hide_unit]

#ifdef MULTIPLAYER
                [message]
                    speaker=Hoplite2
                    message=_"Wait for me!"
                [/message]

                [move_unit]
                    id=Hoplite2
                    to_x,to_y=6,6
                    check_passability=no#so that he jumps straight in the portal instead of taking a detour
                [/move_unit]
                [hide_unit]
                    id=Hoplite2
                [/hide_unit]
#endif

                [message]
                    speaker=hoplite_squad1
                    message=_"Follow her!"
                [/message]

                #allied hoplites try to follow into the portal, but fail
                {MOVE_UNIT id=hoplite_squad1 6 7}
                {MOVE_UNIT id=hoplite_squad2 6 7}
                {MOVE_UNIT id=hoplite_squad3 6 7}
                {MOVE_UNIT id=hoplite_squad4 6 7}

                #portal closes, turning back into a normal chasm

                {FLASH_WHITE (
                    [sound]
                        name=lightning.ogg
                    [/sound]
                    #portal turns
                    [terrain]
                        terrain=Qxu
                        [and]
                            terrain=Qxua^Efm
                        [/and]
                    [/terrain]
                    [delay]
                        time=300
                    [/delay]
                )}

                [message]
                    speaker=hoplite_squad1
#ifdef MULTIPLAYER
                    message=_"Damn it, the portal has closed! Now it's just $protagonist_name1| and $protagonist_name2| against Galatea and whatever she has in Irdya!"
#else
                    message=_"Damn it, the portal has closed! Now it's just $protagonist_name1| alone against Galatea and whatever she has in Irdya!"
#endif
                [/message]
                [message]
                    speaker=hoplite_squad2
#ifdef MULTIPLAYER
                    message=_"Alas, not much we can do now, with the portal gone. Only those two have any chance to stop Galatea."
#else
                    message=_"Alas, not much we can do now, with the portal gone. Only he has any chance to stop Galatea."
#endif
                [/message]
                [message]
                    speaker=hoplite_squad4
#ifdef MULTIPLAYER
                    message=_"You think $protagonist_name1| and $protagonist_name2| can do it by themselves? The fate of all Sparta rests in their hands..."
#else
                    message=_"You think $protagonist_name1| can do it alone? The fate of all Sparta rests in his hands..."
#endif
                [/message]
                [message]
                    speaker=hoplite_squad2
#ifdef MULTIPLAYER
                    message=_"We must believe, and pray to Athena and Ares to give them strength in this herculean task. And if this 'Irdya' that Galatea spoke of has not yet fully been conquered, perhaps those two may find some allies along the way as well."
#else
                    message=_"We must believe, and pray to Athena and Ares to give him strength in this herculean task. And if this 'Irdya' that Galatea spoke of has not yet fully been conquered, perhaps he may find some allies along the way as well."
#endif
                [/message]

                #move straight to the next depth:

                #            {VARIABLE depthdescent_nofade yes}
                [fire_event]
                    id=hoplite_depthdescent
                [/fire_event]
            [/case]
            [case]
                value=2
                {SPARTAN_UNHIDE_SCREEN}
                {SPARTAN_SMOOTH_REPLACE_MUSIC Enchanted_Forest.ogg 1000 0}

#ifdef MULTIPLAYER
                [message]
                    id=Hoplite
                    message=_"Argh... where... am I? How much time has passed? Did I lose consciousness when I stepped in the portal? Now where did I actually end up..."
                [/message]

                {MODIFY_UNIT id=Hoplite facing sw}
                [delay]
                    time=500
                [/delay]
                {MODIFY_UNIT id=Hoplite facing se}
                [message]
                    id=Hoplite
                    message=_"$protagonist_name2|, you followed me into the portal too? Wake up!"
                [/message]
                [delay]
                    time=500
                [/delay]
                [message]
                    id=Hoplite2
                    message=_"Argh... $protagonist_name1|, good to see you made it here too. I jumped into the portal just barely in time to follow you."
                [/message]
                [message]
                    id=Hoplite
                    message=_"Did you see anyone else try to jump in the portal?"
                [/message]
                [message]
                    id=Hoplite2
                    message=_"No, the others were too far away, it's just us two against Galatea's forces now."
                [/message]
                [message]
                    id=Hoplite
                    message=_"I see. In that case, our next goal is to scout the area, find some locals, and see if we can learn anything about Galatea and where her army is now."
                [/message]
#else
                [message]
                    id=Hoplite
                    message=_"Argh... where... am I? How much time has passed? Did I lose consciousness when I stepped in the portal? Now where did I actually end up..."
                [/message]
#endif

                [if]
                    {VARIABLE_CONDITIONAL spartan_rewindtime_ending equals yes}
                    [then]
                        [message]
                            speaker=narrator
                            caption=_"Unknown Voice"
                            message=_"And thus, the cycle continues..."
                            image=wesnoth-icon.png
                        [/message]
                        {SPARTAN_PSEUDO_END_SCREEN _"The End?"}
                        [endlevel]
                            result=victory
                            linger_mode=no
                            carryover_report=no
                        [/endlevel]
                    [/then]
                    [else]
                        {SPARTAN_SPAWN_MENTOR 10 7}
                        {MODIFY_UNIT id=Mentor facing sw}
                        [delay]
                            time=500
                        [/delay]
                        {MOVE_UNIT id=Mentor 7 8}

                        [message]
                            speaker=Mentor
#ifdef MULTIPLAYER
                            message=_"Ah, I see you are finally awake, outsiders. You are now in Irdya, a world different from your own."
#else
                            message=_"Ah, I see you are finally awake, outsider. You are now in Irdya, a world different from your own."
#endif
                        [/message]
                        [message]
                            id=Hoplite
                            message=_"So Galatea's portal indeed worked just as she described..."
                        [/message]
                        [message]
#ifdef MULTIPLAYER
                            id=Hoplite2
                            message=_"Wait, how could you so quickly tell we are not from Irdya? Also, would you tell me who you are?"
#else
                            id=Hoplite
                            message=_"Wait, how could you so quickly tell I am not from Irdya? Also, would you tell me who you are?"
#endif
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"My name is Xerxix, I am an oracle and sage. I've been observing this place for a while now, since it is Galatea's lair, and just so happened to notice you appear out of thin air, lying on the ground, around the same spot that she returned to Irdya not too long ago."
                        [/message]

#ifdef MULTIPLAYER
                        [message]
                            id=Hoplite
                            message=_"Alright, since you introduced yourself first, it's our turn - I am $protagonist_name1| and this is $protagonist_name2|, we are both hoplites from Sparta, a city-state with some of the finest warriors in my world."
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"You don't look like her brainwashed minions, in which case I assume you are also against her, and chased her into Irdya?"
                        [/message]
                        [message]
                            id=Hoplite2
                            message=_"Indeed. She and her troops suddenly appeared in my world and tried to invade our city. She then retreated into this world promising to return with an even larger army, so we followed her here."
                        [/message]
#else
                        [message]
                            id=Hoplite
                            message=_"Alright, since you introduced yourself first, it's my turn - I am $protagonist_name1|, a hoplite from Sparta, a city-state with some of the finest warriors in my world."
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"You don't look like one of her brainwashed minions, in which case I assume you are also against her, and chased her into Irdya?"
                        [/message]
                        [message]
                            id=Hoplite
                            message=_"Indeed. She and her troops suddenly appeared in my world and tried to invade my city. She then retreated into this world promising to return with an even larger army, so I followed her here."
                        [/message]
#endif
                        [message]
                            speaker=Mentor
#ifdef MULTIPLAYER
                            message=_"I see, $protagonist_name1| and $protagonist_name2|. Luckily for you, this area is relatively safe for now. It used to be swarming with Galatea's minions not too long ago, but they were already deployed on their one-way trips to your world. Anyway, since you are here, you are exactly who I need. I would be glad to fill you in about Irdya and Galatea."
#else
                            message=_"I see, $protagonist_name1|. Luckily for you, this area is relatively safe for now. It used to be swarming with Galatea's minions not too long ago, but they were already deployed on their one-way trips to your world. Anyway, since you are here, you are exactly who I need. I would be glad to fill you in about Irdya and Galatea."
#endif
                        [/message]
                        [message]
                            speaker=Hoplite
#ifdef MULTIPLAYER
                            message=_"Very well, share your knowledge on these matters. Advice is precisely what we need right now, in this unfamiliar world."
#else
                            message=_"Very well, share your knowledge on these matters. Advice is precisely what I need right now, in this unfamiliar world."
#endif
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"I will focus on the important details first - See the cave entrance in front of you? That leads to one of the biggest tunnel systems in this entire continent, home to dwarves, orcs, necromancers, nagas, saurians, and more."
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"Previously these numerous factions mainly stuck to their parts of the cave and occasionally fought over territory, but not long ago things took a very drastic turn."
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"Galatea, as she calls herself, entered the caves and by some unknown power has managed to brainwash most of the locals. Unlike most, the dwarves resisted her influence, though I don't know how long they will survive against Galatea's' combined forces."
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"She also summoned various beings from other worlds, even from your own."
                        [/message]
                        [message]
                            speaker=Hoplite
                            message=_"I see. What else can you tell me about Galatea?"
                        [/message]
                        #in this line the mentor is lying about Galatea wanting to take over Irdya:
                        [message]
                            speaker=Mentor
                            message=_"Not only is she extremely powerful and able to brainwash whole armies, she plans to eventually take over the entirety of Irdya itself."
                        [/message]
                        [message]
#ifdef MULTIPLAYER
                            speaker=Hoplite2
#else
                            speaker=Hoplite
#endif
                            message=_"Take over this entire world? To be honest I haven't heard her say anything like that when we fought her. She said something about finding 'Mallion', her creator."
                        [/message]
                        #in this line the mentor is lying
                        [message]
                            speaker=Mentor
                            message=_"Galatea is good at creating false pretexts for her invasion, but in the end her goal always is, was and will enslavement of others. I would advise against trusting her word."
                        [/message]
                        [message]
                            speaker=Hoplite
                            message=_"Makes sense, she did falsely accuse us of kidnapping her creator and invaded our city, when nobody in our city has never even heard of this 'Mallion' before."
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"Yes, yes, exactly. Anyway, since you are here, I need your help to stop her plans of world domination."
                        [/message]
#ifdef MULTIPLAYER
                        [message]
                            speaker=Hoplite
                            message=_"I am... certainly flattered that you think I and $protagonist_name2| alone can take on Galatea and all her underlings, but why do you trust something as important as the fate of your world to two strangers you only just met? Do you have nobody else to turn to? Surely you could convince an army or two to intervene if the fate of the entire world is at stake?"
                        [/message]
#else
                        [message]
                            speaker=Hoplite
                            message=_"I am... certainly flattered that you think I alone can take on Galatea and all her underlings, but why do you trust something as important as the fate of your world to some stranger you only just met? Do you have nobody else to turn to? Surely you could convince an army or two to intervene if the fate of the entire world is at stake?"
                        [/message]
#endif
                        #haven't yet decided whether the mentor is lying, or actually telling [carefully chosen parts of] the truth in this section
                        [message]
                            speaker=Mentor
                            message=_"The continent is currently engulfed in large-scale wars between the major powers. Nobody can afford to divert any troops, since they would be overrun by their enemies. On top of that, Galatea has not yet attacked regions in Irdya outside this cave, since she is still amassing an army for that."
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"You have fought Galatea's minions yourselves so you know how dangerous she is, but if I told another Irdyan that the world is under a threat from someone able to brainwash whole armies and able to move between worlds, I'd be considered completely insane."
                        [/message]
                        [message]
                            speaker=Mentor
#ifdef MULTIPLAYER
                            message=_"Therefore, $protagonist_name1| and $protagonist_name2|, you two are my only hope now."
#else
                            message=_"Therefore, $protagonist_name1|, you are my only hope now."
#endif
                        [/message]
                        [message]
                            speaker=Hoplite
                            message=_"I see..."
                        [/message]
                        [message]
                            speaker=Mentor
                            message=_"But before you head into the caves, I will need to test your skills to know if are truly ready. There is an abandoned training ground nearby, perfect for the task. Follow me."
                        [/message]

                        {MOVE_UNIT id=Mentor 10 7}
                        [kill]
                            id=Mentor
                            animate=no
                            fire_event=no
                        [/kill]
                        {MOVE_UNIT id=Hoplite 10 7}
                        [fire_event]
                            id=hoplite_depthdescent
                        [/fire_event]
                    [/else]
                [/if]
            [/case]
            [case]
                value=3
                {SPARTAN_SMOOTH_REPLACE_MUSIC breaking_the_chains.ogg 1000 0}
                {UNIT $hoplite_enemyside Hoplite_Quintain 6 3 ()}
                {UNIT $hoplite_enemyside Hoplite_Quintain 4 3 ()}
                {UNIT $hoplite_enemyside Hoplite_Quintain 8 3 ()}
                [message]
                    speaker=Mentor
                    message=_"Your first test is to destroy these three quintains."
                [/message]
                [message]
                    id=Hoplite
                    message=_"Doesn't take a skilled warrior to beat up a scarecrow or two. Didn't you say you wanted to actually test my skills?"
                [/message]
                [message]
                    speaker=Mentor
                    message=_"Don't worry, I enchanted them with magic - these quintains will move towards you and fight you like a proper foe would."
                [/message]
                [message]
#ifdef MULTIPLAYER
                    id=Hoplite2
#else
                    id=Hoplite
#endif
                    message=_"Excellent. Time to tear them to pieces!"
                [/message]
            [/case]
            [case]
                value=4
                #gives both players the chance to try the mechanic
#ifdef MULTIPLAYER
                {VARIABLE noinfinitemove_this_depth yes}
#endif
                [message]
                    speaker=Mentor
                    message=_"The next test will be a test of your athleticism - you must <span color='#ffff99'>leap</span> over the water to reach the exit."
                [/message]
                [message]
                    id=Hoplite
                    message=_"Very well."
                [/message]
                [message]
                    speaker=narrator
                    message=_"You can <span color='#ffff99'>leap</span> via a right-click menu on your character. Leaping costs <span color='#ffff99'>50 energy</span>, shown in the top of the interface next to a boot icon. The main way to restore <span color='#ffff99'>energy</span> is by killing enemies. Energy is also <span color='#ffff99'>fully restored</span> when you go to the next level."
                    image=wesnoth-icon.png
                [/message]
            [/case]
            [case]
                value=5
                #gives both players the chance to try the mechanic
#ifdef MULTIPLAYER
                {VARIABLE noinfinitemove_this_depth yes}
#endif
#ifdef MULTIPLAYER
                [message]
                    speaker=Mentor
                    message=_"Sometimes an enemy will be just barely out of reach. Do either of you happen to be skilled with any ranged weapons?"
                [/message]
                [message]
                    id=Hoplite
                    message=_"I prefer melee combat, but I can throw my spear if necessary."
                [/message]
                [message]
                    id=Hoplite2
                    message=_"Same story here."
                [/message]
#else
                [message]
                    speaker=Mentor
                    message=_"Sometimes an enemy will be just barely out of reach. Do you happen to be skilled with any ranged weapons?"
                [/message]
                [message]
                    id=Hoplite
                    message=_"I prefer melee combat, but I can throw my spear if necessary."
                [/message]
#endif
                [message]
                    speaker=Mentor
                    message=_"Very well, demonstrate your spear-throwing skills on this quintain."
                [/message]
                [message]
                    speaker=narrator
                    message=_"To <span color='#ffff99'>throw your spear</span>, right-click on a tile in a <span color='#ffff99'>2-tile</span> radius from the hoplite (after the tutorial, you will be able to extend your spear's range with upgrades). The spear can't be thrown again until it is picked up by <span color='#ffff99'>moving</span> to it."
                    image=wesnoth-icon.png
                [/message]
            [/case]
            [case]
                value=6
                {IF_VAR tutorial_spearreturn_dialog equals yes (
                    [then]
                        [message]
                            speaker=Mentor
                            message=_"I am quite impressed, your spear did return! Your world is quite interesting, I must admit. But back to the test..."
                        [/message]
                    [/then]
                )}
                [message]
                    speaker=Mentor
                    message=_"Your next task is to destroy three magical ballista traps. Unlike the archers you meet in the caves, these don't move, but taking a shot will still hurt just the same. Make sure to move out of the way once you see them <span color='#ffff99'>aiming</span>, and use walls as cover."
                [/message]
                [message]
                    speaker=narrator
                    message=_"Tiles where <span color='#ffff99'>ranged enemies</span> are <span color='#ffff99'>aiming</span> will be highlighted in yellow or red (and sometimes other colors too). Ranged enemies <span color='#ffff99'>aim</span> at the end of their turn, and <span color='#ffff99'>shoot</span> at the start of their turn"
                    image=wesnoth-icon.png
                [/message]
            [/case]
            [case]
                value=7
                [message]
                    speaker=Mentor
                    message=_"Sometimes, it's best not to face an enemy head-on. Instead, you should use nearby <span color='#ffff99'>terrain</span> to your advantage - <span color='#ffff99'>bash</span> enemies into <span color='#ffff99'>walls or chasms</span> with your <span color='#ffff99'>shield</span>. Once you go into the caves, you can also bash your foes into <span color='#ffff99'>lava</span>."
                [/message]
                [message]
                    speaker=narrator
                    message=_"Your shield bash attack pushes enemies 1 tile (can be upgraded after the tutorial to push enemies even further), and <span color='#ffff99'>slows</span> them for a turn. Some enemies are <span color='#ffff99'>resistant</span> or <span color='#ffff99'>immune</span> to <span color='#ffff99'>knockback</span>, in which case they also won't be slowed."
                    image=wesnoth-icon.png
                [/message]
            [/case]
            [case]
                value=8
                #gives both players the chance to try the mechanic
#ifdef MULTIPLAYER
                {VARIABLE noinfinitemove_this_depth yes}
#endif
                [message]
                    speaker=Mentor
                    message=_"Besides properly dealing with enemies, you also need to know how to properly deal with <span color='#ffff99'>allies</span>. In tight corridors, allies can sometimes get in your way, or vice versa. To be able to better fight together in tight spaces, you should <span color='#ffff99'>swap</span> places with your allies when necessary."
                [/message]
                [message]
                    speaker=narrator
                    message=_"To <span color='#ffff99'>swap</span> places with an ally, right-click on an allied unit while standing next to it."
                    image=wesnoth-icon.png
                [/message]
            [/case]
            [case]
                value=9
                [message]
                    speaker=Mentor
                    message=_"On the subject of allies, you can also <span color='#ffff99'>order</span> them to move. At the end of this hallway there is a ballista trap, but also an allied quintain. This specific quintain <span color='#ffff99'>will only move if you order it to move</span>. Use the quintain to your advantage to destroy the ballista."
                [/message]
                [message]
                    speaker=narrator
                    message=_"To <span color='#ffff99'>order</span> an ally to move, right-click an ally, select <span color='#ffff99'>Order this ally to move somewhere</span>, then right-click on another tile and select <span color='#ffff99'>Order ally to move here</span>."
                    image=wesnoth-icon.png
                [/message]
            [/case]
            [case]
                value=10
                #gives both players the chance to try the mechanic
#ifdef MULTIPLAYER
                {VARIABLE noinfinitemove_this_depth yes}
#endif
                [message]
                    id=Hoplite
                    message=_"What is this? Some kind of forge?"
                [/message]
                [message]
                    speaker=Mentor
                    message=_"Yes, but not just any ordinary forge, but an enchanted one. You can use these <span color='#ffff99'>forges</span> to <span color='#ffff99'>upgrade</span> your gear, and even unlock new abilities. I sense that besides your skills in physical combat, you even have a powerful untapped magical potential, and I believe that you can awaken it with the help of these forges too."
                [/message]
                [message]
#ifdef MULTIPLAYER
                    id=Hoplite2
#else
                    id=Hoplite
#endif
                    message=_"Excellent."
                [/message]
            [/case]
            [case]
                value=11
                [message]
                    speaker=Mentor
                    message=_"You have now sufficiently demonstrated your skills. Now we must part ways, I wish you luck on your quest."
                [/message]
                [message]
                    id=Hoplite
                    message=_"Thank you, Xerxix. Perhaps one day our paths will cross again."
                [/message]
#ifdef MULTIPLAYER
                [message]
                    speaker=Mentor
                    message=_"I believe we will indeed. Goodbye for now, $protagonist_name1| and $protagonist_name2|."
                [/message]
#else
                [message]
                    speaker=Mentor
                    message=_"I believe we will indeed. Goodbye for now, $protagonist_name1|."
                [/message]
#endif
                #mentor teleports away
                [animate_unit]
                    flag=pre_teleport
                    [filter]
                        id=Mentor
                    [/filter]
                [/animate_unit]
                [kill]
                    id=Mentor
                    animate=no
                    fire_event=no
                [/kill]

                [message]
                    id=Hoplite
                    message=_"He just disappeared into thin air... this 'Irdya' is quite an unusual world."
                [/message]
#ifdef MULTIPLAYER
                [message]
                    id=Hoplite2
                    message=_"Now it's time to finally embark on our quest to defeat Galatea!"
                [/message]
#else
                [message]
                    id=Hoplite
                    message=_"Now it's time to finally embark on my quest to defeat Galatea!"
                [/message]
#endif

                {MOVE_UNIT id=Hoplite 6 2}
#ifdef MULTIPLAYER
                {MOVE_UNIT id=Hoplite2 6 3}
#endif
                #remove forge from first level, to compensate for free forge in tutorial
                {VARIABLE forge_delay -1}
                {CLEAR_VARIABLE hoplite_tutorial}

                {ACHIEVEMENT_MESSAGE tutorial}

                [fire_event]
                    id=hoplite_depthdescent
                [/fire_event]
            [/case]
        [/switch]
    [/event]
    [event]
        #adding multiplayer compatibility just in case I add multiplayer version
        name=side turn, moveto
        id=spartan_tutorial_mentor_energy_refresh
        first_time_only=no
        #TODO: add a "this tutorial level requires energy" check
        [filter_condition]
            {VARIABLE_CONDITIONAL hoplite_tutorial equals yes}
            [and]
                [have_unit]
                    id=Mentor
                [/have_unit]
            [/and]
            [and]
                {VARIABLE_CONDITIONAL hoplite_energy$side_number less_than 50}
            [/and]
            [and]
                {VARIABLE_CONDITIONAL side_number equals 1}
#ifdef MULTIPLAYER
                [or]
                    {VARIABLE_CONDITIONAL side_number equals 2}
                [/or]
#endif
            [/and]
        [/filter_condition]
        [sound]
            name=magic-faeriefire.ogg
        [/sound]
        {HOPLITE_ADD_ENERGY_BY_SIDE $side_number 100}#restore energy
        [message]
            speaker=Mentor
            #            message=_"Exhausting yourself by jumping too often won't do you much good. I'll restore your energy with magic this time, but you won't have that luxury in the caves..."
            message=_"Exhausting yourself by jumping too often won't do you much good. I'll restore your energy with magic this time, but keep in mind that you won't have that luxury in the caves..."
        [/message]
    [/event]
    [event]
        name=last breath
        id=spartan_tutorial_quintain_dialog
        first_time_only=yes
        [filter]
            type=Hoplite_Quintain
            side=$hoplite_enemyside
        [/filter]
        [filter_condition]
            #first tutorial
            {VARIABLE_CONDITIONAL hoplite_tutorialdepth equals 3}
            [and]
                [not]
                    [have_unit]
                        type=Hoplite_Quintain
                        side=$hoplite_enemyside
                        [not]
                            id=$unit.id
                        [/not]
                    [/have_unit]
                [/not]
            [/and]
        [/filter_condition]
        {SPARTAN_TUTORIAL_UNLOCK_EXIT}
        [message]
            id=Hoplite
            message=_"That was easy. Hardly anything compared to the training we had back home."
        [/message]
        [message]
            speaker=Mentor
            message=_"I assure you, this was just a warmup."
        [/message]
    [/event]
    [event]
        name=last breath
        id=spartan_tutorial_quintain_dialog_spearthrow
        first_time_only=yes
        [filter]
            type=Hoplite_Quintain
            side=$hoplite_enemyside
        [/filter]
        [filter_condition]
            #spear throw level
            {VARIABLE_CONDITIONAL hoplite_tutorialdepth equals 5}
            [and]
                [not]
                    [have_unit]
                        type=Hoplite_Quintain
                        side=$hoplite_enemyside
                        [not]
                            id=$unit.id
                        [/not]
                    [/have_unit]
                [/not]
            [/and]
        [/filter_condition]
        {SPARTAN_TUTORIAL_UNLOCK_EXIT}
        [message]
            speaker=Mentor
            message=_"Good throw! Now leap to retrieve the spear you've thrown."
        [/message]
    [/event]
    [event]
        name=last breath
        id=spartan_tutorial_enemykill_dialog_ranged
        first_time_only=yes
        [filter]
            side=$hoplite_enemyside
        [/filter]
        [filter_condition]
            #spear throw level
            {VARIABLE_CONDITIONAL hoplite_tutorialdepth equals 6}
            [and]
                [not]
                    [have_unit]
                        side=$hoplite_enemyside
                        [not]
                            id=$unit.id
                        [/not]
                    [/have_unit]
                [/not]
            [/and]
        [/filter_condition]
        {SPARTAN_TUTORIAL_UNLOCK_EXIT}
        [message]
            speaker=Mentor
            message=_"Well done, let's proceed."
        [/message]
    [/event]
    [event]
        name=last breath
        id=spartan_tutorial_quintain_dialog_shieldbash
        first_time_only=yes
        [filter]
            side=$hoplite_enemyside
        [/filter]
        [filter_condition]
            #spear throw level
            {VARIABLE_CONDITIONAL hoplite_tutorialdepth equals 7}
            [and]
                [not]
                    [have_unit]
                        side=$hoplite_enemyside
                        [not]
                            id=$unit.id
                        [/not]
                    [/have_unit]
                [/not]
            [/and]
        [/filter_condition]
        {SPARTAN_TUTORIAL_UNLOCK_EXIT}
        [if]
            [have_location]
                x,y=$x1,$y1
                terrain=Qx*^*,X*^*
            [/have_location]
            [then]
                [message]
                    speaker=Mentor
                    message=_"As you can see, the environment can be just as deadly of a weapon as your spear."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Mentor
                    message=_"You actually managed to beat the Giant Quintain without pushing it into the chasm? I must admit, I am impressed."
                [/message]
            [/else]
        [/if]
    [/event]
    [event]
        name=spartan_custom_predescent_events
        id=spartan_tutorial_spear_return_dialog1
        first_time_only=yes
        [filter_condition]
            {VARIABLE_CONDITIONAL hoplite_spear_on_ground1 equals yes}
            [and]
                [have_unit]
                    id=Mentor
                [/have_unit]
            [/and]
            [and]
                {VARIABLE_CONDITIONAL hoplite_tutorialdepth equals 5}
            [/and]
        [/filter_condition]
        [message]
            speaker=Mentor
            message=_"Wait, $protagonist_name1|, you forgot your spear!"
        [/message]
        [message]
            id=Hoplite
            message=_"Do not worry, my spear carries the blessing of Hermes. If I am too far from it, it eventually finds it way to me. Watch and observe."
        [/message]
        {VARIABLE tutorial_spearreturn_dialog yes}
    [/event]
    [event]
        name=spartan_custom_predescent_events
        id=spartan_tutorial_spear_return_dialog2
        first_time_only=yes
        [filter_condition]
            {VARIABLE_CONDITIONAL hoplite_spear_on_ground2 equals yes}
            [and]
                [have_unit]
                    id=Mentor
                [/have_unit]
            [/and]
            [and]
                {VARIABLE_CONDITIONAL hoplite_tutorialdepth equals 5}
            [/and]
        [/filter_condition]
        [message]
            speaker=Mentor
            message=_"Wait, $protagonist_name2|, you forgot your spear!"
        [/message]
        [message]
            id=Hoplite2
            message=_"Do not worry, my spear carries the blessing of Hermes. If I am too far from it, it eventually finds it way to me. Watch and observe."
        [/message]
        {VARIABLE tutorial_spearreturn_dialog yes}
    [/event]
#enddef
