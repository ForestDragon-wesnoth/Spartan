#textdomain wesnoth-Hoplite
#define ACHIEVEMENT_MESSAGE TEXT ID
    {IF_VAR {ID}_complete not_equals yes (
    [and]
    {VARIABLE_CONDITIONAL hoplite_noachieve not_equals yes}
    [/and]
        [then]
            [sound]
                name=fanfare-short.wav
            [/sound]
            [object]
                name="Achievement Complete"
                image=misc/laurel.png
                duration=forever
                description={TEXT}
                [filter]
                    id=Hoplite
                [/filter]
            [/object]
            {VARIABLE {ID}_complete yes}
            [set_global_variable]
                namespace=hoplite
                from_local={ID}_complete
                to_global=hoplite_{ID}_complete
                side=1#todo: either make achievements not carry over in multiplayer, or be independent for each player
                immediate=yes
            [/set_global_variable]
        [/then]
    )}
#enddef

#define CHECKPOINT_MESSAGE TEXT ID FILTER FILTER2 FILTER3
        {IF_VAR {FILTER} {FILTER2} {FILTER3} (
        [and]
            [variable]
                name=hoplite_{ID}_unlocked
                not_equals=yes
            [/variable]
        [/and]
        [then]
            [sound]
                name=fanfare-short.wav
            [/sound]
            [object]
                name="Starting point unlocked"
                image=scenery/trapdoor-open.png
                duration=forever
                description={TEXT}
                [filter]
                    id=Hoplite
                [/filter]
            [/object]
            {VARIABLE hoplite_{ID}_unlocked yes}
            [set_global_variable]
                namespace=hoplite
                from_local=hoplite_{ID}_unlocked
                to_global=hoplite_{ID}_unlocked
                side=1#in multiplayer, the depth choice will be in an [options] tag
                immediate=yes
            [/set_global_variable]
        [/then]
        )}
#enddef

#define ACHIEVEMENT_MESSAGE_LONE TEXT ID SIDE
    {IF_VAR {ID}_complete not_equals yes (
    [and]
    {VARIABLE_CONDITIONAL hoplite_noachieve not_equals yes}
    [/and]
        [then]
            [sound]
                name=fanfare-short.wav
            [/sound]
            [object]
                name="Achievement Complete"
                image=misc/laurel.png
                duration=forever
                description={TEXT}
                [filter]
                    id=Hoplite
                [/filter]
            [/object]
            {VARIABLE {ID}_complete yes}
            [set_global_variable]
                namespace=hoplite
                from_local={ID}_complete
                to_global=hoplite_{ID}_complete
                side=1
                immediate=yes
            [/set_global_variable]
        [/then]
    )}
#enddef

#define ACHIEVEMENT_MENUITEM ID DESCR
    [option]
        image=misc/laurel.png
        description=_"(Completed) "+{DESCR}
        [show_if]
            [variable]
                name={ID}_complete
                equals=yes
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
    [option]
        image=misc/laurel-bronze.png~BLIT(misc/red-x.png,28,28)
        description={DESCR}
        [show_if]
            [variable]
                name={ID}_complete
                not_equals=yes
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef
#progress achievemnts:
#define ACHIEVEMENT_MENUITEM2 ID GOAL DESCR
    [option]
        image=misc/laurel.png
        description=_"(Completed) "+{DESCR}
        [show_if]
            [variable]
                name={ID}_complete
                equals=yes
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
    [option]
        image=misc/laurel-bronze.png~BLIT(misc/red-x.png,28,28)
        description=_ "("+"${ID}_progress|"+"/{GOAL}) "+{DESCR}
        [show_if]
            [variable]
                name={ID}_complete
                not_equals=yes
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef
#define ACHIEVEMENT_MENUITEM3 ID NAME DESCR
    [option]
        image=misc/laurel.png
        description=_"(Completed) "+{NAME}+{DESCR}
        [show_if]
            [variable]
                name={ID}_complete
                equals=yes
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
    [option]
        image=units/unknown-unit.png~RC(magenta>white)
        description=_"???: "+<i>{DESCR}</i>
        [show_if]
            [variable]
                name={ID}_complete
                not_equals=yes
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef
#define ACHIEVEMENT_MENUITEM4 ID GOAL NAME DESCR
    [option]
        image=misc/laurel.png
        description=_"(Completed) "+{NAME}+{DESCR}
        [show_if]
            [variable]
                name={ID}_complete
                equals=yes
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
    [option]
        image=units/unknown-unit.png~RC(magenta>white)
        description=_ "("+"${ID}_progress|"+"/{GOAL}) "+_"???: "+<i>{DESCR}</i>
        [show_if]
            [variable]
                name={ID}_complete
                not_equals=yes
            [/variable]
        [/show_if]
        [command]
        [/command]
    [/option]
#enddef

#define HOPLITE_ACHIEVEMENT_LIST
#commented out achievements mean TODO or screapped
    {ACHIEVEMENT_MENUITEM2 shieldbash 10 _"This is Sparta! : Kill 10 enemies by bashing them into lava/chasms in one playthrough."}
    {ACHIEVEMENT_MENUITEM2 ratmaster 10 _"Who's a good rat? Yes, you are : have your rats kill 10 enemies in one playthrough."}
    {ACHIEVEMENT_MENUITEM depth28 _"Crusader: Reach depth 28"}
    {ACHIEVEMENT_MENUITEM3 depth51 _"Bearer of the Flame: " _"Reach depth 51"}
    {ACHIEVEMENT_MENUITEM3 depth100 _"Where no man has ever gone: " _"Reach depth 100"}#TODO: make a secret ending at depth 100
    {ACHIEVEMENT_MENUITEM3 depthminus15 _"Underworld Roamer: " _"Reach the depth -15"}
    {ACHIEVEMENT_MENUITEM spiderqueen _"Arachnid Slayer: defeat the spider queen on depth 10"}
    {ACHIEVEMENT_MENUITEM archmage _"Wizard Bane: defeat the archmage on depth 15"}
    #TODO:
    #{ACHIEVEMENT_MENUITEM3 spiderqueen2 _"Pest Exterminator: defeat the spider queen on depth 30"}
    {ACHIEVEMENT_MENUITEM ares _"Hero: defeat the avatar of war on depth 20"}#todo: rename the achievement
    {ACHIEVEMENT_MENUITEM donovan _"You shall not pass! : defeat the knight of chaos at depth 25"}
    {ACHIEVEMENT_MENUITEM duo _"Always two, there are: defeat the minotaur/warlock duo on depth 30"}
    {ACHIEVEMENT_MENUITEM reaper _"Angel of Death: defeat the grim reaper in the depths of the underworld"}
    {ACHIEVEMENT_MENUITEM3 archmage2 _"Shaxtal Bane: " _"defeat the archmage once again on depth 35"}
    {ACHIEVEMENT_MENUITEM victory _"Victory: leave the dungeon via the stairs after obtaining the Prometheus' Heart"}
    #{ACHIEVEMENT_MENUITEM3 finalboss _"The Chosen One: defeat the true final boss at depth 100"}#TODO
    {ACHIEVEMENT_MENUITEM3 return _"To hell and back: " _"Return to the mortal realm from the underworld."}
    {ACHIEVEMENT_MENUITEM2 warrior 30 _"Warrior: Kill 30 enemies in one playthrough."}
    {ACHIEVEMENT_MENUITEM2 warmonger 100 _"Warmonger: Kill 100 enemies in one playthrough."}
    {ACHIEVEMENT_MENUITEM2 godofwar 300 _"God of War: Kill 300 enemies in one playthrough."}
    {ACHIEVEMENT_MENUITEM3 algadur _"The Knalgan: " _"recruit Algadur."}
    {ACHIEVEMENT_MENUITEM3 elizabeth _"The Mage: " _"recruit Elizabeth."}
    {ACHIEVEMENT_MENUITEM pacifist _"Pacifist: Reach depth 5 without killing enemies. (You can still attack them, though, as long as you don't kill. Also, kills done by allies don't count)"}
    {ACHIEVEMENT_MENUITEM speedrun _"Speedrun: reach depth 10 in 110 turns or less."}
    {ACHIEVEMENT_MENUITEM specialist _"Specialist: reach depth 8 without using forges. Note: you're automatically moved to a forge when killing all enemies, so make sure to keep at least one enemy alive on depths that have a forge."}
    {ACHIEVEMENT_MENUITEM3 powerhouse _"Powerhouse: " _"obtain 30 upgrades in one playthrough."}
#    {ACHIEVEMENT_MENUITEM3 over9000 _"It's over nine thousaaaaand!: obtain every single upgrade in one playthrough."}
    {ACHIEVEMENT_MENUITEM2 frenzy 7 _"Frenzy: Kill at least one enemy per turn for 7 turns in a row."}
    {ACHIEVEMENT_MENUITEM2 berserk 12 _"Berserk: Kill at least one enemy per turn for 12 turns in a row."}
#    {ACHIEVEMENT_MENUITEM3 madman _"Madman: Kill at least one enemy per turn for 16 turns in a row."}
    {ACHIEVEMENT_MENUITEM4 impale 50 _"Vlad, the Impaler: " _"kill 50 enemies using the impale special in one playthrough."}
#TODO
    {ACHIEVEMENT_MENUITEM3 runesmith _"Smithing master: " _"rescue a dwarf runesmith."}
    {ACHIEVEMENT_MENUITEM4 revive 5 _"Not today, Death! : " _"activate the Phoenix Amulet upgrade effect 5 times in one playthrough."}
    #TODO:
    #{ACHIEVEMENT_MENUITEM spearthrow _"Spear Thrower: Kill 20 enemies with a spear throw in one playthrough."}
#enddef

#define HOPLITE_ACHIEVEMENT_DEPTHCHECK
    {IF_VAR hoplite_depth equals 5 (
        [and]
            [variable]
                name=hoplite_killedenemy
                not_equals=yes
            [/variable]
        [/and]
        [then]
            {ACHIEVEMENT_MESSAGE _"Pacifist: Reach depth 5 without killing enemies." pacifist}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 10 (
        [and]
            [variable]
                name=turn_number
                less_than_equal_to=110
            [/variable]
        [/and]
        [then]
            {ACHIEVEMENT_MESSAGE _"Speedrun: reach depth 10 in 110 turns or less." speedrun}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 8 (
        [and]
            [variable]
                name=hoplite_upgrades
                less_than=1
            [/variable]
        [/and]
        [and]
            [variable]
                name=hoplite_upgrades1
                less_than=1
            [/variable]
        [/and]
        [and]
            [variable]
                name=hoplite_upgrades2
                less_than=1
            [/variable]
        [/and]
        [then]
            {ACHIEVEMENT_MESSAGE _"Specialist: reach depth 8 without using forges. Note: you're automatically moved to a forge when killing all enemies, so make sure to keep at least one enemy alive on depths that have a forge." specialist}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 28 (
        [then]
            {ACHIEVEMENT_MESSAGE _"Crusader: Reach depth 28" depth28}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 50 (
        [then]
            {ACHIEVEMENT_MESSAGE _"Bearer of the Flame: Reach depth 51" depth51}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 100 (
        [then]
            {ACHIEVEMENT_MESSAGE _"Where no man has ever gone: Reach depth 100" depth100}
        [/then]
    )}
    {IF_VAR hoplite_depth less_than_equal_to -15 (
        [then]
            {ACHIEVEMENT_MESSAGE _"Underworld Roamer: Reach depth -15" depthminus15}
        [/then]
    )}
#enddef

#define HOPLITE_RETREIVE_ACHIEVEMENT ID
    [get_global_variable]
        namespace=hoplite
        from_global=hoplite_{ID}_complete
        to_local={ID}_complete
        side=1
    [/get_global_variable]
#enddef

#define HOPLITE_SET_ACHIEVEMENT ID
    {VARIABLE {ID}_complete yes}
    [set_global_variable]
        namespace=hoplite
        from_local={ID}_complete
        to_global=hoplite_{ID}_complete
        side=1
        immediate=yes
    [/set_global_variable]
#enddef

#define HOPLITE_CLEAR_ACHIEVEMENT ID
    {VARIABLE {ID}_complete no}
    [clear_global_variable]
        namespace=hoplite
        global=hoplite_{ID}_complete
        side=1
        immediate=yes
    [/clear_global_variable]
#enddef

#define HOPLITE_ACHIEVEMENTLIST MACRO
    {HOPLITE_{MACRO} depth28}
    {HOPLITE_{MACRO} depth51}
    {HOPLITE_{MACRO} depth100}
    {HOPLITE_{MACRO} depthminus15}
    {HOPLITE_{MACRO} return}
    {HOPLITE_{MACRO} spiderqueen}
    {HOPLITE_{MACRO} archmage}
    {HOPLITE_{MACRO} ares}
    {HOPLITE_{MACRO} duo}
    {HOPLITE_{MACRO} reaper}
    {HOPLITE_{MACRO} archmage2}
    {HOPLITE_{MACRO} warrior}
    {HOPLITE_{MACRO} warmonger}
    {HOPLITE_{MACRO} godofwar}
    {HOPLITE_{MACRO} victory}
    {HOPLITE_{MACRO} pacifist}
    {HOPLITE_{MACRO} speedrun}
    {HOPLITE_{MACRO} specialist}
    {HOPLITE_{MACRO} revive}
    {HOPLITE_{MACRO} shieldbash}
    {HOPLITE_{MACRO} frenzy}
    {HOPLITE_{MACRO} berserk}
    {HOPLITE_{MACRO} ratmaster}
    {HOPLITE_{MACRO} powerhouse}
    {HOPLITE_{MACRO} runesmith}
    {HOPLITE_{MACRO} algadur}
    {HOPLITE_{MACRO} elizabeth}
    {HOPLITE_{MACRO} impale}
#enddef

#define HOPLITE_RAGE_EVENT ID
    [sound]
        name=fire.wav
    [/sound]
    [object]
        silent=yes
        duration=forever
        id=bloodlustIII
        take_only_once=no
        [filter]
            id={ID}
        [/filter]
        [effect]
            apply_to=attack
            increase_damage=5
        [/effect]
        [effect]
            apply_to=image_mod
            add="~CS(0,-40,-50)"
        [/effect]
    [/object]
    [redraw]
    [/redraw]
    [store_unit]
        [filter]
            id={ID}
        [/filter]
        kill=no
        variable=hoplite_enraged
    [/store_unit]

    [unstore_unit]
        variable=hoplite_enraged
        text= _ "Enraged!"
        {COLOR_HARM}
    [/unstore_unit]
#enddef

#define HOPLITE_ACHIEVEMENT_EVENTS
    [event]
        name=prestart
        {HOPLITE_ACHIEVEMENTLIST RETREIVE_ACHIEVEMENT}
        {VARIABLE warrior_progress 0}
        {VARIABLE warmonger_progress 0}
        {VARIABLE godofwar_progress 0}
        {VARIABLE revive_progress 0}
        {VARIABLE shieldbash_progress 0}
        {VARIABLE frenzy_progress 0}
        {VARIABLE berserk_progress 0}
        {VARIABLE ratmaster_progress 0}
        {VARIABLE impale_progress 0}
        {VARIABLE revive_progress 0}
    [/event]
    #allows keeping frenzy/bloodlustIII streak if you hit a boss, and gives some energy
    [event]
        name=attacker hits
        id=hoplite_hitboss
        first_time_only=no
        [filter]
            id=Hoplite,Hoplite2
        [/filter]
        [filter_second]
            ability=hoplite_boss
        [/filter_second]
        {VARIABLE hoplite_hitboss_thisturn$unit.side| yes}

        {VARIABLE hitboss_energybonus $second_unit.level}
        {VARIABLE_OP hitboss_energybonus multiply 5}

        {HOPLITE_ADD_ENERGY_BY_VAR unit hitboss_energybonus}

        {CLEAR_VARIABLE hitboss_energybonus}
    [/event]
    [event]
         name=side 1 turn end
         first_time_only=no
         [if]
             {VARIABLE_CONDITIONAL hoplite_killedenemy_thisturn equals yes}
             [or]
                 {VARIABLE_CONDITIONAL hoplite_killedenemy_thisturn1 equals yes}
             [/or]
             [then]
                 [if]
                     [have_unit]
                         id=Hoplite2
                     [/have_unit]
                     [then]
                         {HOPLITE_PLAYERFILTER (
                             {CLEAR_VARIABLE hoplite_killedenemy_thisturn1}
                         ) (
                         )}
                     [/then]
                     [else]
                         {CLEAR_VARIABLE hoplite_killedenemy_thisturn}
                     [/else]
                 [/if]
                 {VARIABLE_OP frenzy_progress add 1}
                 {VARIABLE_OP berserk_progress add 1}
                 {HOPLITE_PLAYER_UPGRADEFILTER bloodlustIII (side=$side_number) (
                     [and]
                         {VARIABLE_CONDITIONAL bloodlustIII_active not_equals yes}
                         [and]
                             [have_unit]
                                 id=Hoplite
                                 side=$side_number
                             [/have_unit]
                         [/and]
                         [or]
                             {HOPLITE_PLAYERFILTER_VAR (
                                 {VARIABLE_CONDITIONAL bloodlustIII_active1 not_equals yes}
                                 [and]
                                     [have_unit]
                                         id=Hoplite
                                         side=$side_number
                                     [/have_unit]
                                 [/and]
                             ) ()}
                         [/or]
                     [/and]
                     [then]
                         [if]
                             [have_unit]
                                 id=Hoplite2
                             [/have_unit]
                             [then]
                                 {HOPLITE_PLAYERFILTER (
                                     {VARIABLE_OP bloodlustIII_progress1 add 1}
                                 ) (
                                 )}
                             [/then]
                             [else]
                                 {VARIABLE_OP bloodlustIII_progress add 1}
                             [/else]
                         [/if]
                     [/then]
                 )}
             [/then]
             [else]
             #hitting a boss lets you keep the killstreak
             [if]
                {VARIABLE_CONDITIONAL hoplite_hitboss_thisturn1 equals yes}
                [then]
                    {CLEAR_VARIABLE hoplite_hitboss_thisturn1}
                [/then]
                [else]
                 {VARIABLE frenzy_progress 0}
                 {VARIABLE berserk_progress 0}
                 [if]
                     [have_unit]
                         id=Hoplite2
                     [/have_unit]
                     [then]
                         {HOPLITE_PLAYERFILTER (
                             {VARIABLE bloodlustIII_progress1 0}
                             {VARIABLE bloodlustIII_active1 no}
                         ) (
                         )}
                     [/then]
                     [else]
                         {VARIABLE bloodlustIII_progress 0}
                         {VARIABLE bloodlustIII_active no}
                     [/else]
                 [/if]
                 [if]
                     [have_unit]
                         id=Hoplite2
                     [/have_unit]
                     [then]
                         {HOPLITE_PLAYERFILTER (
                             [remove_object]
                                 object_id=bloodlustIII
                                 [filter]
                                     id=Hoplite
                                 [/filter]
                             [/remove_object]
                         ) (
                         )}
                     [/then]
                     [else]
                         [remove_object]
                             object_id=bloodlustIII
                             [filter]
                                 id=Hoplite
                             [/filter]
                         [/remove_object]
                     [/else]
                 [/if]
                 [redraw]
                 [/redraw]
                 [/else]
                 [/if]
             [/else]
         [/if]
         {IF_VAR bloodlustIII_progress equals 3 (
             [then]
                 {HOPLITE_RAGE_EVENT Hoplite}
                 {VARIABLE bloodlustIII_active yes}
                 {VARIABLE bloodlustIII_progress 0}
             [/then]
         )}
         {IF_VAR bloodlustIII_progress1 equals 3 (
             [then]
                 {HOPLITE_RAGE_EVENT Hoplite}
                 {VARIABLE bloodlustIII_active1 yes}
                 {VARIABLE bloodlustIII_progress1 0}
             [/then]
         )}
         {IF_VAR frenzy_progress equals 7 (
             [then]
                 {ACHIEVEMENT_MESSAGE _"Frenzy: Kill at least one enemy per turn for 7 turns in a row." frenzy}
             [/then]
         )}
         {IF_VAR berserk_progress equals 12 (
             [then]
                 {ACHIEVEMENT_MESSAGE _"Berserk: Kill at least one enemy per turn for 12 turns in a row." berserk}
             [/then]
         )}
         #  [/then])}
     [/event]
 #ifdef MULTIPLAYER
     [event]
         name=side 2 turn end
         first_time_only=no
         [if]
         {VARIABLE_CONDITIONAL hoplite_killedenemy_thisturn2 equals yes}
             [then]
                 {CLEAR_VARIABLE hoplite_killedenemy_thisturn2}
                 {VARIABLE_OP frenzy_progress add 1}
                 {VARIABLE_OP berserk_progress add 1}
                 {HOPLITE_PLAYER_UPGRADEFILTER bloodlustIII (side=$side_number) (
                     [and]
                         {VARIABLE_CONDITIONAL bloodlustIII_active2 not_equals yes}
                         [and]
                             [have_unit]
                                 id=Hoplite2
                                 side=$side_number
                             [/have_unit]
                         [/and]
                     [/and]
                     [then]
                         {VARIABLE_OP bloodlustIII_progress2 add 1}
                     [/then]
                 )}
             [/then]
             [else]
             #hitting a boss lets you keep the killstreak
             [if]
                {VARIABLE_CONDITIONAL hoplite_hitboss_thisturn2 equals yes}
                [then]
                    {CLEAR_VARIABLE hoplite_hitboss_thisturn2}
                [/then]
                [else]
                 {VARIABLE frenzy_progress 0}
                 {VARIABLE bloodlustIII_progress2 0}
                 {VARIABLE bloodlustIII_active2 no}
                 {HOPLITE_PLAYERFILTER () (
                 [remove_object]
                     object_id=bloodlustIII
                     [filter]
                         id=Hoplite2
                     [/filter]
                 [/remove_object]
		 )}
                 [redraw]
                 [/redraw]
                 [/else]
                 [/if]
             [/else]
         [/if]
         {IF_VAR bloodlustIII_progress2 equals 3 (
             [then]
                 {HOPLITE_RAGE_EVENT Hoplite2}
                 {VARIABLE bloodlustIII_active2 yes}
                 {VARIABLE bloodlustIII_progress2 0}
             [/then]
         )}
         {IF_VAR frenzy_progress equals 7 (
             [then]
                 {ACHIEVEMENT_MESSAGE _"Frenzy: Kill at least one enemy per turn for 7 turns in a row." frenzy}
             [/then]
         )}
         {IF_VAR berserk_progress equals 12 (
             [then]
                 {ACHIEVEMENT_MESSAGE _"Berserk: Kill at least one enemy per turn for 12 turns in a row." berserk}
             [/then]
         )}
     [/event]
 #endif
#enddef
