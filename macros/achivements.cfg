#textdomain wesnoth-Hoplite

#define ADD_ACHIEVEMENT_TO_LIST ID DESCR
   [set_variables]
       name=hoplite_achievements
       mode=append
       [value]
           id={ID}
           descr={DESCR}
           type=normal
       [/value]
   [/set_variables]
#enddef

#define ADD_ACHIEVEMENT_TO_LIST2 ID GOAL DESCR
   [set_variables]
       name=hoplite_achievements
       mode=append
       [value]
           id={ID}
           descr={DESCR}
           type=progress
           progress_goal={GOAL}
       [/value]
   [/set_variables]
   {IF_VAR {ID}_progress not_equals $emptyvar (
   [else]
       {VARIABLE {ID}_progress1 0}
   [/else]
   )}
#ifdef MULTIPLAYER
   {IF_VAR {ID}_progress not_equals $emptyvar (
   [else]
       {VARIABLE {ID}_progress2 0}
   [/else]
   )}
#endif
#enddef

#simple hidden achievement:
#define ADD_ACHIEVEMENT_TO_LIST3 ID DESCR HIDDEN_DESCR
   [set_variables]
       name=hoplite_achievements
       mode=append
       [value]
           id={ID}
           descr={DESCR}
           hidden_descr={HIDDEN_DESCR}
           type=hidden
       [/value]
   [/set_variables]
#enddef

#hidden with progress achievement:
#define ADD_ACHIEVEMENT_TO_LIST4 ID GOAL DESCR HIDDEN_DESCR
   [set_variables]
       name=hoplite_achievements
       mode=append
       [value]
           id={ID}
           descr={DESCR}
           hidden_descr={HIDDEN_DESCR}
           type=hidden_progress
           progress_goal={GOAL}
       [/value]
   [/set_variables]
   {IF_VAR {ID}_progress not_equals $emptyvar (
   [else]
       {VARIABLE {ID}_progress1 0}
   [/else]
   )}
#ifdef MULTIPLAYER
   {IF_VAR {ID}_progress not_equals $emptyvar (
   [else]
       {VARIABLE {ID}_progress2 0}
   [/else]
   )}
#endif
#enddef

#define ACHIEVEMENT_RETURN_VALUE ID VALUE
[foreach]
    array=hoplite_achievements
    index_var=i
    [do]
    {IF_VAR this_item.id equals {ID} (
    [then]
    {VARIABLE tmp_achievement_return $this_item.{VALUE}}
    [break][/break]#no need to continue the loop after the value is found
    [/then]
    )}
    [/do]
[/foreach]
#enddef

#define ACHIEVEMENT_MESSAGE TEXT ID
    {IF_VAR {ID}_complete1 not_equals yes (
    [and]
    {VARIABLE_CONDITIONAL hoplite_noachieve not_equals yes}
    [/and]
    #ifdef MULTIPLAYER
    [or]
    {VARIABLE_CONDITIONAL {ID}_complete2 not_equals yes}
    [and]
    {VARIABLE_CONDITIONAL hoplite_noachieve not_equals yes}
    [/and]
    [/or]
    #endif
        [then]
            [sound]
                name=fanfare-short.wav
            [/sound]
            {ACHIEVEMENT_RETURN_VALUE {ID} descr}
            [object]
                name="Achievement Complete"
                image=misc/laurel.png
                duration=forever
                description=$tmp_achievement_return
                [filter]
                    id=Hoplite
                [/filter]
            [/object]
            {CLEAR_VARIABLE tmp_achievement_return}
            {VARIABLE {ID}_complete1 yes}
            [set_global_variable]
                namespace=hoplite
                from_local={ID}_complete1
                to_global=hoplite_{ID}_complete
                side=1
                immediate=yes
            [/set_global_variable]
            #ifdef MULTIPLAYER
            {VARIABLE {ID}_complete2 yes}
            [set_global_variable]
                namespace=hoplite
                from_local={ID}_complete2
                to_global=hoplite_{ID}_complete
                side=2
                immediate=yes
            [/set_global_variable]
            #endif
        [/then]
    )}
#enddef

#define CHECKPOINT_MESSAGE TEXT ID FILTER FILTER2 FILTER3
        {IF_VAR {FILTER} {FILTER2} {FILTER3} (
        [and]
            [variable]
                name=hoplite_{ID}_unlocked
                not_equals=yes
            [/variable]
        [/and]
        [then]
            [sound]
                name=fanfare-short.wav
            [/sound]
            [object]
                name="Starting point unlocked"
                image=scenery/trapdoor-open.png
                duration=forever
                description={TEXT}
                [filter]
                    id=Hoplite
                [/filter]
            [/object]
            {VARIABLE hoplite_{ID}_unlocked yes}
            [set_global_variable]
                namespace=hoplite
                from_local=hoplite_{ID}_unlocked
                to_global=hoplite_{ID}_unlocked
                side=1#in multiplayer, the depth choice will be in an [options] tag
                immediate=yes
            [/set_global_variable]
        [/then]
        )}
#enddef

#define ACHIEVEMENT_MESSAGE_LONE TEXT ID SIDE
    {IF_VAR {ID}_complete{SIDE} not_equals yes (
    [and]
    {VARIABLE_CONDITIONAL hoplite_noachieve not_equals yes}
    [/and]
        [then]
            [sound]
                name=fanfare-short.wav
            [/sound]
            [object]
                name="Achievement Complete"
                image=misc/laurel.png
                duration=forever
                description={TEXT}
                [filter]
                    id=Hoplite
                [/filter]
            [/object]
            {VARIABLE {ID}_complete{SIDE} yes}
            [set_global_variable]
                namespace=hoplite
                from_local={ID}_complete{SIDE}
                to_global=hoplite_{ID}_complete
                side={SIDE}
                immediate=yes
            [/set_global_variable]
        [/then]
    )}
#enddef

#define HOPLITE_ACHIEVEMENT_DEPTHCHECK
    {IF_VAR hoplite_depth equals 5 (
        [and]
            [variable]
                name=hoplite_killedenemy
                not_equals=yes
            [/variable]
        [/and]
        [then]
            {ACHIEVEMENT_MESSAGE _"Pacifist: Reach depth 5 without killing enemies." pacifist}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 10 (
        [and]
            [variable]
                name=turn_number
                less_than_equal_to=110
            [/variable]
        [/and]
        [then]
            {ACHIEVEMENT_MESSAGE _"Speedrun: reach depth 10 in 110 turns or less." speedrun}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 8 (
        [and]
            [variable]
                name=hoplite_upgrades
                less_than=1
            [/variable]
        [/and]
        [and]
            [variable]
                name=hoplite_upgrades1
                less_than=1
            [/variable]
        [/and]
        [and]
            [variable]
                name=hoplite_upgrades2
                less_than=1
            [/variable]
        [/and]
        [then]
            {ACHIEVEMENT_MESSAGE _"Specialist: reach depth 8 without using forges. Note: you're automatically moved to a forge when killing all enemies, so make sure to keep at least one enemy alive on depths that have a forge." specialist}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 28 (
        [then]
            {ACHIEVEMENT_MESSAGE _"Crusader: Reach depth 28" depth28}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 50 (
        [then]
            {ACHIEVEMENT_MESSAGE _"Bearer of the Flame: Reach depth 51" depth51}
        [/then]
    )}
    {IF_VAR hoplite_depth equals 100 (
        [then]
            {ACHIEVEMENT_MESSAGE _"Where no man has ever gone: Reach depth 100" depth100}
        [/then]
    )}
    {IF_VAR hoplite_depth less_than_equal_to -15 (
        [then]
            {ACHIEVEMENT_MESSAGE _"Underworld Roamer: Reach depth -15" depthminus15}
        [/then]
    )}
#enddef

#define HOPLITE_RETREIVE_ACHIEVEMENT ID
    [get_global_variable]
        namespace=hoplite
        from_global=hoplite_{ID}_complete
        to_local={ID}_complete1
        side=1
    [/get_global_variable]
    #ifdef MULTIPLAYER
    [get_global_variable]
        namespace=hoplite
        from_global=hoplite_{ID}_complete
        to_local={ID}_complete2
        side=2
    [/get_global_variable]
    #endif
#enddef

#used for debug:
#define HOPLITE_SET_ACHIEVEMENT ID
    {VARIABLE {ID}_complete1 yes}
    [set_global_variable]
        namespace=hoplite
        from_local={ID}_complete1
        to_global=hoplite_{ID}_complete
        side=1
        immediate=yes
    [/set_global_variable]
    #ifdef MULTIPLAYER
    {VARIABLE {ID}_complete2 yes}
    [set_global_variable]
        namespace=hoplite
        from_local={ID}_complete2
        to_global=hoplite_{ID}_complete
        side=2
        immediate=yes
    [/set_global_variable]
    #endif
#enddef

#define HOPLITE_CLEAR_ACHIEVEMENT ID
    {VARIABLE {ID}_complete no}
    [clear_global_variable]
        namespace=hoplite
        global=hoplite_{ID}_complete
        side=1
        immediate=yes
    [/clear_global_variable]
#enddef

#macro for easily applying code to every achievements:
#define HOPLITE_ACHIEVEMENTLIST MACRO
[foreach]
    array=hoplite_achievements
    index_var=i
    [do]
    {HOPLITE_{MACRO} $this_item.id|}#adding the | at the end on purpose, otherwise the variable names would be incorrect
    [/do]
[/foreach]
#enddef

#define HOPLITE_CREATE_ACHIEVEMENT_DIALOG_OPTIONS
[foreach]
    array=hoplite_achievements
    index_var=i
    [do]

    {VARIABLE tmp_achievement_complete $$this_item.id|_complete$side_number||}

    [switch]
        variable=this_item.type
        [case]
            value=normal
            {IF_VAR tmp_achievement_complete equals yes (
            [then]
            {VARIABLE tmp_achievement_icon "misc/laurel.png"}
#            {VARIABLE tmp_achievement_descr _"(Completed) "+$this_item.descr}
            {VARIABLE tmp_achievement_descr $this_item.descr}
            [/then]
            [else]
            {VARIABLE tmp_achievement_icon "misc/laurel-bronze.png~BLIT(misc/red-x.png,28,28)"}
            {VARIABLE tmp_achievement_descr $this_item.descr}
            [/else]
            )}
        [/case]
        [case]
            value=progress
            {IF_VAR tmp_achievement_complete equals yes (
            [then]
            {VARIABLE tmp_achievement_icon "misc/laurel.png"}
#            {VARIABLE tmp_achievement_descr _"(Completed) "+$this_item.descr}
            {VARIABLE tmp_achievement_descr $this_item.descr}
            [/then]
            [else]
            {VARIABLE tmp_achievement_icon "units/unknown-unit.png~RC(magenta>white)"}
            {VARIABLE tmp_achievement_descr "("+$$this_item.id|_progress$side_number||+"/$this_item.progress_goal|) "+$this_item.descr}
            [/else]
            )}
        [/case]
        [case]
            value=hidden
            {IF_VAR tmp_achievement_complete equals yes (
            [then]
            {VARIABLE tmp_achievement_icon "misc/laurel.png"}
#            {VARIABLE tmp_achievement_descr _"(Completed) "+$this_item.descr}
            {VARIABLE tmp_achievement_descr $this_item.descr}
            [/then]
            [else]
            {VARIABLE tmp_achievement_icon "units/unknown-unit.png~RC(magenta>white)"}
            {VARIABLE tmp_achievement_descr $this_item.hidden_descr}
            [/else]
            )}
        [/case]
        [case]
            value=hidden_progress
            {IF_VAR tmp_achievement_complete equals yes (
            [then]
            {VARIABLE tmp_achievement_icon "misc/laurel.png"}
#            {VARIABLE tmp_achievement_descr _"(Completed) "+$this_item.descr}
            {VARIABLE tmp_achievement_descr $this_item.descr}
            [/then]
            [else]
            {VARIABLE tmp_achievement_icon "units/unknown-unit.png~RC(magenta>white)"}
            {VARIABLE tmp_achievement_descr "("+$$this_item.id|_progress$side_number||+"/$this_item.progress_goal|) "+$this_item.hidden_descr}
            [/else]
            )}
        [/case]
    [/switch]

    {CLEAR_VARIABLE tmp_achievement_complete}

    [set_variables]
        name=hoplite_achievement_options
        mode=append
        [value]
            image=$tmp_achievement_icon
            description=$tmp_achievement_descr|
            [command]
            [/command]
        [/value]
    [/set_variables]

    [/do]
[/foreach]
#enddef

#define HOPLITE_RAGE_EVENT ID
    [sound]
        name=fire.wav
    [/sound]
    [object]
        silent=yes
        duration=forever
        id=bloodlustIII
        take_only_once=no
        [filter]
            id={ID}
        [/filter]
        [effect]
            apply_to=attack
            increase_damage=5
        [/effect]
        [effect]
            apply_to=image_mod
            add="~CS(0,-40,-50)"
        [/effect]
    [/object]
    [redraw]
    [/redraw]
    [store_unit]
        [filter]
            id={ID}
        [/filter]
        kill=no
        variable=hoplite_enraged
    [/store_unit]

    [unstore_unit]
        variable=hoplite_enraged
        text= _ "Enraged!"
        {COLOR_HARM}
    [/unstore_unit]
#enddef

#define HOPLITE_ACHIEVEMENT_EVENTS
    [event]
        name=prestart

    #commented out achievements mean TODO or screapped
        {ADD_ACHIEVEMENT_TO_LIST2 shieldbash 10 _"This is Sparta! : Kill 10 enemies by bashing them into lava/chasms in one playthrough."}
        {ADD_ACHIEVEMENT_TO_LIST2 ratmaster 10 _"Who's a good rat? Yes, you are : have your rats kill 10 enemies in one playthrough."}
        {ADD_ACHIEVEMENT_TO_LIST depth28 _"Crusader: Reach depth 28"}
        {ADD_ACHIEVEMENT_TO_LIST3 depth51 _"Bearer of the Flame: Reach depth 51" _"Reach depth 51"}
        {ADD_ACHIEVEMENT_TO_LIST3 depth100 _"Where no man has ever gone: Reach depth 100" _"Reach depth 100"}#TODO: make a secret ending at depth 100
        {ADD_ACHIEVEMENT_TO_LIST3 depthminus15 _"Underworld Roamer: " _"Reach the depth -15"}
        {ADD_ACHIEVEMENT_TO_LIST spiderqueen _"Arachnid Slayer: defeat the spider queen on depth 10"}
        {ADD_ACHIEVEMENT_TO_LIST archmage _"Wizard Bane: defeat the archmage on depth 15"}
        #TODO:
        #{ADD_ACHIEVEMENT_TO_LIST3 spiderqueen2 _"Pest Exterminator: defeat the spider queen on depth 30"}
        {ADD_ACHIEVEMENT_TO_LIST ares _"Hero: defeat the avatar of war on depth 20"}#todo: rename the achievement
        {ADD_ACHIEVEMENT_TO_LIST donovan _"You shall not pass!: defeat the knight of chaos at depth 25"}
        {ADD_ACHIEVEMENT_TO_LIST duo _"Always two, there are: defeat the minotaur/warlock duo on depth 30"}
        {ADD_ACHIEVEMENT_TO_LIST reaper _"Angel of Death: defeat the grim reaper in the depths of the underworld"}
        {ADD_ACHIEVEMENT_TO_LIST3 archmage2 _"Shaxtal Bane: defeat the archmage once again on depth 35" _"defeat a familiar foe on depth 35"}
        {ADD_ACHIEVEMENT_TO_LIST3 return _"To hell and back: Return to the mortal realm from the underworld." _"Return to the mortal realm from the underworld."}
        {ADD_ACHIEVEMENT_TO_LIST victory _"Victory: leave the dungeon via the stairs after obtaining the Prometheus' Heart"}
        #{ADD_ACHIEVEMENT_TO_LIST3 finalboss _"The Chosen One: defeat the true final boss at depth 100"}#TODO
        {ADD_ACHIEVEMENT_TO_LIST2 warrior 30 _"Warrior: Kill 30 enemies in one playthrough."}
        {ADD_ACHIEVEMENT_TO_LIST2 warmonger 100 _"Warmonger: Kill 100 enemies in one playthrough."}
        {ADD_ACHIEVEMENT_TO_LIST2 godofwar 300 _"God of War: Kill 300 enemies in one playthrough."}
        {ADD_ACHIEVEMENT_TO_LIST3 algadur _"The Knalgan: recruit Algadur" _"recruit a certain companion in the caves"}
        {ADD_ACHIEVEMENT_TO_LIST3 elizabeth _"The Mage: recruit Elizabeth" _"recruit a certain companion in the Underworld"}
        {ADD_ACHIEVEMENT_TO_LIST pacifist _"Pacifist: Reach depth 5 without killing enemies. (You can still attack them, though, as long as you don't kill. Also,     kills done by allies don't count)"}
        {ADD_ACHIEVEMENT_TO_LIST speedrun _"Speedrun: reach depth 10 in 110 turns or less."}
        {ADD_ACHIEVEMENT_TO_LIST specialist _"Specialist: reach depth 8 without using forges. Note: you're automatically moved to a forge when killing all     enemies, so make sure to keep at least one enemy alive on depths that have a forge."}
        {ADD_ACHIEVEMENT_TO_LIST3 powerhouse _"Powerhouse: obtain 30 upgrades in one playthrough." _"obtain 30 upgrades in one playthrough."}
    #    {ADD_ACHIEVEMENT_TO_LIST3 over9000 _"It's over nine thousaaaaand!: obtain every single upgrade in one playthrough."}
        {ADD_ACHIEVEMENT_TO_LIST2 frenzy 7 _"Frenzy: Kill at least one enemy per turn for 7 turns in a row."}
        {ADD_ACHIEVEMENT_TO_LIST2 berserk 12 _"Berserk: Kill at least one enemy per turn for 12 turns in a row."}
    #    {ADD_ACHIEVEMENT_TO_LIST3 madman _"Madman: Kill at least one enemy per turn for 16 turns in a row."}
        {ADD_ACHIEVEMENT_TO_LIST4 impale 50 _"Vlad, the Impaler: kill 50 enemies using the impale special in one playthrough." _"kill 50 enemies using the impale special in one playthrough."}
    #TODO
        {ADD_ACHIEVEMENT_TO_LIST3 runesmith _"Smithing master: rescue a dwarf runesmith." _"rescue a dwarf runesmith."}
        {ADD_ACHIEVEMENT_TO_LIST4 revive 5 _"Not today, Death!: cheat death with the Phoenix Amulet upgrade 5 times in one playthrough." _"cheat death 5 times in one playthrough."}
        #TODO:
        #{ADD_ACHIEVEMENT_TO_LIST spearthrow _"Spear Thrower: Kill 20 enemies with a spear throw in one playthrough."}

        {HOPLITE_ACHIEVEMENTLIST RETREIVE_ACHIEVEMENT}
    [/event]
    #allows keeping frenzy/bloodlustIII streak if you hit a boss, and gives some energy
    [event]
        name=attacker hits
        id=hoplite_hitboss
        first_time_only=no
        [filter]
            id=Hoplite,Hoplite2
        [/filter]
        [filter_second]
            ability=hoplite_boss
        [/filter_second]
        {VARIABLE hoplite_hitboss_thisturn$unit.side| yes}

        {VARIABLE hitboss_energybonus $second_unit.level}
        {VARIABLE_OP hitboss_energybonus multiply 5}

        {HOPLITE_ADD_ENERGY_BY_VAR unit hitboss_energybonus}

        {CLEAR_VARIABLE hitboss_energybonus}
    [/event]
    [event]
         name=side 1 turn end
         first_time_only=no
         [if]
             {VARIABLE_CONDITIONAL hoplite_killedenemy_thisturn equals yes}
             [or]
                 {VARIABLE_CONDITIONAL hoplite_killedenemy_thisturn1 equals yes}
             [/or]
             [then]
                 [if]
                     [have_unit]
                         id=Hoplite2
                     [/have_unit]
                     [then]
                         {HOPLITE_PLAYERFILTER (
                             {CLEAR_VARIABLE hoplite_killedenemy_thisturn1}
                         ) (
                         )}
                     [/then]
                     [else]
                         {CLEAR_VARIABLE hoplite_killedenemy_thisturn}
                     [/else]
                 [/if]
                 {VARIABLE_OP frenzy_progress add 1}
                 {VARIABLE_OP berserk_progress add 1}
                 {HOPLITE_PLAYER_UPGRADEFILTER bloodlustIII (side=$side_number) (
                     [and]
                         {VARIABLE_CONDITIONAL bloodlustIII_active not_equals yes}
                         [and]
                             [have_unit]
                                 id=Hoplite
                                 side=$side_number
                             [/have_unit]
                         [/and]
                         [or]
                             {HOPLITE_PLAYERFILTER_VAR (
                                 {VARIABLE_CONDITIONAL bloodlustIII_active1 not_equals yes}
                                 [and]
                                     [have_unit]
                                         id=Hoplite
                                         side=$side_number
                                     [/have_unit]
                                 [/and]
                             ) ()}
                         [/or]
                     [/and]
                     [then]
                         [if]
                             [have_unit]
                                 id=Hoplite2
                             [/have_unit]
                             [then]
                                 {HOPLITE_PLAYERFILTER (
                                     {VARIABLE_OP bloodlustIII_progress1 add 1}
                                 ) (
                                 )}
                             [/then]
                             [else]
                                 {VARIABLE_OP bloodlustIII_progress add 1}
                             [/else]
                         [/if]
                     [/then]
                 )}
             [/then]
             [else]
             #hitting a boss lets you keep the killstreak
             [if]
                {VARIABLE_CONDITIONAL hoplite_hitboss_thisturn1 equals yes}
                [then]
                    {CLEAR_VARIABLE hoplite_hitboss_thisturn1}
                [/then]
                [else]
                 {VARIABLE frenzy_progress 0}
                 {VARIABLE berserk_progress 0}
                 [if]
                     [have_unit]
                         id=Hoplite2
                     [/have_unit]
                     [then]
                         {HOPLITE_PLAYERFILTER (
                             {VARIABLE bloodlustIII_progress1 0}
                             {VARIABLE bloodlustIII_active1 no}
                         ) (
                         )}
                     [/then]
                     [else]
                         {VARIABLE bloodlustIII_progress 0}
                         {VARIABLE bloodlustIII_active no}
                     [/else]
                 [/if]
                 [if]
                     [have_unit]
                         id=Hoplite2
                     [/have_unit]
                     [then]
                         {HOPLITE_PLAYERFILTER (
                             [remove_object]
                                 object_id=bloodlustIII
                                 [filter]
                                     id=Hoplite
                                 [/filter]
                             [/remove_object]
                         ) (
                         )}
                     [/then]
                     [else]
                         [remove_object]
                             object_id=bloodlustIII
                             [filter]
                                 id=Hoplite
                             [/filter]
                         [/remove_object]
                     [/else]
                 [/if]
                 [redraw]
                 [/redraw]
                 [/else]
                 [/if]
             [/else]
         [/if]
         {IF_VAR bloodlustIII_progress equals 3 (
             [then]
                 {HOPLITE_RAGE_EVENT Hoplite}
                 {VARIABLE bloodlustIII_active yes}
                 {VARIABLE bloodlustIII_progress 0}
             [/then]
         )}
         {IF_VAR bloodlustIII_progress1 equals 3 (
             [then]
                 {HOPLITE_RAGE_EVENT Hoplite}
                 {VARIABLE bloodlustIII_active1 yes}
                 {VARIABLE bloodlustIII_progress1 0}
             [/then]
         )}
         {IF_VAR frenzy_progress equals 7 (
             [then]
                 {ACHIEVEMENT_MESSAGE _"Frenzy: Kill at least one enemy per turn for 7 turns in a row." frenzy}
             [/then]
         )}
         {IF_VAR berserk_progress equals 12 (
             [then]
                 {ACHIEVEMENT_MESSAGE _"Berserk: Kill at least one enemy per turn for 12 turns in a row." berserk}
             [/then]
         )}
         #  [/then])}
     [/event]
 #ifdef MULTIPLAYER
     [event]
         name=side 2 turn end
         first_time_only=no
         [if]
         {VARIABLE_CONDITIONAL hoplite_killedenemy_thisturn2 equals yes}
             [then]
                 {CLEAR_VARIABLE hoplite_killedenemy_thisturn2}
                 {VARIABLE_OP frenzy_progress add 1}
                 {VARIABLE_OP berserk_progress add 1}
                 {HOPLITE_PLAYER_UPGRADEFILTER bloodlustIII (side=$side_number) (
                     [and]
                         {VARIABLE_CONDITIONAL bloodlustIII_active2 not_equals yes}
                         [and]
                             [have_unit]
                                 id=Hoplite2
                                 side=$side_number
                             [/have_unit]
                         [/and]
                     [/and]
                     [then]
                         {VARIABLE_OP bloodlustIII_progress2 add 1}
                     [/then]
                 )}
             [/then]
             [else]
             #hitting a boss lets you keep the killstreak
             [if]
                {VARIABLE_CONDITIONAL hoplite_hitboss_thisturn2 equals yes}
                [then]
                    {CLEAR_VARIABLE hoplite_hitboss_thisturn2}
                [/then]
                [else]
                 {VARIABLE frenzy_progress 0}
                 {VARIABLE bloodlustIII_progress2 0}
                 {VARIABLE bloodlustIII_active2 no}
                 {HOPLITE_PLAYERFILTER () (
                 [remove_object]
                     object_id=bloodlustIII
                     [filter]
                         id=Hoplite2
                     [/filter]
                 [/remove_object]
		 )}
                 [redraw]
                 [/redraw]
                 [/else]
                 [/if]
             [/else]
         [/if]
         {IF_VAR bloodlustIII_progress2 equals 3 (
             [then]
                 {HOPLITE_RAGE_EVENT Hoplite2}
                 {VARIABLE bloodlustIII_active2 yes}
                 {VARIABLE bloodlustIII_progress2 0}
             [/then]
         )}
         {IF_VAR frenzy_progress equals 7 (
             [then]
                 {ACHIEVEMENT_MESSAGE _"Frenzy: Kill at least one enemy per turn for 7 turns in a row." frenzy}
             [/then]
         )}
         {IF_VAR berserk_progress equals 12 (
             [then]
                 {ACHIEVEMENT_MESSAGE _"Berserk: Kill at least one enemy per turn for 12 turns in a row." berserk}
             [/then]
         )}
     [/event]
 #endif
#enddef
