#textdomain wesnoth-Hoplite
{~add-ons/Spartan/macros/utils.cfg}
#define HOPLITE_UNSTORE_COMPANIONS
	{IF_VAR algadur_stored.x greater_than 0 (
	[then]
        [unstore_unit]
            variable=algadur_stored
	    find_vacant=yes
	    x,y=6,10
        [/unstore_unit]
	{CLEAR_VARIABLE algadur_stored}
	[/then]
	)}
	{IF_VAR elizabeth_stored.x greater_than 0 (
	[then]
        [unstore_unit]
            variable=elizabeth_stored
	    find_vacant=yes
	    x,y=6,10
        [/unstore_unit]
	{CLEAR_VARIABLE elizabeth_stored}
	[animate_unit]
		flag=post_teleport
		[filter]
		         id=Elizabeth
		[/filter]
	[/animate_unit]
	[/then]
	)}
#enddef

[event]
    id=hoplite_depthdescent_dialog
    first_time_only=no
       {IF_VAR algadur_line_underworld not_equals yes (
       [and]
       {VARIABLE_CONDITIONAL hoplite_depth less_than 0 }
       [/and]
       [and]
       [have_unit]
           id=Algadur
       [/have_unit]
       [/and]
       [then]
       {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
       [message]
           speaker=Algadur
           message=_"By the blazes, my beard be damned! Just where in the bloody hell are we?!"
       [/message]
       [delay]
           time=1000
       [/delay]
       [message]
           speaker=Algadur
           message=_"(shaking) D... did ye hear that?... Aaaa! Ghosts! I be damned! I knew 'tis would go horribly, I knew it!... Looks like we have no bloody choice but ta chop whatever shadow moves until we get some bloody answers! If we die here, we shall at least show 'em all we 'ave!"
       [/message]
       [message]
           id=Hoplite,Hoplite2
           message=_"Very well, time to fight our way out of here!"
       [/message]
       {VARIABLE algadur_line_underworld yes}
       [/then])}

    [if]
#    {VARIABLE_CONDITIONAL archmagemet not_equals yes}
#	[and]
	[have_unit]
	  id=Spiderqueen
	[/have_unit]
#	[/and]
	[then]
    {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
    [message]
        speaker=Spiderqueen
        message=_"Hiss... who do we have here? Another deliciousss mortal entersss my lair."
    [/message]
    [message]
        id=Hoplite,Hoplite2
        message=_"What in the name of Athena are you?!"
    [/message]
    [message]
        speaker=Spiderqueen
        message=_"Athena? ATHENA?! <b>ATHEEEEENA?!!!</b> Don't you dare mention that despicable, worthless, vile, pathetic excuse of a goddess in front of me! <b>I WILL RIP YOUR GUTS OUT AND FEED THEM TO MY SPIDERLINGS!!!</b>"
    [/message]
    {SPARTAN_SMOOTH_REPLACE_MUSIC march-of-the-droids.ogg 1000 0}

    [/then]
    [/if]

    [if]
#    {VARIABLE_CONDITIONAL archmagemet not_equals yes}
#	[and]
	[have_unit]
	  id=Ares
	[/have_unit]
#	[/and]
	[then]
    {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
    [message]
        speaker=Ares
        message=_"So you've arrived, warrior of Sparta! It fills me with pride that one of my warriors has prevailed through these treacherous depths so far!"
    [/message]
    [message]
        id=Hoplite,Hoplite2
        message=_"Wait, are you... Ares?!"
    [/message]
    [message]
        speaker=Ares
        message=_"You speak to me, yes, but what stands before you is merely a small fragment of my might, to make things a bit more fair for a mortal like you."
    [/message]
    [message]
        id=Hoplite,Hoplite2
        message=_"Make things more fair?"
    [/message]
    [message]
        speaker=Ares
        message=_"You see, what lies beyond is far deadlier than the paltry opposition you've faced thus far. You may be a warrior of Sparta, but that alone isn't enough to prevail! Only with my legendary armaments you may survive what is beyond."
    [/message]
    [message]
        speaker=Ares
        message=_"But before then, I must be fully certain that this divine weaponry won't go to waste. Destroy this avatar, and you shall earn it. If the avatar kills you, you weren't worthy of such a fine reward in the first place."
    [/message]
    [message]
        id=Hoplite,Hoplite2
        message=_"Very well then, I accept your challenge, Ares!"
    [/message]

    {SPARTAN_SMOOTH_REPLACE_MUSIC gathering_storm.ogg 1000 0}

    [/then]
    [/if]

    [if]
    {VARIABLE_CONDITIONAL archmagemet not_equals yes}
	[and]
	[have_unit]
	  id=Archmage
	  [not]
	  [filter_wml]
	     variation=shaxtal
	  [/filter_wml]
	  [/not]
	[/have_unit]
	[/and]
	[then]
    {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
    #TODO: edit the dialog more once I figure out what the big threat will be instead of the Chaos Empire
	[message]
	   speaker=Archmage
#	   message=_"So the Chaos Empire finally found my hiding place... (looks at the hoplite) I know what you are, abomination! I won't let you lay a finger on my precious books, you Uria-worshipping scum!"
	   message=_"So they finally found my hiding place... (looks at the hoplite) I know what you are, abomination! I won't let you lay a finger on my precious books, deceitful demon!"
	[/message]
	[message]
	   id=Hoplite,Hoplite2
#	   message=_"I know not what is this Chaos Empire you speak of, nor am I part of it."
	   message=_"You call me a demon?! Come to your senses, old man! I'm just as human as you!"
	[/message]
	[message]
	   speaker=Archmage
	   message=_"Lies! You expect me to believe that a single soldier could possibly have fought his way here through the dozens of orcs, undead and worse wandering these caves? You are clearly one of them, a disguised assassin sent to kill me and destroy the books!"
	[/message]

        [if]
        [have_unit]
            id=Elizabeth
        [/have_unit]
        [then]
        #rare dialog if you somehow get elizabeth before encountering archmage, like when using debug
        [message]
            speaker=Elizabeth
            message=_"Master, calm down!"
        [/message]
        [delay]
        	time=500
        [/delay]
	    [message]
	       speaker=Archmage
	       message=_"E-Elizabeth?! Where have you been for so long?"
	    [/message]
        [message]
            speaker=Elizabeth
            message=_"I was stuck in the underworld, entered a portal I shouldn't have. But it's thanks to this man that I managed to escape it. I fought side by side with him, and I assure you, he can be trusted."
        [/message]
	    [message]
	       speaker=Archmage
	       message=_"Very well."
	    [/message]
        {SPARTAN_BOSSMUSICEND}
	    #archmage becomes peaceful:
	    [modify_unit]
	    	[filter]
	    		side=$hoplite_enemyside
	    	[/filter]
	    	side=$hoplite_allyside
	    [/modify_unit]
        {VARIABLE archmage_beaten yes}
        [remove_item]
            image="scenery/trapdoor-closed.png"
            x,y=6,2
        [/remove_item]
        [item]
            image="scenery/trapdoor-open.png"
            x,y=6,2
        [/item]

        {CLEAR_VARIABLE bossfight}

	    {VARIABLE archmage_beaten yes}
    	{VARIABLE elizabeth_line_archmage yes}#for filtering later
    	{VARIABLE noautomove_this_depth yes}#level can be explored as normal
	    [/then]
	    [else]

        [message]
            id=Hoplite,Hoplite2
            message=_"I'd rather not spill more blood than necessary, but if it is a fight you want, it's a fight you will get!"
        [/message]

        {IF_VAR algadur_line_archmage not_equals yes (
        [and]
        [have_unit]
            id=Algadur
        [/have_unit]
        [/and]
        [then]
        [message]
            speaker=Algadur
            message=_"Anyone who wants ta kill my shield-brother will have ta face me too!"
        [/message]
	{VARIABLE algadur_line_archmage yes}
	[/then])}
    {SPARTAN_SMOOTH_REPLACE_MUSIC burning.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
    {SPARTAN_SMOOTH_REPLACE_MUSIC battle-epic.ogg 1000 0}
#endif
    [/else]
    [/if]
	{VARIABLE archmagemet yes}
	[/then]
    [/if]
    [if]
    {VARIABLE_CONDITIONAL archmagemet2 not_equals yes}
	[and]
	[have_unit]
	  id=Archmage
	  [filter_wml]
	     variation=shaxtal
	  [/filter_wml]
	[/have_unit]
	[/and]
	[then]
        {HOPLITE_UNSTORE_COMPANIONS}
        {SPARTAN_SMOOTH_REPLACE_MUSIC overlive.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
        {SPARTAN_SMOOTH_REPLACE_MUSIC frantic.ogg 1000 0}
#endif
        [if]
        [have_unit]
            id=Elizabeth
        [/have_unit]
        [then]
        {IF_VAR elizabeth_line_archmage equals yes (
        [then]
        [message]
            speaker=Elizabeth
            message=_"M-master! Wha... What happened to you?!"
        [/message]
        [/then]
        [else]
        [message]
            speaker=Elizabeth
            message=_"M-master? Is that you? Do... do you remember me?"
        [/message]
        [/else]
        )}
	{SCROLL_TO 6 4}
        [delay]
	   time=1000
	[/delay]
	[message]
	   speaker=Archmage
	   message=_"(in a metallic female voice) You being so eager to call <b>me</b> master is appreciated, dear, but if you were referring to this old man, then I would like to inform you that he is no more. His husk is now merely another disposable drone for the empire."
	[/message]
        [message]
            speaker=Algadur
            message=_"My beard be damned! Look at this thing's bloody face!"
        [/message]
        [message]
            speaker=Elizabeth
            message=_"Wh... just what the hell are you?!"
        [/message]
	[message]
	   speaker=Archmage
	   message=_"Have you been living under a rock, Elizabeth? Never seen a shaxtal in your entire life?"
	[/message]
        [message]
            speaker=Elizabeth
            message=_"How... how do you know my name?"
        [/message]
	[message]
	   speaker=Archmage
	   message=_"Ah, it just so happens that I may have had the pleasure of knowing you in a past life of sorts. Unlike you, however, I'm now near the top of the current hierarchy, while you still remain near the very bottom like the failure that you are."
	[/message]
        [message]
            speaker=Elizabeth
            message=_"Wha... I..."
        [/message]
	[message]
	   speaker=Archmage
	   message=_"More importantly, you have been sentenced to death for interfering with the empire's geopolitical expansion. If you surrender, we promise to make your death quick and painless. If you won't, then I can assure you that I will truly make you regret make such a foolish choice."
	[/message]
	[if]
	[have_unit]
	   id=Algadur
	[/have_unit]
	[then]
        [message]
            speaker=Algadur
            message=_"Surrender ta you?! Blazes no! I'd rather shave my beard than become braindead enough ta accept that! Prepare ta taste my axe, abomination!"
        [/message]
	[/then]
	[else]
        [message]
            speaker=Elizabeth
            message=_"Surrender to you?! Hell no! I'd rather die than lick your imperial boots!"
        [/message]
	[/else]
	[/if]
    [message]
        id=Hoplite,Hoplite2
        message=_"You will pay dearly for what you did to Elizabeth's mentor, you Uria-worshipping demon! Chaaaaaarge!"
    [/message]
	[delay]
	    time=500
	[/delay]
	[message]
	   speaker=Archmage
	   message=_"Enemies of Uria truly do never learn... very well, if you want to lay your worthless lives for your worthless cause, then so be it! My warm blood bath is already prepared, so I'll leave killing you to this mindless drone."
	[/message]
	[delay]
	   time=500
	[/delay]
	[message]
	   speaker=Archmage
	   message=_"(switches to a male metallic voice) Initiating protocol 21B. Weapon systems online. Report to Uria's Fire after completion of the objective."
	[/message]
	{VARIABLE elizabeth_line_archmage2 yes}
	[/then]
	#if you have Algadur but not Elizabeth somehow:
	[elseif]
        [have_unit]
            id=Algadur
        [/have_unit]
        [then]
	[message]
	   speaker=Archmage
	   message=_"(in a female metallic voice) Were you expecting to encounter this old man here? Well, he is no more. His husk is now merely another disposable drone for the empire..."
	[/message]
        [message]
            speaker=Algadur
            message=_"My beard be damned! Look at this thing's bloody face!"
        [/message]
	[message]
	   speaker=Archmage
	   message=_"...and more importantly, you have been sentenced to death for interfering with the empire's geopolitical expansion. If you surrender, we promise to make your death quick and painless. If you won't, then I can assure you that I will truly make you regret make such a foolish choice."
	[/message]
        [message]
            speaker=Algadur
            message=_"Surrender ta you?! Blazes no! I'd shave my beard before I become braindead enough ta accept that! Prepare ta taste my axe, abomination!"
        [/message]
    [message]
        id=Hoplite,Hoplite2
        message=_"You will pay dearly for what you did to this old man, you Uria-worshipping demon! Chaaaaaarge!"
    [/message]
	[delay]
	    time=500
	[/delay]
	[message]
	   speaker=Archmage
	   message=_"The heretics truly do never learn... very well, if you want to lay your worthless lives for your 'cause', then so be it! My warm blood bath is already prepared, so I'll leave killing you to this mindless drone."
	[/message]
	[message]
	   speaker=Archmage
	   message=_"(switches to a male metallic voice) Initiating protocol 21B. Weapon systems online. Report to Uria's Fire after completion of the objective."
	[/message]
    [/then]
	[/elseif]
	[else]
	[message]
	   speaker=Archmage
	   message=_"(in a female metallic voice) Were you expecting to encounter this old man here? Well, he is no more. His husk is now merely another disposable drone for the empire."
	[/message]
	[message]
	   speaker=Archmage
	   message=_"More importantly, however, you have been sentenced to death for interfering with the empire's geopolitical expansion. If you surrender, we promise to make your death quick and painless. If you won't, then I can assure you that I will truly make you regret make such a foolish choice."
	[/message]
    [message]
        id=Hoplite,Hoplite2
        message=_"How arrogant of you to think a proud warrior of Sparta will just surrender to the likes of you. You will pay dearly for what you did to this old man, you Uria-worshipping demon!"
    [/message]
    [delay]
    	time=500
    [/delay]
	[message]
	   speaker=Archmage
	   message=_"You refuse? The heretics truly do never learn... very well, if you want to lay your worthless life for your worthless cause, then so be it! My warm blood bath is already prepared, so I'll leave killing you to this mindless drone."
	[/message]
	[message]
	   speaker=Archmage
	   message=_"(switches to a male metallic voice) Initiating protocol 21B. Weapon systems online. Report to Uria's Fire after completion of the objective."
	[/message]
	[/else]
	[/if]
    {SPARTAN_SMOOTH_REPLACE_MUSIC gathering_storm.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
    {SPARTAN_SMOOTH_REPLACE_MUSIC battle-epic.ogg 1000 0}
#endif
	{VARIABLE archmagemet2 yes}
	[/then]
    [/if]
	{IF_VAR reaper_beaten not_equals yes (
	[and]
	{VARIABLE_CONDITIONAL hoplite_depth equals -10}
	[/and]
	[then]
        {HOPLITE_UNSTORE_COMPANIONS}
        [delay]
	   time=500
	[/delay]
	{UNIT $hoplite_enemyside (Hoplite_Grimreaper) 6 4 (
        id=Reaper
	name=_"Grim Reaper"
	facing=s
	animate=yes
	{IS_HERO}
        )}
    {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
	[if]
	[have_unit]
	   [not]
	   id=Hoplite
       [/not]
	   [not]
	   id=Elizabeth
       [/not]
	[/have_unit]
	[then]
	[message]
	   speaker=Reaper
	   message=_"Who do we have here? A group of mortals foolish enough to enter the land of the dead. If you so truly desire to quicken your demise, then I shall gladly arrange that. Your souls will make a fine addition to my collection!"
	[/message]
	[/then]
	[else]
	[message]
	   speaker=Reaper
	   message=_"Who do we have here? A hoplite, and a red mage, two mortals foolish enough to enter the land of the dead. If you so truly desire to quicken your demise, then I shall gladly arrange that. Your souls will make a fine addition to my collection!"
	[/message]
	[/else]
	[/if]
    {SPARTAN_SMOOTH_REPLACE_MUSIC moleman.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
    {SPARTAN_SMOOTH_REPLACE_MUSIC battle-epic.ogg 1000 0}
#endif
	[/then])}
	{IF_VAR hoplite_depth equals 40 (
	[then]
        {SPARTAN_SMOOTH_REPLACE_MUSIC into_the_shadows.ogg 1000 0}
        {HOPLITE_UNSTORE_COMPANIONS}
	{MOVE_UNIT id=Hoplite,Hoplite2 6 5}
	{MOVE_UNIT ability=hoplite_companion 6 5}
	[if]
	[have_unit]
		[not]
			id=Hoplite
		[/not]
	[/have_unit]
	[then]
    [message]
        id=Hoplite,Hoplite2
        message=_"This is it. Finally, we found it - the heart of Prometheus."
    [/message]
	[/then]
	[else]
    [message]
        id=Hoplite,Hoplite2
        message=_"This is it. Finally, I found it - the heart of Prometheus"
    [/message]
	[/else]
    [/if]

    #TODO: completely rewrite the prometheus heart dialog

	[if]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[and]
	[have_unit]
	  id=Elizabeth
	[/have_unit]
	[/and]
	[then]
	[message]
	          speaker=Algadur
		  message=_"By the gods' beards! Is 'tis what I think it is? So we 'ave found the Ruby of Fire?"
        [/message]
	[message]
	          speaker=Elizabeth
		  message=_"Not quite. It is the Prometheus' Heart, a gem similar to the Ruby of Fire in nature. Its power doesn't quite hold up to that of its more famous counterpart, but it is still rather impressive."
        [/message]
	[/then]
	[elseif]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[and]
	[not]
	[have_unit]
	  id=Elizabeth
	[/have_unit]
	[/not]
	[/and]
	[then]
	[message]
	          speaker=Algadur
		  message=_"By the gods' beards! Is 'tis what I think it is? So we 'ave found the Ruby of Fire?"
        [/message]
	[/then]
	[/elseif]
	[elseif]
	[have_unit]
	  id=Elizabeth
	[/have_unit]
	[and]
	[not]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[/not]
	[/and]
	[then]
	[message]
	          speaker=Elizabeth
		  message=_"My goodness, it's the Prometheus' Heart, a gem not unlike the Ruby of Fire! Its power doesn't quite hold up to that of its more famous counterpart, but it is still rather impressive."
        [/message]
	[/then]
	[/elseif]
	[/if]
	[remove_item]
	  x,y=6,4
	[/remove_item]
	[item]
	  x,y=6,4
	  image="items/brazier.png"
	[/item]
        [sound]
          name=fanfare-short.wav
        [/sound]
        {HOPLITE_APPLY_PROMETHEUS_HEART}
	[if]
	[have_unit]
	   id=Algadur
	[/have_unit]
	[then]
	[message]
	          speaker=Algadur
		  message=_"Now that we got 'tis beauty, we must hurry up an' leave the leave before any of the demon-worshipers catch up ta us!"
        [/message]
	[message]
	          speaker=Elizabeth
		  message=_"Indeed, we can't waste a minute. However, going down into the dungeon could also be also a promising option. After all, the surface is probably overrun by the Chaos Empire. (to the hoplite) What do you think?"
        [/message]
	[/then]
	[else]
	[message]
	          speaker=Elizabeth
		  message=_"Now that we got this gem, we must hurry up and leave the leave before any of Uria's worshipers catch up to us, we can't waste a minute. However, going down into the dungeon could also be also a promising option. After all, the surface is probably overrun by the Chaos Empire. What do you think?"
        [/message]
	[/else]
	[/if]
    {SPARTAN_SMOOTH_REPLACE_MUSIC kreepor.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
    {SPARTAN_SMOOTH_REPLACE_MUSIC underground.ogg 1000 0}
#endif
        {MOVE_UNIT id=Hoplite,Hoplite2 6 2}
#dialog: choose, oh hoplite, do you leave the dungeon to keep the mighty gem you have acquired, or descend even deeper into this endless abyss?	 
	[/then])}
	{IF_VAR algadurlinesmith not_equals yes (
	[and]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[/and]
	[and]
	[have_unit]
	  id=runesmith
	[/have_unit]
	[/and]
	[then]
	{VARIABLE algadurlinesmith yes}
	[message]
	          speaker=Algadur
		  message=_"One of our runesmiths is bein' attacked! Quick, we must help 'im!"
        [/message]
	[/then])}
	{IF_VAR algadurlinestart not_equals yes (
	[and]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[/and]
	[then]
	[message]
	          speaker=Algadur
		  message=_"Bring it on, ya surface-dwellin' pigs! If I'm goin' down, then I'm sure as hell bringin' ye all with me!"
        [/message]
	{VARIABLE algadurlinestart yes}
	[/then])}
	{IF_VAR elizabethmet not_equals yes (
	[and]
	[have_unit]
	  id=Elizabeth
	[/have_unit]
	[/and]
	[then]
	    {SCROLL_TO 6 5}
        {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
	    {MOVE_UNIT id=Hoplite,Hoplite2 6 5}
	    [message]
	       speaker=Elizabeth
	       image="portraits/humans/mage-red+female.png~BLEND(0,0,0,0.95)"
	       message=_"So you have finally arrived. I hope the message glyphs I scattered nearby were of help to you. You may be wondering who I may be, so let me get that out of the way..."
	    [/message]
        [remove_object]
       	    id=Elizabeth
		    object_id=conceal
        [/remove_object]
	    [modify_unit]
	    [filter]
	       id=Elizabeth
	    [/filter]
	    name=_"Elizabeth"
	    [/modify_unit]
	    [if]
	    [have_unit]
	       id=Algadur
	    [/have_unit]
	    [then]
	    [message]
	       speaker=Elizabeth
	       message=_"*ahem* I am Elizabeth, red mage of the formerly existing Alduin academy..."
	    [/message]
	    [message]
	       speaker=Algadur
	       message=_"Alduin academy? Ya mean the one that the demon-worshippers razed ta the ground?"
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"Yes, *sigh* that one. And who may you be, dwarf?"
	    [/message]
	    [message]
	       speaker=Algadur
	       message=_"Name's Algadur, been a soldier for some time, our outpost got attacked, and then I got my sorry arse saved by 'tis lad. A 'hoplite' as they call 'im. I wonder, how did ya even get stuck in 'tis hellhole."
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"Long story short, I got teleported here by a demonic portal that I've been researching. *sigh* There is nothing I desire more than getting out of this nightmare."
	    [/message]
	    [message]
	        id=Hoplite,Hoplite2
	        message=_"Admittedly I got too curious with portals too. Since you have been stuck here longer than I, tell me what you know of this place. Is there a possibility of escape?"
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"There is, but... Well, how do I put it, there is one of the Grim Reaper's chambers ahead, with a portal back to the mortal world. I, obvious enough, am in no way skilled enough to tackle such a being alone. And that's where you come in."
	    [/message]
	    [message]
	       speaker=Algadur
	       message=_"You want us to fight Death himself?! Are ya out of yer damn mind, woman?!"
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"I fully understand that isn't exactly the best-sounding idea, but what choice do we have? We could sit here for eternity and slowly go insane, <b>or</b> we could gamble our souls for a chance to leave this place. The latter option isn't exactly that great, but seems to me like the lesser of two evils."
	    [/message]
	    [message]
	        id=Hoplite,Hoplite2
	        message=_"She's right, Algadur. It may seem impossible, but we have nothing left to lose and a lot to gain. Imagine the sheer glory if we actually manage to somehow win! Time to make the impossible possible!"
	    [/message]
	    [message]
	       speaker=Algadur
	       message=_"Argh, fine, I guess ye're givin' us no choice, lass... Very well, let's do 'tis."
	    [/message]
	    [/then]
	    [else]
	    [message]
	       speaker=Elizabeth
	       message=_"*ahem* I am Elizabeth, red mage of the formerly existing Alduin academy. You may be wondering how I got here. Long story short, I got teleported here by a demonic portal that I've been researching. *sigh* There is nothing I desire more than getting out of this nightmare..."
	    [/message]
	    [message]
	        id=Hoplite,Hoplite2
	        message=_"Admittedly I got too curious with portals too. Since you have been stuck here longer than I, tell me what you know of this place. Is there a possibility of escape?"
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"There is, but... Well, how do I put it, there is one of the Grim Reaper's chambers ahead, with a portal back to the mortal world. I, obvious enough, am in no way skilled enough to tackle such a being alone. And that's where you come in."
	    [/message]
	    [message]
	        id=Hoplite,Hoplite2
	        message=_"You think a mortal warrior like me has a chance of fighting Death himself?! I... I am flattered, but..."
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"Yes, I fully understand that isn't exactly the best-sounding idea, but what choice do we have? We could sit here for eternity and slowly go insane, <b>or</b> we could gamble our souls for a chance to leave this place. The latter option isn't exactly that great, but seems to me like the lesser of two evils."
	    [/message]
	    [message]
	        id=Hoplite,Hoplite2
	        message=_"I suppose you are right, we have nothing left to lose and a lot to gain. Very well, time to make the impossible possible!"
	    [/message]
	    [/else]
	    [/if]
#  	    {UNIT $hoplite_allyside (Hoplite_Fireguardian) 5 5 (
#	    placement=map
#     	    passable=yes
#            )}
#  	    {UNIT $hoplite_allyside (Hoplite_Fireguardian) 7 5 (
#	    placement=map
#     	    passable=yes
#            )}
            {ACHIEVEMENT_MESSAGE elizabeth}
            {SPARTAN_SMOOTH_REPLACE_MUSIC ooze.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
            {SPARTAN_SMOOTH_REPLACE_MUSIC the_deep_path.ogg 1000 0}
#endif
	    {VARIABLE elizabethmet yes}
	[/then])}
	{IF_VAR elizabeth_cooldown less_than 1 (
	[and]
	{VARIABLE_CONDITIONAL elizabeth_stored.x greater_than 0}
	[/and]
	[and]
	{VARIABLE_CONDITIONAL hoplite_depth greater_than 0}
	[or]
	{VARIABLE_CONDITIONAL elizabethstays not_equals yes}
	[/or]
	[/and]
	[then]
        [unstore_unit]
            variable=elizabeth_stored
	    find_vacant=yes
	    x,y=6,10
        [/unstore_unit]
	{CLEAR_VARIABLE elizabeth_stored}
	[animate_unit]
		flag=post_teleport
		[filter]
		         id=Elizabeth
		[/filter]
	[/animate_unit]
	{IF_VAR elizabethstays equals yes (
	[then]
	[message]
	        speaker=Elizabeth
	        message=_"Hey, you're back! How's your trip to the underworld been? Fine, you say? Good to hear that."
	[/message]
	{CLEAR_VARIABLE elizabethstays}
	[/then]
	[else]
	{RANDOM 1..3}
	{IF_VAR random equals 1 (
	[then]
	[message]
	        speaker=Elizabeth
	        message=_"Hey, I'm back! Hope I didn't miss anything important..."
	[/message]
	[/then])}
	{IF_VAR random equals 2 (
	[then]
	[message]
	        speaker=Elizabeth
	        message=_"Whew, I'm back! Did I miss much of the fun? No? Good to know."
	[/message]
	[/then])}
	{IF_VAR random equals 3 (
	[then]
	[message]
	        speaker=Elizabeth
	        message=_"Man, that was quite the rest! Too bad I now have to fight again..."
	[/message]
	[/then])}
	[/else])}
	{CLEAR_VARIABLE elizabeth_stored}
	[/then])}
	{IF_VAR algadur_cooldown less_than 1 (
	[and]
	{VARIABLE_CONDITIONAL algadur_stored.x greater_than 0}
	[/and]
	[and]
	{VARIABLE_CONDITIONAL hoplite_depth greater_than 0}
	[or]
	{VARIABLE_CONDITIONAL algadurstays not_equals yes}
	[/or]
	[/and]
	[then]
        [unstore_unit]
            variable=algadur_stored
	    find_vacant=yes
	    x,y=6,10
        [/unstore_unit]
	{CLEAR_VARIABLE algadur_stored}
	{IF_VAR algadurstays equals yes (
	[then]
	[message]
	        speaker=Algadur
	        message=_"Ye're back! Glad ta see ya in one piece, lad."
	[/message]
	{CLEAR_VARIABLE algadurstays}
	[/then]
	[else]
	{RANDOM 1..3}
	{IF_VAR random equals 1 (
	[then]
	[message]
	        speaker=Algadur
	        message=_"I'm back, sorry for keepin' ya waiting'."
	[/message]
	[/then])}
	{IF_VAR random equals 2 (
	[then]
	[message]
	        speaker=Algadur
	        message=_"I'm back and ready ta fight! Now, whose head should I chop off 'tis time?"
	[/message]
	[/then])}
	{IF_VAR random equals 3 (
	[then]
	[message]
	        speaker=Algaadur
	        message=_"I'm back. How am I, ye ask? Don't worry, lad, 'tis just a flesh wound, survived worse."
	[/message]
	[/then])}
	[/else])}
	{CLEAR_VARIABLE algadur_stored}
	[/then])}
	{IF_VAR chaos_line1 not_equals yes (
	[and]
	[have_unit]
	  side=$hoplite_enemyside
	  type=Hoplite_Chaosinvader
	[/have_unit]
	[/and]
	[and]
	{VARIABLE_CONDITIONAL bossfight not_equals yes}
	[/and]
	[and]
	[not]
	[have_unit]
	    id=Donovan
	[/have_unit]
	[/not]
	[/and]
	[then]
	[if]
	[have_unit]
	    side=$hoplite_allyside
	    ability=hoplite_companion
	[/have_unit]
	[or]
	[have_unit]
	    id=Hoplite2
	[/have_unit]
	[/or]
	[then]
	[message]
	        type=Hoplite_Chaosinvader
	        message=_"Look, brothers! It is the very heretics Brother Donovan warned us about! Let us show these heathen wretches the might of Uria! Chaaaarge!"
	[/message]
	[/then]
	[else]
	[message]
	        type=Hoplite_Chaosinvader
	        message=_"Look, brothers! It is the very heretic Brother Donovan warned us about! Let us show this heathen wretch the might of Uria! Chaaaarge!"
	[/message]
	[/else]
	[/if]
	[message]
	        speaker=Algadur
	        message=_"These demon-worshipin' lunatics are 'ere too?! Bloody hell, they must've overrun half the caves already!"
	[/message]
	{VARIABLE chaos_line1 yes}
	[/then])}
        {IF_VAR donovanmet not_equals yes (
	[and]
	[have_unit]
	  id=Donovan
	  side=$hoplite_enemyside
	[/have_unit]
	[/and]
	[then]
    {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
	[hide_unit]
	    side=$hoplite_allyside
	[/hide_unit]
	{MOVE_UNIT id=Hoplite,Hoplite2 6 7}
	[message]
	        speaker=Donovan
	        message=_"Halt in the name of Uria, soldier! The armor you're wearing is not of the standard approved by the imperial armory. Explain yourself!"
	[/message]
	[message]
	        id=Hoplite,Hoplite2
	        message=_"I am not from this empire you speak of. I am a hoplite from Sparta."
	[/message]
	[message]
	        speaker=Donovan
	        message=_"Oh, so are not part of the imperial army, right... Well, we are quite eager to hire some mercenaries, to replace the regiments lost due to our recent conquest. Capable warriors like you are in high demand but short supply, after all. Here's the offer: pledge your allegiance to our glorious empire, and you shall receive the honor of serving our goddess Uria as a fellow knight of chaos, and a payment of 55 Urvathan silver a month."
	[/message]
	[message]
	        id=Hoplite,Hoplite2
	        message=_"My allegiance is to Sparta, and Sparta only. Nor do I worship gods outside our pantheon. Now stand aside, knight, I am on a very important quest."
	[/message]
	[message]
	        speaker=Donovan
	        message=_"You... you dare to reject my generosity, you ungrateful heathen wretch?! Are you truly so blind as to not see that Uria is the one and only true god?! Hrmph... very well, if you refuse to serve her in life, then you shall have to serve her in death! En garde, heretic! May Uria have mercy on your soul, for I will not!"
	[/message]
    {SPARTAN_SMOOTH_REPLACE_MUSIC mad-mad-men.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
    {SPARTAN_SMOOTH_REPLACE_MUSIC battle-epic.ogg 1000 0}
#endif
	[unhide_unit]
	    side=$hoplite_allyside
	[/unhide_unit]
        {HOPLITE_UNSTORE_COMPANIONS}
	[/then]
	)}
[if]
[have_unit]
  id=merchant
[/have_unit]
[then]
	{VARIABLE_OP spartan_merchant_lines add 1}
	#TODO: add a switch case for different dialog
	 #TODO: add lines for meeting the merchant on previous playthroughs


    #TODO: maybe add different dialog based on orbshop data of each player
    {SPARTAN_GET_SHOP_DATA_GLOBAL_VARS}

    [if]
    {VARIABLE_CONDITIONAL spartan_met_merchants_this_playthrough equals yes}
    [then]
    	#TODO: maybe add Elizabeth dialog here too
    	[if]
    	{VARIABLE_CONDITIONAL hoplite_depth less_than_equal_to 0}
    	[and]
    		{VARIABLE_CONDITIONAL hoplite_underworld_line not_equals yes}
    	[/and]
    	[then]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"Wait, you're here too?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"A good merchant must know where to find customers, and so far my main customer is you, so I moved here for now."
            [/message]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"Alright... Do you happen to know a way out of here?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"My methods of travel... would not work for you. My advice to be to find a stable portal to Irdya. The spirits wandering this place cannot use them, but a mortal like yourself can."
            [/message]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"What are you then? You imply you aren't a mortal, yet somehow you don't quite seem like a wandering spirit either..."
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"Some questions are best left unanswered."
            [/message]
    	[/then]
        [else]
        #TODO: add several randomly-chosen lines here
	    [message]
	        speaker=merchant
	    	message=_"Welcome back, hoplite! I hope you brought some <span color='#a456ff'>Orbs of Insight</span>. If not, you can have a look at my pacts again instead."
        [/message]
#pact dealer got removed for now, since it was difficult to fit him into dialog
#	    [message]
#	        speaker=pact_dealer
#	    	message=_"If not, you can have a look at my pacts again instead..."
#        [/message]
        [/else]
        [/if]
    [/then]
    [else]
    	#lines for meeting merchants first time each playthrough
    {VARIABLE spartan_met_merchants_this_playthrough yes}

    {VARIABLE_OP spartan_orbshop_data1.visited_across_playthroughs add 1}
    #ifdef MULTIPLAYER
    #ifndef LOCALMP
    {VARIABLE_OP spartan_orbshop_data2.visited_across_playthroughs add 1}
    #endif
    #endif
    {SPARTAN_SYNC_ORBSHOP_DATA}

    #in MP, only host data for merchants is checked, for now
    [switch]
        variable=spartan_orbshop_data1.visited_across_playthroughs
        [case]
            value=1
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"What is this place..."
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"Ah, greetings, hoplite from Sparta."
            [/message]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"(draws weapons) Who are you? What are you? How do you know me?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"I assure you, I mean you no harm. I am a wandering merchant, but not just an ordinary one."
            [/message]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"(lowers weapons) Well, I do have some silver coins from my world. What do you sell?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"Ah, but unlike most I do not deal in silver or gold, or other petty mortal things. I seek <span color='#a456ff'>Orbs of Insight</span>, easily recognizable by their purple glow, these curious objects ended up here in Irdya after the rift between worlds opened. As for my wares, come here and have a look for yourself, perhaps something will catch your eye."
            [/message]
            [if]
            {VARIABLE_CONDITIONAL spartan_orbs_of_insight1 greater_than 0}
            [or]
            	{VARIABLE_CONDITIONAL spartan_orbs_of_insight2 greater_than 0}
            [/or]
            [then]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"(Checks pockets, takes out an <span color='#a456ff'>Orb of Insight</span>) Alright, I do have such orbs with me. Might as well see what you got."
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"Excellent. Besides my wares, I can also offer you pacts."
            [/message]
#pact dealer got removed for now, since it was difficult to fit him into dialog
#	         [message]
#	            speaker=pact_dealer
#	        	message=_"Besides my brother's wares, perhaps my pacts could interest you too?"
#            [/message]
            [/then]
            [else]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"Alas it seems I have no orbs with me at the moment."
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"Perhaps we can cross paths another time then. In the meantime, perhaps my pacts could interest you?"
            [/message]
            [/else]
            [/if]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"Pacts?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"I offer powerful boons... but each comes with a curse. Best read the fine print carefully."
            [/message]
#pact dealer got removed for now, since it was difficult to fit him into dialog
#	        [message]
#	            speaker=pact_dealer
#	        	message=_"I offer powerful boons... but each comes with a curse. Best read the fine print carefully."
#            [/message]
            [if]
            [have_unit]
                id=Algadur
            [/have_unit]
            [then]
            [message]
                speaker=Algadur
                message=_"(whispers) <i>Somethin' feels very off 'bout him, gives me goosebumps...</i>"
            [/message]
            [message]
                id=Hoplite,Hoplite2
                message=_"(whispers) <i>Looks unusual, yes, but he's one of the few beings in this place that aren't actively trying to kill me at least. We should be careful, but might as well have a look at his wares.</i>"
            [/message]
            [message]
                speaker=Algadur
                message=_"<i>Alright, if you say so...</i>"
            [/message]
            [/then]
            [/if]
        [/case]
        #lines for visiting the shop after the first playthrough
        [else]
        	#add more lines here
        	{IF_VAR spartan_orbshop_data1.visited_across_playthroughs greater_than 5 (
        	[then]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"This place... feels foreign, yet somehow disturbingly familiar... I cannot shake this strange feeling of deja vu, that I somehow already been here, over and over..."
	        [/message]
        	[/then]
        	[else]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"This place... feels foreign, yet somehow disturbingly familiar... I cannot shake this strange feeling of deja vu, that I somehow already been here..."
	        [/message]
        	[/else]
        	)}
        	{IF_VAR spartan_orbshop_data1.orbs_spent greater_than_equal_to 10 (
        	[then]
	        [message]
	            speaker=merchant
	        	message=_"Ah, welcome back, my favorite customer! Pleasure to see you again."
            [/message]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"Favorite customer?! But... we haven't met... have we?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"It's hard to explain to most mortals, but let's just say we both did, and we did not..."
            [/message]
	        [message]
	            speaker=merchant
	        	message=_"Do you perhaps notice how, when you enter the cave, sometimes <span color='#a456ff'>Orbs of Insight</span> just appear out of thin air into your pocket?"
            [/message]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"Now that you mention it, I did notice that..."
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"Time is not the simple one-directional flow many think it is, certainly not in this place."
            [/message]
        	{IF_VAR spartan_orbshop_data1.visited_across_playthroughs greater_than 5 (
        	[then]
	        [message]
	            id=Hoplite
	            message=_"I wonder... how many times have we 'met for the first time'?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"It is precisely $spartan_orbshop_data1.visited_across_playthroughs| times, <span size='small'><i>at least in this subcategory of timelines</i></span>."
            [/message]
            #ifdef MULTIPLAYER
	        [message]
	            id=Hoplite2
	            message=_"And what about me?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"$spartan_orbshop_data2.visited_across_playthroughs| times in your case."
            [/message]
            #endif
	        [message]
	            id=Hoplite
	            message=_"Wow... that is quite something... and how many orbs have I spent in your shop total?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"It is exactly $spartan_orbshop_data1.orbs_spent| orbs."
            [/message]
            #ifdef MULTIPLAYER
	        [message]
	            id=Hoplite2
	            message=_"And how much did I spend?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"$spartan_orbshop_data2.orbs_spent| orbs in your case."
            [/message]
            #endif
        	[/then]
        	)}
            [if]
            [have_unit]
                id=Algadur
            [/have_unit]
            [then]
            [message]
                speaker=Algadur
                message=_"I must admit, I'm... confused about tis' whole thing."
            [/message]
            [message]
                id=Hoplite,Hoplite2
                message=_"Can't say I fully understand what is happening either, but it seems I already met this 'merchant' before, in a past life of sorts."
            [/message]
            [/then]
            [/if]

        	[/then]
        	[else]
	        [message]
	            speaker=merchant
	        	message=_"Ah, greetings again, hoplite from Sparta."
            [/message]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"(draws weapons) Who are you? What are you? How do you know me? What do you mean about 'again'?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"I assure you, I mean you no harm. I am a wandering merchant, but not just an ordinary one. My currency is <span color='#a456ff'>Orbs of Insight</span>. With my collection of these <span size='small'><i>and my own powers</i></span>, it was easy to see your coming in advance."
            [/message]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"(lowers weapons) I see..."
	        [/message]
        	[/else]
        	)}
            [if]
            {VARIABLE_CONDITIONAL spartan_orbs_of_insight1 greater_than 0}
            [or]
            	{VARIABLE_CONDITIONAL spartan_orbs_of_insight2 greater_than 0}
            [/or]
            [then]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"(Checks pockets, takes out an <span color='#a456ff'>Orb of Insight</span>) Alright, I do have such orbs with me. Might as well see what you got."
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"Excellent. Besides my wares, I can also offer you pacts."
            [/message]
#pact dealer got removed for now, since it was difficult to fit him into dialog
#	         [message]
#	            speaker=pact_dealer
#	        	message=_"Besides my brother's wares, perhaps my pacts could interest you too?"
#            [/message]
            [/then]
            [else]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"Alas it seems I have no orbs with me at the moment."
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"Perhaps we can cross paths another time then. In the meantime, perhaps my pacts could interest you?"
            [/message]
            [/else]
            [/if]
	        [message]
	            id=Hoplite,Hoplite2
	            message=_"Pacts?"
	        [/message]
	        [message]
	            speaker=merchant
	        	message=_"I offer powerful boons... but each comes with a curse. Best read the fine print carefully."
            [/message]
#pact dealer got removed for now, since it was difficult to fit him into dialog
#	        [message]
#	            speaker=pact_dealer
#	        	message=_"I offer powerful boons... but each comes with a curse. Best read the fine print carefully."
#            [/message]
            [if]
            [have_unit]
                id=Algadur
            [/have_unit]
            [then]
            [message]
                speaker=Algadur
                message=_"(whispers) <i>Somethin' feels very off 'bout him, gives me goosebumps...</i>"
            [/message]
            [message]
                id=Hoplite,Hoplite2
                message=_"(whispers) <i>Looks unusual, yes, but he's one of the few beings in this place that aren't actively trying to kill me at least. We should be careful, but might as well have a look at his wares.</i>"
            [/message]
            [message]
                speaker=Algadur
                message=_"<i>Alright, if you say so...</i>"
            [/message]
            [/then]
            [/if]
        [/else]
    [/switch]

    [/else]
    [/if]

    #TODO: once I make the shop spawn in the underworld too, add underworld-specific lines
[/then]
[/if]
[/event]
[event]
	name=last breath
	first_time_only=yes
	[filter]
		type=Hoplite_Spider_Queen
	[/filter]
	[message]
	   speaker=unit
	   message=_"Damn you, hoplite! Damn you, Athena! Damn you AAAAAAAAAAAAAAAAAAAAALL!!!!..."
	[/message]
[/event]
[event]
	name=last breath
	first_time_only=yes
	[filter]
		type=Hoplite_Archmage
		[not]
		    [filter_wml]
		        variation=shaxtal
		    [/filter_wml]
		[/not]
	[/filter]
	{SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 500 0}
	[message]
	   speaker=unit
	   message=_"All the effort I put in to preserve the little I could save from the Alduin academy, ended by one demon assassin..."
	[/message]
	[message]
	   id=Hoplite,Hoplite2
	   message=_"Once again, I am not a demon, nor am I on their side!"
	[/message]
	[message]
	   speaker=unit
	   message=_"If you are actually telling the truth, I have one... last wish. Take the most valuable spellbooks with you (points to a specific bookshelf) these ones, so they don't fall into the enemy's hands. You don't exactly look like a mage, but somehow I sense a lot of magical potential in you, perhaps you can make use of them..."
	[/message]
	[message]
	   id=Hoplite,Hoplite2
	   message=_"Very well, I will honor your request. (takes the books) Let's see... 'Advanced Teleportation', 'Enthralling' ,'Pyromancy' and more. Definitely worth giving it a read."
	[/message]

	#TODO idea: add option to spare the archmage if you have the healing potion upgrade

#	[message]
#	   speaker=unit
#	   message=_"You have won this fight, but that does not mean won the war. If the Chaos Empire seizes the Prometheus' Heart, then they will only be even closer to their goals. *sigh* All the effort I put in to preserve the little I could save from the Alduin academy, only to soon go to waste. If you truly intend to destroy the place, at least spare the spellbooks..."
#	[/message]
[/event]
[event]
	name=last breath
	first_time_only=yes
	[filter]
		type=Hoplite_Ares
	[/filter]
	[message]
	   speaker=unit
	   message=_"You've proven yourself more than worthy. Take the holy armaments and continue your quest!"
	[/message]
[/event]
[event]
	name=last breath
	first_time_only=yes
	[filter]
		type=Hoplite_Archmage
		[filter_wml]
		    variation=shaxtal
		[/filter_wml]
	[/filter]
    {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 500 0}
	[message]
	   speaker=unit
	   message=_"Error: critical condition. Reporting mission failure. Initiating shutdown and memory wipe."
	[/message]
[/event]
[event]
	name=die
	first_time_only=yes
	[filter]
		type=Hoplite_Archmage
		[filter_wml]
		    variation=shaxtal
		[/filter_wml]
	[/filter]
	[message]
	    speaker=Elizabeth
	    message=_"Wow... just wow... to think we have just brought down this abomination..."
	[/message]
	[message]
	    speaker=Algadur
	    message=_"Aye, find it hard ta believe it too."
	[/message]
	[message]
	    speaker=Elizabeth
	    message=_"We may have barely escaped the Chaos Empire's grip, but at the same time made them view us as more than just mere rabble. We must find the gem as soon as we can, and flee as far as possible, else this won't be the worst we'll see of their wrath."
	[/message]
[/event]
[event]
	name=last breath
	first_time_only=yes
	[filter]
		type=Hoplite_Donovan
	[/filter]
    {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 500 0}
	[if]
	[have_unit]
	    side=$hoplite_allyside
	    ability=hoplite_companion
	[/have_unit]
	[or]
	[have_unit]
	    id=Hoplite2
	[/have_unit]
	[/or]
	[then]
	[message]
	   speaker=unit
	   message=_"I lost... lost to a few damn heathens, even with all the men I had... An utter failure like myself deserves not a single bit of Uria's forgiveness or mercy..."
	[/message]
	[/then]
	[else]
	[message]
	   speaker=unit
	   message=_"I lost... lost to one damn heathen, even with all the men I had... An utter failure like myself deserves not a single bit of Uria's forgiveness or mercy..."
	[/message]
	[/else]
	[/if]
[/event]
[event]
	name=last breath
	first_time_only=yes
	[filter]
		type=Hoplite_Warlock
	[/filter]
	[message]
	   speaker=unit
	   message=_"Hail... Uria..."
	[/message]
[/event]
[event]
	name=die
	first_time_only=yes
	[filter]
		type=Hoplite_Donovan
	[/filter]
	[if]
	[have_unit]
		id=Algadur
	[/have_unit]
	[then]
	[message]
	   speaker=Algadur
	   message=_"Serves 'im right, that lunatic! Them bloody demon-worshippers deserve far worse than death for what they've done ta my kind!"
	[/message]
    [/then]
    [/if]
[/event]
[event]
	name=last breath
	first_time_only=yes
	[filter]
		type=Hoplite_Grimreaper
	[/filter]
    {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
	[message]
	   speaker=unit
	   message=_"..."
	[/message]
	[delay]
	   time=500
	[/delay]
	[message]
	   speaker=unit
	   message=_"Very well, mortal, you have earned the right to return to the mortal realm, and retain your meaningless existence for now. I have to leave now, as there are still thousands of souls left for me to harvest..."
	[/message]
[/event]
[event]
	name=die
	first_time_only=yes
	[filter]
		type=Hoplite_Grimreaper
	[/filter]
	[message]
	    speaker=Elizabeth
	    message=_"(heavy breathing) We... did it? My goodness, we actually did it!"
	[/message]
	[message]
	    speaker=Algadur
	    message=_"Ta think I'd 'ave ta fight the Death it-bloody-self! 'tis was quite the day, admittedly."
	[/message]
	[message]
	    id=Hoplite,Hoplite2
	    message=_"No time for chit-chat, we must hurry to the portal at once!"
	[/message]
[/event]
[event]
    name=last breath
    first_time_only=no
    [filter]
        id=Algadur
        type=Hoplite_Steelclad
    [/filter]
	[message]
	   speaker=unit
	   message=_"Argh... ye orcish swines won't get me today. I'll shall avenge my brothers later, but now I must run..."
	[/message]
	{MOVE_UNIT id=Algadur 6 2}
	[kill]
	    id=Algadur
	    animate=no
	    fire_event=no
	[/kill]
[/event]
[event]
    name=last breath
    first_time_only=no
    [filter]
        side=$hoplite_allyside
        ability=hoplite_companion
    [/filter]
    [switch]
        variable=unit.type
        [case]
            value=Hoplite_Elizabeth
	    [message]
		   speaker=unit
		   message=_"Uh... I'm pretty darn wounded. Got to go now, I'll catch up with you later!"
	    [/message]
	    {MOVE_UNIT type=Hoplite_Elizabeth 6 10}
                [store_unit]
                    [filter]
                        id=Elizabeth
                    [/filter]
                    variable=elizabeth_stored
                    kill=yes
                [/store_unit]
            {VARIABLE elizabeth_stored.hitpoints $elizabeth_stored.max_hitpoints}
            {CLEAR_VARIABLE elizabeth_stored.status.poisoned}
            {CLEAR_VARIABLE elizabeth_stored.status.slowed}
            {VARIABLE elizabeth_cooldown 3}
	    {IF_VAR companion_recovery_unlocked equals yes (
	    [then]
            {VARIABLE elizabeth_cooldown 2}
	    [/then])}
	    {IF_VAR companion_recoveryII_unlocked equals yes (
	    [then]
            {VARIABLE elizabeth_cooldown 1}
	    [/then])}
	[/case]
        [case]
            value=Hoplite_Steelclad2
	    [message]
		   speaker=unit
		   message=_"I 'ave to go heal my wounds, and catch up with ye later. I ain't gonna be of any use to ya dead."
	    [/message]
	    {MOVE_UNIT type=Hoplite_Steelclad2 6 10}
                [store_unit]
                    [filter]
                        id=Algadur
                    [/filter]
                    variable=algadur_stored
                    kill=yes
                [/store_unit]
            {VARIABLE algadur_stored.hitpoints $algadur_stored.max_hitpoints}
            {CLEAR_VARIABLE algadur_stored.status.poisoned}
            {CLEAR_VARIABLE algadur_stored.status.slowed}
            {VARIABLE algadur_cooldown 3}
	    {IF_VAR companion_recovery_unlocked equals yes (
	    [then]
            {VARIABLE algadur_cooldown 2}
	    [/then])}
	    {IF_VAR companion_recoveryII_unlocked equals yes (
	    [then]
            {VARIABLE algadur_cooldown 1}
	    [/then])}
	[/case]
    [/switch]
[/event]
[event]
	name=die
	id=algadur_axe_line
	first_time_only=yes
	[filter]
		[not]
	    	ability=hoplite_boss
    	[/not]
	[/filter]
	[filter_second]
		side=$hoplite_playerside
	[/filter_second]
	[filter_second_attack]
		name=axe
	[/filter_second_attack]
	[filter_condition]
		[have_unit]
			id=Algadur
		[/have_unit]
	[/filter_condition]
    [message]
        speaker=Algadur
        message=_"I see ye wield an axe too, eh? Good choice!"
    [/message]	
    {VARIABLE algadur_line_axe yes}
[/event]
[event]
	name=die
	id=algadur_axe_boss_line
	first_time_only=yes
	[filter]
		ability=hoplite_boss
	[/filter]
	[filter_second]
		side=$hoplite_playerside
	[/filter_second]
	[filter_second_attack]
		name=axe
	[/filter_second_attack]
	[filter_condition]
		[have_unit]
			id=Algadur
		[/have_unit]
	[/filter_condition]
    [message]
        speaker=Algadur
        message=_"As ye've just demonstrated, a good axe can fell even the mightiest of foes!"
    [/message]	
    {VARIABLE algadur_line_axe_boss yes}
[/event]
#for when Algadur kills a tough orc, like a Warlord:
[event]
	name=die
	id=algadur_lvl3_orc_line
	first_time_only=yes
	[filter]
		level=3
		race=orc
	[/filter]
	[filter_second]
		id=Algadur
	[/filter_second]
    [message]
        speaker=Algadur
        message=_"This is for the brothers you and your kind have slain, you oversized gnat!"
    [/message]	
    {VARIABLE algadur_line_lvl3orc yes}
[/event]