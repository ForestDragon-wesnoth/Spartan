#textdomain wesnoth-Hoplite

#define SPARTAN_COMPANION_DIALOG_EVENTS
    [event]
        id=hoplite_depthdescent_dialog
        first_time_only=no
        {IF_VAR hoplite_tutorial equals yes (
            [then]
                [fire_event]
                    id=spartan_tutorial_depthdescent_events
                [/fire_event]
            [/then]
        )}

        {IF_VAR algadur_line_underworld not_equals yes (
            [and]
                {VARIABLE_CONDITIONAL hoplite_depth less_than 0 }
            [/and]
            [and]
                [have_unit]
                    id=Algadur
                [/have_unit]
            [/and]
            [then]
                [message]
                    speaker=Algadur
                    message=_"By the blazes, my beard be damned! Just where in the bloody hell are we?!"
                [/message]
                [delay]
                    time=1000
                [/delay]
                [message]
                    speaker=Algadur
                    message=_"(shaking) D... did ye hear that?... Aaaa! Ghosts! I be damned! I knew 'tis would go horribly, I knew it!... Looks like we have no bloody choice but ta chop whatever shadow moves until we get some bloody answers! If we die here, we shall at least show 'em all we 'ave!"
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"Very well, time to fight our way out of here!"
                [/message]
                {VARIABLE algadur_line_underworld yes}
            [/then]
        )}

        [if]
            #    {VARIABLE_CONDITIONAL archmagemet not_equals yes}
            #	[and]
            [have_unit]
                id=Spiderqueen
            [/have_unit]
            #	[/and]
            [then]
                {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
                #    [message]
                #        speaker=Spiderqueen
                #        message=_"Hiss... who do we have here? Another deliciousss mortal entersss my lair. More curiously, one from the same world as I."
                #    [/message]

                #counts the kills from both hoplites

                {VARIABLE tmp_spartan_totalkills_dialog 0}
                {VARIABLE_OP tmp_spartan_totalkills_dialog add $totalkills_progress1}
                {VARIABLE_OP tmp_spartan_totalkills_dialog add $totalkills_progress2}

                [message]
                    speaker=Orc_messenger
                    message=_"<i>*panting*</i> Commander Arachne, we have a big problem!"
                [/message]

                [if]
                    {VARIABLE_CONDITIONAL tmp_spartan_totalkills_dialog greater_than_equal_to 12}
                    [then]
                        [message]
                            speaker=Orc_messenger
#ifdef MULTIPLAYER
                            message=_"<i>*panting*</i> These two killed at least a dozen of our soldiers, all by themselves!"
#else
                            message=_"<i>*panting*</i> This man killed at least a dozen of our soldiers, all by himself!"
#endif
                        [/message]
                        [message]
                            speaker=Spiderqueen
                            message=_"This human isn't some ordinary Wesnothian peasant like you're used to. Can't say I am surprised he got this far. Her Majesty Galatea didn't give me enough troops to guard the damn entrance, and now I'm stuck with bottom of the barrel incompetent trash like you!"
                        [/message]
                    [/then]
                    [elseif]
                        {VARIABLE_CONDITIONAL tmp_spartan_totalkills_dialog equals 0}
                        [then]
                            [message]
                                speaker=Orc_messenger
#ifdef MULTIPLAYER
                                message=_"<i>*panting*</i> These two got past our defenses, all by themselves!"
#else
                                message=_"<i>*panting*</i> This man got past our defenses, all by himself!"
#endif
                            [/message]
                            [message]
                                speaker=Spiderqueen
                                message=_"How many troops did we lose?"
                            [/message]
                            [message]
                                speaker=Orc_messenger
                                message=_"I don't think they actually killed any of our soldiers yet, just ran past em like it's no big deal..."
                            [/message]
                            [message]
                                speaker=Spiderqueen
                                message=_"Wait, you are telling me that the enemy DID NOT EVEN NEED TO KILL OUR TROOPS TO GET PAST?! WHAT KIND OF USELESS IMBECILES AM I STUCK HERE WITH?!"
                            [/message]
                        [/then]
                    [/elseif]
                    [else]
                        [message]
                            speaker=Orc_messenger
#ifdef MULTIPLAYER
                            message=_"<i>*panting*</i> These two killed $tmp_spartan_totalkills_dialog| of our soldiers, all by themselves!"
#else
                            message=_"<i>*panting*</i> This man killed $tmp_spartan_totalkills_dialog| of our soldiers, all by himself!"
#endif
                        [/message]
                        [message]
                            speaker=Spiderqueen
                            message=_"This human isn't some ordinary Wesnothian peasant like you're used to. Can't say I am surprised he got this far. Her Majesty Galatea didn't give me enough troops to guard the damn entrance, and now I'm stuck with bottom of the barrel incompetent trash like you!"
                        [/message]
                    [/else]
                [/if]

                [delay]
                    time=500
                [/delay]

                [message]
                    speaker=Spiderqueen
                    message=_"(looks at $protagonist_name1|) Hiss... Well, well, who do we have here? So the deliciousss yet troublesome mortal entersss my lair. More curiously, one from the same world as I. So you managed to get past my worthless underlings, but don't think that I can be defeated as easily!" #wmllint: no spellcheck
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"Stand aside, Arachne, and in the name of Athena I swear that I won't harm you if you do! I am here only to stop Galatea's plans."
                [/message]
                [message]
                    speaker=Spiderqueen
                    message=_"Athena? ATHENA?! <b>ATHEEEEENA?!!!</b> Don't you dare mention that despicable, worthless, vile, pathetic excuse of a goddess in front of me! <b>I WILL RIP YOUR GUTS OUT AND FEED THEM TO MY SPIDERLINGS!!!</b>" #wmllint: no spellcheck
                [/message]
                {SPARTAN_SMOOTH_REPLACE_MUSIC march-of-the-droids.ogg 1000 0}
            [/then]
        [/if]

        [if]
            #    {VARIABLE_CONDITIONAL archmagemet not_equals yes}
            #	[and]
            [have_unit]
                id=Ares
            [/have_unit]
            #	[/and]
            [then]
                {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
                [message]
                    speaker=Ares
#ifdef MULTIPLAYER
                    message=_"So you've arrived, $protagonist_name1| and $protagonist_name2|, warriors of Sparta! It fills me with pride that two of my warriors have prevailed through these treacherous depths so far!"
#else
                    message=_"So you've arrived, $protagonist_name1|, warrior of Sparta! It fills me with pride that one of my warriors has prevailed through these treacherous depths so far!"
#endif
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"Wait, are you... Ares?!"
                [/message]
                [message]
                    speaker=Ares
                    message=_"Indeed, it is I. Or, more accurately speaking, an avatar of myself with merely a small fraction of my might. I heard the prayers of your squad back in our world, so I sent this avatar you see before you, and I now speak through it. Now, I shall tell you the purpose of this visit."
                [/message]
                [message]
                    speaker=Ares
                    message=_"You see, what lies ahead is far deadlier than the paltry opposition you've faced thus far. Your current strength alone is not enough to prevail against Galatea and her strongest minions! Only with my legendary armaments can you achieve victory!"
                [/message]
                [message]
                    speaker=Ares
                    message=_"But before then, I must be fully certain that this divine weaponry won't go to waste. Destroy this avatar, and you shall earn it. If the avatar kills you, you weren't worthy of such a fine reward in the first place."
                [/message]
#ifdef MULTIPLAYER
                [message]
                    id=Hoplite
                    message=_"Very well then, I accept your challenge, Ares!"
                [/message]
                [message]
                    id=Hoplite2
                    message=_"I accept your challenge too!"
                [/message]
#else
                [message]
                    id=Hoplite
                    message=_"Very well then, I accept your challenge, Ares!"
                [/message]
#endif

                {SPARTAN_SMOOTH_REPLACE_MUSIC gathering_storm.ogg 1000 0}
            [/then]
        [/if]

        [if]
            [have_unit]
                id=Scylla
            [/have_unit]
            [then]
                {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
                [message]
                    id=Hoplite,Hoplite2
                    message=_"Nagas again? Doesn't seem to be that many this time..."
                [/message]
                [message]
                    speaker=Scylla
                    message=_"You ssstand before Scylla, Queen of the Stormtail Clan, one of Her Majesty Galatea's most trusted generals, and the mightiessst and mossst beautiful naga in thisss cave! Kneel and pledge allegiance if you wish to be ssspared, human!" #wmllint: no spellcheck
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"I shall not bow to some arrogant naga sorceress! Either stand aside, or you leave me no choice."
                [/message]
                {ALGADUR_LINE scylla_start (
                    [message]
                        speaker=Algadur
                        message=_"These Stormtail scum killed plenty of me shield-brothers along with the orcs! Time fer some payback!"
                    [/message]
                )}
                {SPARTAN_SMOOTH_REPLACE_MUSIC AcrutaLaoDnor.ogg 1000 0}
                [message]
                    speaker=Scylla
                    message=_"Foolisssh human, I ssshall tear you to piecesss with my water magic and feed your corpssse to Charybdisss!" #wmllint: no spellcheck
                [/message]
                [message]
                    speaker=Charybdis
                    message=_"<i>*nods*</i>"
                [/message]
            [/then]
        [/if]

        [if]
            {VARIABLE_CONDITIONAL archmagemet not_equals yes}
            [and]
                [have_unit]
                    id=Archmage
                    [not]
                        [filter_wml]
                            variation=shaxtal
                        [/filter_wml]
                    [/not]
                [/have_unit]
            [/and]
            [then]
                {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}

                #TODO: maybe improve the dialog later, once I decide on archmage's new role in the story a bit more
#ifdef MULTIPLAYER
                [message]
                    speaker=Archmage
                    message=_"So they finally found my hiding place... (looks at the spartans) I know what you are, abominations! I won't let you lay a finger on my precious books, deceitful demons!"
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"You call us demons?! Come to your senses, old man! We are just as human as you!"
                [/message]
                [message]
                    speaker=Archmage
                    message=_"Lies! You expect me to believe that two men could possibly have fought their way here through the dozens of orcs, undead and worse wandering these caves? You are clearly yet another bunch of Galatea's minions, disguised assassins sent to kill me and destroy the books!"
                [/message]
#else
                [message]
                    speaker=Archmage
                    #	   message=_"So the Chaos Empire finally found my hiding place... (looks at the hoplite) I know what you are, abomination! I won't let you lay a finger on my precious books, you Uria-worshipping scum!"
                    message=_"So they finally found my hiding place... (looks at the $spartan_classname_lowercase1|) I know what you are, abomination! I won't let you lay a finger on my precious books, deceitful demon!"
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    #	   message=_"I know not what is this Chaos Empire you speak of, nor am I part of it."
                    message=_"You call me a demon?! Come to your senses, old man! I'm just as human as you!"
                [/message]
                [message]
                    speaker=Archmage
                    message=_"Lies! You expect me to believe that one man could possibly have fought his way here through the dozens of orcs, undead and worse wandering these caves? You are clearly yet another one of Galatea's minions, a disguised assassin sent to kill me and destroy the books!"
                [/message]
#endif

                [if]
                    [have_unit]
                        id=Elizabeth
                    [/have_unit]
                    [then]
                        #rare dialog if you somehow get elizabeth before encountering archmage, like when using debug
                        [message]
                            speaker=Elizabeth
                            message=_"Master Arcanus, calm down!"
                        [/message]
                        [delay]
                            time=500
                        [/delay]
                        [message]
                            speaker=Archmage
                            message=_"E-Elizabeth?! Where have you been for so long?"
                        [/message]
                        [message]
                            speaker=Elizabeth
#ifdef MULTIPLAYER
                            message=_"I was stuck in the underworld, entered a portal I shouldn't have. But it's thanks to $protagonist_name1| and $protagonist_name2| I managed to escape it. I fought side by side with him, and I assure you, he can be trusted."
#else
                            message=_"I was stuck in the underworld, entered a portal I shouldn't have. But it's thanks to $protagonist_name1| I managed to escape it. I fought side by side with him, and I assure you, he can be trusted."
#endif
                        [/message]
                        [message]
                            speaker=Archmage
                            message=_"Very well."
                        [/message]
                        {SPARTAN_BOSSMUSICEND}
                        #archmage becomes peaceful:
                        [modify_unit]
                            [filter]
                                side=$hoplite_enemyside
                            [/filter]
                            side=$hoplite_allyside
                        [/modify_unit]
                        {VARIABLE archmage_beaten yes}
                        [remove_item]
                            image="scenery/trapdoor-closed.png"
                            x,y=6,2
                        [/remove_item]
                        [item]
                            image="scenery/trapdoor-open.png"
                            x,y=6,2
                        [/item]

                        {CLEAR_VARIABLE bossfight}

                        {VARIABLE archmage_beaten yes}
                        {VARIABLE archmage_spared yes}#variable will also be used for sparing archmage with the healing potion later
                        {VARIABLE elizabeth_line_archmage yes}#for filtering later
                        {VARIABLE noautomove_this_depth yes}#level can be explored as normal
                    [/then]
                    [else]
                        [message]
                            id=Hoplite,Hoplite2
                            message=_"I'd rather not spill more blood than necessary, but if it is a fight you want, it's a fight you will get!"
                        [/message]

                        {ALGADUR_LINE archmage (
                        #using ifdef multiplayer does not work here!!!
                        [if]
                            [have_unit]
                                id=Hoplite2
                            [/have_unit]
                            [then]
                            [message]
                                speaker=Algadur
                                message=_"Anyone who wants ta kill my shield-brothers will have ta face me too!"
                            [/message]
                            [/then]
                            [else]
                            [message]
                                speaker=Algadur
                                message=_"Anyone who wants ta kill my shield-brother will have ta face me too!"
                            [/message]
                            [/else]
                        [/if]
                        )}
                        {SPARTAN_SMOOTH_REPLACE_MUSIC burning.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
                        {SPARTAN_SMOOTH_REPLACE_MUSIC battle-epic.ogg 1000 0}
#endif
                    [/else]
                [/if]
                {VARIABLE archmagemet yes}
            [/then]
        [/if]
        [if]
            {VARIABLE_CONDITIONAL archmagemet2 not_equals yes}
            [and]
                [have_unit]
                    id=Archmage
                    [filter_wml]
                        variation=shaxtal
                    [/filter_wml]
                [/have_unit]
            [/and]
            [then]
                {HOPLITE_UNSTORE_COMPANIONS}
                {SPARTAN_SMOOTH_REPLACE_MUSIC overlive.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
                {SPARTAN_SMOOTH_REPLACE_MUSIC frantic.ogg 1000 0}
#endif
                [if]
                    [have_unit]
                        id=Elizabeth
                    [/have_unit]
                    [then]
                        {IF_VAR elizabeth_line_archmage equals yes (
                            [then]
                                [message]
                                    speaker=Elizabeth
                                    message=_"M-master! Wha... What happened to you?!"
                                [/message]
                            [/then]
                            [else]
                                [message]
                                    speaker=Elizabeth
                                    message=_"M-master? Is that you? Do... do you remember me?"
                                [/message]
                            [/else]
                        )}
                        {SCROLL_TO 6 4}
                        [delay]
                            time=1000
                        [/delay]
                        [message]
                            speaker=Archmage
                            message=_"(in a metallic female voice) You being so eager to call <b>me</b> master is appreciated, dear, but if you were referring to this old man, then I would like to inform you that he is no more. His husk is now merely another disposable drone for the empire."
                        [/message]
                        [message]
                            speaker=Algadur
                            message=_"My beard be damned! Look at this thing's bloody face!"
                        [/message]
                        [message]
                            speaker=Elizabeth
                            message=_"Wh... just what the hell are you?!"
                        [/message]
                        [message]
                            speaker=Archmage
                            message=_"Have you been living under a rock, Elizabeth? Never seen a shaxtal in your entire life?"
                        [/message]
                        [message]
                            speaker=Elizabeth
                            message=_"How... how do you know my name?"
                        [/message]
                        [message]
                            speaker=Archmage
                            message=_"Ah, it just so happens that I may have had the pleasure of knowing you in a past life of sorts. Unlike you, however, I'm now near the top of the current hierarchy, while you still remain near the very bottom like the failure that you are."
                        [/message]
                        [message]
                            speaker=Elizabeth
                            message=_"Wha... I..."
                        [/message]
                        [message]
                            speaker=Archmage
                            message=_"More importantly, you have been sentenced to death for interfering with the empire's geopolitical expansion. If you surrender, we promise to make your death quick and painless. If you won't, then I can assure you that I will truly make you regret make such a foolish choice."
                        [/message]
                        [if]
                            [have_unit]
                                id=Algadur
                            [/have_unit]
                            [then]
                                [message]
                                    speaker=Algadur
                                    message=_"Surrender ta you?! Blazes no! I'd rather shave my beard than become braindead enough ta accept that! Prepare ta taste my axe, abomination!"
                                [/message]
                            [/then]
                            [else]
                                [message]
                                    speaker=Elizabeth
                                    message=_"Surrender to you?! Hell no! I'd rather die than lick your imperial boots!"
                                [/message]
                            [/else]
                        [/if]
                        [message]
                            id=Hoplite,Hoplite2
                            # wmllint: local spelling Chaaaaaarge
                            message=_"You will pay dearly for what you did to Elizabeth's mentor, you Uria-worshipping demon! Chaaaaaarge!"
                        [/message]
                        [delay]
                            time=500
                        [/delay]
                        [message]
                            speaker=Archmage
                            message=_"Enemies of Uria truly do never learn... very well, if you want to lay your worthless lives for your worthless cause, then so be it! My warm blood bath is already prepared, so I'll leave killing you to this mindless drone."
                        [/message]
                        [delay]
                            time=500
                        [/delay]
                        [message]
                            speaker=Archmage
                            message=_"(switches to a male metallic voice) Initiating protocol 21B. Weapon systems online. Report to Uria's Fire after completion of the objective."
                        [/message]
                        {VARIABLE elizabeth_line_archmage2 yes}
                    [/then]
                    #if you have Algadur but not Elizabeth somehow:
                    [elseif]
                        [have_unit]
                            id=Algadur
                        [/have_unit]
                        [then]
                            [message]
                                speaker=Archmage
                                message=_"(in a female metallic voice) Were you expecting to encounter this old man here? Well, he is no more. His husk is now merely another disposable drone for the empire..."
                            [/message]
                            [message]
                                speaker=Algadur
                                message=_"My beard be damned! Look at this thing's bloody face!"
                            [/message]
                            [message]
                                speaker=Archmage
                                message=_"...and more importantly, you have been sentenced to death for interfering with the empire's geopolitical expansion. If you surrender, we promise to make your death quick and painless. If you won't, then I can assure you that I will truly make you regret make such a foolish choice."
                            [/message]
                            [message]
                                speaker=Algadur
                                message=_"Surrender ta you?! Blazes no! I'd shave my beard before I become braindead enough ta accept that! Prepare ta taste my axe, abomination!"
                            [/message]
                            [message]
                                id=Hoplite,Hoplite2
                                message=_"You will pay dearly for what you did to this old man, you Uria-worshipping demon! Chaaaaaarge!"
                            [/message]
                            [delay]
                                time=500
                            [/delay]
                            [message]
                                speaker=Archmage
                                message=_"The heretics truly do never learn... very well, if you want to lay your worthless lives for your 'cause', then so be it! My warm blood bath is already prepared, so I'll leave killing you to this mindless drone."
                            [/message]
                            [message]
                                speaker=Archmage
                                message=_"(switches to a male metallic voice) Initiating protocol 21B. Weapon systems online. Report to Uria's Fire after completion of the objective."
                            [/message]
                        [/then]
                    [/elseif]
                    [else]
                        [message]
                            speaker=Archmage
                            message=_"(in a female metallic voice) Were you expecting to encounter this old man here? Well, he is no more. His husk is now merely another disposable drone for the empire."
                        [/message]
                        [message]
                            speaker=Archmage
                            message=_"More importantly, however, you have been sentenced to death for interfering with the empire's geopolitical expansion. If you surrender, we promise to make your death quick and painless. If you won't, then I can assure you that I will truly make you regret make such a foolish choice."
                        [/message]
                        [message]
                            id=Hoplite,Hoplite2
                            message=_"How arrogant of you to think a proud warrior of Sparta will just surrender to the likes of you. You will pay dearly for what you did to this old man, you Uria-worshipping demon!"
                        [/message]
                        [delay]
                            time=500
                        [/delay]
                        [message]
                            speaker=Archmage
                            message=_"You refuse? The heretics truly do never learn... very well, if you want to lay your worthless life for your worthless cause, then so be it! My warm blood bath is already prepared, so I'll leave killing you to this mindless drone."
                        [/message]
                        [message]
                            speaker=Archmage
                            message=_"(switches to a male metallic voice) Initiating protocol 21B. Weapon systems online. Report to Uria's Fire after completion of the objective."
                        [/message]
                    [/else]
                [/if]
                {SPARTAN_SMOOTH_REPLACE_MUSIC gathering_storm.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
                {SPARTAN_SMOOTH_REPLACE_MUSIC battle-epic.ogg 1000 0}
#endif
                {VARIABLE archmagemet2 yes}
            [/then]
        [/if]
        {IF_VAR reaper_met not_equals yes (
            [and]
                {VARIABLE_CONDITIONAL hoplite_depth equals -10}
            [/and]
            [then]
                {VARIABLE reaper_met yes}
                {HOPLITE_UNSTORE_COMPANIONS}
                [delay]
                    time=500
                [/delay]
                [unhide_unit]
                    id=Reaper
                [/unhide_unit]
                {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
                [if]
                    [have_unit]
                    	side=$hoplite_playerside,$hoplite_allyside
                        [not]
                            id=Hoplite
                        [/not]
                        count=1-999
                    [/have_unit]
                    [then]
                        [message]
                            speaker=Reaper
                            message=_"Who do we have here? A group of mortals foolish enough to enter the land of the dead. Do you desire to hasten your demise?"
                        [/message]
                        [message]
                            id=Hoplite,Hoplite2
                            message=_"We must return to the world of the living, and if we must go through you, then so be it!"
                        [/message]
                        [message]
                            speaker=Reaper
                            message=_"<i>laughs</i> I have seen millions of mortals, but you are certainly among the most bold. I must admit, I am somewhat amused. Since I am feeling quite generous at the moment, If you can defeat a small fraction of my power, I will permit you to leave my domain this time."
                        [/message]
                        [message]
                            id=Hoplite,Hoplite2
                            message=_"Very well, I accept your challenge!"
                        [/message]
                        [message]
                            speaker=Reaper
                            message=_"Your souls shall be a fine addition to my collection, mortals!"
                        [/message]
                    [/then]
                    [else]
                        #most likely won't happen in actual gameplay, but possible in debug:
                        [message]
                            speaker=Reaper
                            message=_"Who do we have here? A $spartan_classname_lowercase1|, a lone mortal foolish enough to enter the land of the dead. Do you desire to hasten your demise?"
                        [/message]
                        [message]
                            id=Hoplite,Hoplite2
                            message=_"I must return to the world of the living, and if I must go through you, then so be it!"
                        [/message]
                        [message]
                            speaker=Reaper
                            message=_"<i>laughs</i> I have seen millions of mortals, but you are certainly among the most bold. I must admit, I am somewhat amused. Since I am feeling quite generous at the moment, If you can defeat a small fraction of my power, I will permit you to leave my domain this time."
                        [/message]
                        [message]
                            id=Hoplite,Hoplite2
                            message=_"Very well, I accept your challenge!"
                        [/message]
                        [message]
                            speaker=Reaper
                            message=_"Your soul shall be a fine addition to my collection, mortal!"
                        [/message]        
                    [/else]
                [/if]
                {SPARTAN_SMOOTH_REPLACE_MUSIC moleman.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
                {SPARTAN_SMOOTH_REPLACE_MUSIC battle-epic.ogg 1000 0}
#endif
            [/then]
        )}

        #Xerxix dialog on depth 39
        [if]
            [have_unit]
                id=Xerxix
            [/have_unit]
            [and]
                {VARIABLE_CONDITIONAL hoplite_depth equals 39}
            [/and]
            [then]
                [message]
                    id=Xerxix
                    #ifdef MULTIPLAYER
                    message=_"We meet yet again, $protagonist_name1| and $protagonist_name2|!"
                    #else
                    message=_"We meet yet again, $protagonist_name1|!"
                    #endif
                [/message]
                [if]
                [have_unit]
                    id=Algadur
                [/have_unit]
                [then]
                    [message]
                        speaker=Algadur
                        message=_"You know tis' saurian? Who is he?"
                    [/message]
                    [message]
                        id=Hoplite,Hoplite2
                        message=_"This is Xerxix. He's the first local we found when entering this world. Do not worry, he is also an enemy of Galatea."
                    [/message]
                    [message]
                        speaker=Algadur
                        message=_"I see."
                    [/message]
                    [if]
                    [have_unit]
                        id=Elizabeth
                    [/have_unit]
                    [then]
                    [message]
                        speaker=Elizabeth
                        message=_"Very well, I'll trust him for now then."
                    [/message]
                    [message]
                        id=Hoplite,Hoplite2
                        message=_"Ahem. Greetings, Xerxix. This is Algadur and Elizabeth."
                    [/message]
                    [/then]
                    [else]
                    [message]
                        id=Hoplite,Hoplite2
                        message=_"Ahem. Greetings, Xerxix. This is Algadur, my new shield-brother."
                    [/message]
                    [/else]
                    [/if]
                [/then]
                [elseif]
                    [have_unit]
                        id=Elizabeth
                    [/have_unit]
                    [then]
                    [message]
                        speaker=Elizabeth
                        message=_"You know this saurian? Who is he?"
                    [/message]
                    [message]
                        id=Hoplite,Hoplite2
                        message=_"This is Xerxix. He's the first local we found when entering this world. Do not worry, he is also an enemy of Galatea."
                    [/message]
                    [message]
                        speaker=Elizabeth
                        message=_"Very well, I'll trust him for now then"
                    [/message]
                    [message]
                        id=Hoplite,Hoplite2
                        message=_"Ahem. Greetings, Xerxix. This is Elizabeth."
                    [/message]
                    [/then]
                [/elseif]
                [else]
                    [message]
                        id=Hoplite,Hoplite2
                        message=_"Greetings, Xerxix."
                    [/message]
                [/else]
                [/if]
                {ALGADUR_LINE xerxix_depth39 (
                )}
                [message]
                    id=Xerxix
                    message=_"I am quite impressed with your progress, you have defeated so many of Galatea's troops and generals. And now... you stand near the entrance to her own throne room!"
                [/message]
                [if]
                {VARIABLE_CONDITIONAL spartan_pact_patience greater_than 0}
                [then]
                    #Xerxix comments if the player has pact of patience. he is trying to hide the fact he is the same person as who gave the pacts
                    [message]
                        id=Xerxix
                        message=_"The battle ahead will be a difficult one. I was considering giving you a Golden Forge... but due to, ahem, certain reasons I can only give you a normal one."
                    [/message]
                [/then]
                [else]
                    [if]
                    {VARIABLE_CONDITIONAL spartan_pact_overlord greater_than 0}
                    [then]
                    [message]
                        id=Xerxix
                        message=_"I was about to say the battle ahead will be a difficult one... but looking at you I believe you can defeat Galatea easily enough. Still, as a gift I have brought you a magical <span color='#ffff99'>Golden Forge</span>, more powerful than the ordinary dwarven-made ones you usually found in the caves."
                    [/message]
                    [/then]
                    [else]
                    [message]
                        id=Xerxix
                        message=_"The battle ahead will be a difficult one, but as a gift I have brought you a magical <span color='#ffff99'>Golden Forge</span>, more powerful than the ordinary dwarven-made ones you usually found in the caves."
                    [/message]
                    [/else]
                    [/if]
                [/else]
                [/if]

                [message]
                    id=Hoplite,Hoplite2
                    message=_"Thank you, Xerxix."
                [/message]
                [message]
                    id=Xerxix
                    message=_"Now go forth and kill that evil tyranness! But beware of her mind control magic and do not trust her!"
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"Very well."
                [/message]
            [/then]
        [/if]

        #Xerxix dialog on depth 59
        [if]
            [have_unit]
                id=Xerxix
            [/have_unit]
            [and]
                {VARIABLE_CONDITIONAL hoplite_depth equals 59}
            [/and]
            [then]
                [message]
                    id=Xerxix
                    #ifdef MULTIPLAYER
                    message=_"We meet yet again, $protagonist_name1| and $protagonist_name2|!"
                    #else
                    message=_"$protagonist_name1|, you seem to have accidentally taken a long detour. No matter... this trapdoor has a portal that leads directly to Galatea's throne room again. However, she is now more powerful than before, so be careful."
                    #endif
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"Very well."
                [/message]
            [/then]
        [/if]

        #Galatea boss dialog:

        [if]
            [have_unit]
                id=Galatea
                [not]
                    type=Hoplite_Galatea_prologue
                [/not]
            [/have_unit]
            [then]
                {SPARTAN_SMOOTH_REPLACE_MUSIC overlive.ogg 1000 0}
                [message]
                    speaker=Galatea
                    #ifdef MULTIPLAYER
                    message=_"So you two are the ones who defeated hundreds of my troops and even my generals. And now you have the audacity to step into my throne room too."
                    #else
                    message=_"So you are the one who defeated hundreds of my troops and even my generals. And now you have the audacity to step into my throne room too."
                    #endif
                [/message]
                [message]
                    id=Hoplite
                    #ifdef MULTIPLAYER
                    message=_"Indeed. We, $protagonist_name1| and $protagonist_name2|, have come to stop your plans of invading our homeland again!"
                    #else
                    message=_"Indeed. I, $protagonist_name1|, have come to stop your plans of invading my homeland again!"
                    #endif
                [/message]
                #"he" refers to the Merchant, who Galatea got her current powers from
                [message]
                    speaker=Galatea
                    #ifdef MULTIPLAYER
                    message=_"How did you even get this far? You are just two men... unless he... no no, surely he would not betray me..."
                    #else
                    message=_"How did you even get this far? You are just one man... unless he... no no, surely he would not betray me..."
                    #endif
                [/message]




            [if]
            {VARIABLE_CONDITIONAL spartan_pact_overlord greater_than 0}
            [then]
                [store_unit]
                    [filter]
                        id=Hoplite,Hoplite2
                    [/filter]
                    variable=hoplite_protagonist_portraits
                    kill=no
                [/store_unit]
                #merchant possessing the player character to talk
                [message]
                    speaker=Hoplite
                    image="$hoplite_protagonist_portraits[0].profile|~BLIT(portraits/cloaked2.png~BLEND(0,0,0,1)~O(50%))" 
                    message=_"A very good question, my little Galatea."
                [/message]
                [message]
                    speaker=Galatea
                    message=_"Still, I must try the spell..."
                [/message]
                {FLASH_WHITE (
                    [sound]
                        name=lightning.ogg
                    [/sound]
                )}
                [message]
                    speaker=Galatea
                    #ifdef MULTIPLAYER
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>Obey me, $protagonist_name1| and $protagonist_name2|!!!</span>"
                    #else
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>Obey me, $protagonist_name1|!!!</span>"
                    #endif
                [/message]
                [message]
                    #ifdef MULTIPLAYER
                    speaker=Hoplite2
                    image="$hoplite_protagonist_portraits[1].profile|~BLIT(portraits/cloaked2.png~BLEND(0,0,0,1)~O(50%))" 
                    #else
                    speaker=Hoplite
                    image="$hoplite_protagonist_portraits[0].profile|~BLIT(portraits/cloaked2.png~BLEND(0,0,0,1)~O(50%))" 
                    #endif
                    message=_"(laughs) It is futile. You cannot conquer this body when it belongs to someone greater than yourself."
                [/message]
                [message]
                    speaker=Galatea
                    message=_"No... it can't be..."
                [/message]
                [message]
                    speaker=Hoplite
                    image="$hoplite_protagonist_portraits[0].profile|~BLIT(portraits/cloaked2.png~BLEND(0,0,0,1)~O(50%))" 
                    #ifdef MULTIPLAYER
                    message=_"For now, I shall return the bodies back to $protagonist_name1| and $protagonist_name2|. This will be entertaining to watch."
                    #else
                    message=_"For now, I shall return the bodiy back to $protagonist_name1|. This will be entertaining to watch."
                    #endif
                [/message]
                {ALGADUR_LINE galatea1 (
                #using ifdef multiplayer does not work here!!!
                [if]
                    [have_unit]
                        id=Hoplite2
                    [/have_unit]
                    [then]
                    [message]
                        speaker=Algadur
                        message=_"What is happening to ye, shield-brothers? $protagonist_name1|? $protagonist_name2|?"
                    [/message]
                    [/then]
                    [else]
                    [message]
                        speaker=Algadur
                        message=_"What is happening to ye, shield-brother? $protagonist_name1|?"
                    [/message]
                    [/else]
                    [message]
                        id=Hoplite,Hoplite2
                        message=_"I... I am completely fine, do not worry!"
                    [/message]
                [/if]
                )}
                [message]
                    id=Hoplite
                    message=_"Now, Galatea, it is time to put an end to your reign once and for all!"
                [/message]
                [message]
                    speaker=Galatea
                    message=_"I will fight to save Mallion no matter what you throw at me!"
                [/message]

                [/then]
            [else]

                #forges scattered across the cave are mostly made by dwarves
                [if]
                [have_unit]
                    id=Algadur
                [/have_unit]
                [then]
                    [message]
                        speaker=Algadur
                        message=_"Our dwarven forges can do more than ye think, ye vile tyranness! Now it's time fer some payback fer all my shield-brothers yer troops killed!"
                    [/message]
                    [message]
                        speaker=Galatea
                        #ifdef MULTIPLAYER
                        message=_"Spartans and dwarves... both your kinds proved to be unusually resistant to my mind control spells, but now I only need to succeed on two people instead of whole squads."
                        #else
                        message=_"Spartans and dwarves... both your kinds proved to be unusually resistant to my mind control spells, but now I only need to succeed on one person instead of whole squads."
                        #endif
                    [/message]
                [/then]
                [else]
                    [message]
                        id=Hoplite
                        message=_"A true warrior of Sparta can handle anything you could possibly throw at him!"
                    [/message]
                    [message]
                        speaker=Galatea
                        #ifdef MULTIPLAYER
                        message=_"Your kind proved to be unusually resistant to my mind control spells during the war, but now I only need to succeed on two people instead of whole squads."
                        #else
                        message=_"Your kind proved to be unusually resistant to my mind control spells during the war, but now I only need to succeed on one person instead of whole squads."
                        #endif
                    [/message]
                [/else]
                [/if]
                [message]
                    speaker=Galatea
                    #ifdef MULTIPLAYER
                    message=_"With your current power, $protagonist_name1| and $protagonist_name2|, if you are on my side I may still be able to free Mallion from your countrymen."
                    #else
                    message=_"With your current power, $protagonist_name1|, if you are on my side I may still be able to free Mallion from your countrymen."
                    #endif
                [/message]

                #for the multiplayer dialog:

                [store_unit]
                    [filter]
                        id=Hoplite,Hoplite2
                    [/filter]
                    variable=hoplite_protagonist_portraits
                    kill=no
                [/store_unit]                

                {FLASH_WHITE (
                    [sound]
                        name=lightning.ogg
                    [/sound]
                )}
                [message]
                    speaker=Galatea
                    #ifdef MULTIPLAYER
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>Obey me, $protagonist_name1| and $protagonist_name2|!!!</span>"
                    #else
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>Obey me, $protagonist_name1|!!!</span>"
                    #endif
                [/message]
                #ifdef MULTIPLAYER
                #since second_image is bugged in 1.18, using this as a workaround instead
                [message]
                    speaker=narrator
                    caption=_"$protagonist_name1| and $protagonist_name2|"
                    #show both protagonists at once
                    image="misc/blank-hex.png~SCALE(600,400)~BLIT($hoplite_protagonist_portraits[1].profile|,-100,0)~BLIT($hoplite_protagonist_portraits[0].profile|,50,0)" 
                    message=_"Argh..."
                    sound={SOUND_LIST:HUMAN_HIT}
                [/message]
                #else
                [message]
                    id=Hoplite
                    message=_"Argh..."
                    sound={SOUND_LIST:HUMAN_HIT}
                [/message]
                #endif

                {FLASH_WHITE (
                    [sound]
                        name=lightning.ogg
                    [/sound]
                )}
                [message]
                    speaker=Galatea
                    #ifdef MULTIPLAYER
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>Pledge your allegiance to me, $protagonist_name1| and $protagonist_name2|!!!</span>"
                    #else
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>Pledge your allegiance to me, $protagonist_name1|!!!</span>"
                    #endif
                [/message]
                #ifdef MULTIPLAYER
                [message]
                    speaker=narrator
                    caption=_"$protagonist_name1| and $protagonist_name2|"
                    #show both protagonists at once
                    image="misc/blank-hex.png~SCALE(600,400)~BLIT($hoplite_protagonist_portraits[1].profile|,-100,0)~BLIT($hoplite_protagonist_portraits[0].profile|,50,0)" 
                    message=_"AAAArrrgh... No..."
                    sound={SOUND_LIST:HUMAN_HIT}
                [/message]
                #else
                [message]
                    id=Hoplite
                    message=_"AAAArrrgh... No..."
                    sound={SOUND_LIST:HUMAN_HIT}
                [/message]
                #endif
                {FLASH_WHITE (
                    [sound]
                        name=lightning.ogg
                    [/sound]
                )}
                [message]
                    speaker=Galatea
                    #ifdef MULTIPLAYER
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>You will be my finest warriors, $protagonist_name1| and $protagonist_name2|. Now serve me!!!</span>"
                    #else
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>You will be my finest warrior, $protagonist_name1|!!!. Now serve me!!!</span>"
                    #endif
                [/message]
                #ifdef MULTIPLAYER
                [message]
                    speaker=narrator
                    caption=_"$protagonist_name1| and $protagonist_name2|"
                    #show both protagonists at once
                    image="misc/blank-hex.png~SCALE(600,400)~BLIT($hoplite_protagonist_portraits[1].profile|,-100,0)~BLIT($hoplite_protagonist_portraits[0].profile|,50,0)" 
                    message=_"AAAAAAAAAAAAAAAAA..."
                    sound={SOUND_LIST:HUMAN_HIT}
                [/message]
                [message]
                    speaker=narrator
                    caption=_"$protagonist_name1| and $protagonist_name2|"
                    #show both protagonists at once
                    image="misc/blank-hex.png~SCALE(600,400)~BLIT($hoplite_protagonist_portraits[1].profile|,-100,0)~BLIT($hoplite_protagonist_portraits[0].profile|,50,0)" 
                    message=_"..."
                [/message]
                #else
                [message]
                    id=Hoplite
                    message=_"AAAAAAAAAAAAAAAAA..."
                    sound={SOUND_LIST:HUMAN_HIT}
                [/message]
                [message]
                    id=Hoplite
                    message=_"..."
                [/message]
                #endif
                [delay]
                    time=2000
                [/delay]
                {ALGADUR_LINE galatea1 (
                #using ifdef multiplayer does not work here!!!
                [if]
                    [have_unit]
                        id=Hoplite2
                    [/have_unit]
                    [then]
                    [message]
                        speaker=Algadur
                        message=_"What is happening to ye, shield-brothers? $protagonist_name1|? $protagonist_name2|?"
                    [/message]
                    [/then]
                    [else]
                    [message]
                        speaker=Algadur
                        message=_"What is happening to ye, shield-brother? $protagonist_name1|?"
                    [/message]
                    [/else]
                [/if]
                )}
                #ifdef MULTIPLAYER
                [message]
                    speaker=narrator
                    caption=_"$protagonist_name1| and $protagonist_name2|"
                    #show both protagonists at once
                    image="misc/blank-hex.png~SCALE(600,400)~BLIT($hoplite_protagonist_portraits[1].profile|,-100,0)~BLIT($hoplite_protagonist_portraits[0].profile|,50,0)" 
                    message=_"We... serve..."
                [/message]
                #else
                [message]
                    id=Hoplite
                    message=_"I... serve..."
                [/message]
                #endif
                {ELIZABETH_LINE galatea1 (
                    [message]
                        speaker=Elizabeth
                        message=_"Don't tell me..."
                    [/message]
                )}
                [message]
                    speaker=Galatea
                    message=_"Yes, yes, pledge allegiance to me!"
                [/message]
                [delay]
                    time=1000
                [/delay]
                {SPARTAN_SMOOTH_REPLACE_MUSIC Trite_And_Wrong.ogg 1000 0}
                #ifdef MULTIPLAYER
                [message]
                    speaker=narrator
                    caption=_"$protagonist_name1| and $protagonist_name2|"
                    #show both protagonists at once
                    image="misc/blank-hex.png~SCALE(600,400)~BLIT($hoplite_protagonist_portraits[1].profile|,-100,0)~BLIT($hoplite_protagonist_portraits[0].profile|,50,0)" 
                    message=_"We serve... Sparta!!!"
                [/message]
                #else
                [message]
                    id=Hoplite
                    message=_"I serve... Sparta!!!"
                [/message]
                #endif

                [message]
                    speaker=Galatea
                    message=_"I-Impossible! The spell still failed?!"
                [/message]
                [message]
                    id=Hoplite
                    #ifdef MULTIPLAYER
                    message=_"No matter what dark sorcery you try to use, we will protect our homeland from your hordes at all costs!"
                    #else
                    message=_"No matter what dark sorcery you try to use, I will protect my homeland from your hordes at all costs!"
                    #endif
                [/message]
                [message]
                    #ifdef MULTIPLAYER
                    id=Hoplite2
                    message=_"We defeated everything you have thrown at us so far, and we shall defeat you too! Now it is time to end this!"
                    #else
                    id=Hoplite
                    message=_"I defeated everything you have thrown at me so far, and I shall defeat you too! Now it is time to end this!"
                    #endif
                [/message]
                [delay]
                    time=1000
                [/delay]
                [message]
                    speaker=Galatea
                    message=_"If I can't make you loyal to me, I shall have to get rid of you myself! I won't let anyone or anything stand between me and Mallion, mark my words!"
                [/message]
                [message]
                    speaker=Galatea
                    message=_"<span color='#FF00FF' size='large' font-style='italic'>My loyal troops, attack!</span>"
                [/message]
                [message]
                    side=$hoplite_enemyside
                    level=3
                    message=_"Yes, Your Majesty!!!"
                [/message]
            [/else]
            [/if]

                {SPARTAN_SMOOTH_REPLACE_MUSIC ThoseofUsWhoFight.ogg 1000 0}
                {CLEAR_VARIABLE hoplite_protagonist_portraits}
            [/then]
        [/if]

        #UNUSED PROMETHEUS HEART DIALOG, THIS IS NO LONGER PART OF THE STORY

        {IF_VAR hoplite_depth equals 40_unused_prometheus_heart (
            [then]
                {SPARTAN_SMOOTH_REPLACE_MUSIC into_the_shadows.ogg 1000 0}
                {HOPLITE_UNSTORE_COMPANIONS}
                {MOVE_UNIT id=Hoplite,Hoplite2 6 5}
                {MOVE_UNIT ability=hoplite_companion 6 5}

                [if]
                    [have_unit]
                        [not]
                            id=Hoplite
                        [/not]
                    [/have_unit]
                    [then]
                        [message]
                            id=Hoplite,Hoplite2
                            message=_"This is it. Finally, we found it - the heart of Prometheus."
                        [/message]
                    [/then]
                    [else]
                        [message]
                            id=Hoplite,Hoplite2
                            message=_"This is it. Finally, I found it - the heart of Prometheus"
                        [/message]
                    [/else]
                [/if]

                #TODO: completely rewrite the prometheus heart dialog or scrap it outright

                [if]
                    [have_unit]
                        id=Algadur
                    [/have_unit]
                    [and]
                        [have_unit]
                            id=Elizabeth
                        [/have_unit]
                    [/and]
                    [then]
                        [message]
                            speaker=Algadur
                            message=_"By the gods' beards! Is 'tis what I think it is? So we 'ave found the Ruby of Fire?"
                        [/message]
                        [message]
                            speaker=Elizabeth
                            message=_"Not quite. It is the Prometheus' Heart, a gem similar to the Ruby of Fire in nature. Its power doesn't quite hold up to that of its more famous counterpart, but it is still rather impressive."
                        [/message]
                    [/then]
                    [elseif]
                        [have_unit]
                            id=Algadur
                        [/have_unit]
                        [and]
                            [not]
                                [have_unit]
                                    id=Elizabeth
                                [/have_unit]
                            [/not]
                        [/and]
                        [then]
                            [message]
                                speaker=Algadur
                                message=_"By the gods' beards! Is 'tis what I think it is? So we 'ave found the Ruby of Fire?"
                            [/message]
                        [/then]
                    [/elseif]
                    [elseif]
                        [have_unit]
                            id=Elizabeth
                        [/have_unit]
                        [and]
                            [not]
                                [have_unit]
                                    id=Algadur
                                [/have_unit]
                            [/not]
                        [/and]
                        [then]
                            [message]
                                speaker=Elizabeth
                                message=_"My goodness, it's the Prometheus' Heart, a gem not unlike the Ruby of Fire! Its power doesn't quite hold up to that of its more famous counterpart, but it is still rather impressive."
                            [/message]
                        [/then]
                    [/elseif]
                [/if]
                [remove_item]
                    x,y=6,4
                [/remove_item]
                [item]
                    x,y=6,4
                    image="items/brazier.png"
                [/item]
                [sound]
                    name=fanfare-short.wav
                [/sound]
                {HOPLITE_APPLY_PROMETHEUS_HEART}
                [if]
                    [have_unit]
                        id=Algadur
                    [/have_unit]
                    [then]
                        [message]
                            speaker=Algadur
                            message=_"Now that we got 'tis beauty, we must hurry up an' leave the leave before any of the demon-worshipers catch up ta us!"
                        [/message]
                        [message]
                            speaker=Elizabeth
                            message=_"Indeed, we can't waste a minute. However, going down into the dungeon could also be also a promising option. After all, the surface is probably overrun by the Chaos Empire. (to the hoplite) What do you think?"
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=Elizabeth
                            message=_"Now that we got this gem, we must hurry up and leave the leave before any of Uria's worshipers catch up to us, we can't waste a minute. However, going down into the dungeon could also be also a promising option. After all, the surface is probably overrun by the Chaos Empire. What do you think?"
                        [/message]
                    [/else]
                [/if]
                {SPARTAN_SMOOTH_REPLACE_MUSIC kreepor.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
                {SPARTAN_SMOOTH_REPLACE_MUSIC underground.ogg 1000 0}
#endif
                {MOVE_UNIT id=Hoplite,Hoplite2 6 2}
                #dialog: choose, oh hoplite, do you leave the dungeon to keep the mighty gem you have acquired, or descend even deeper into this endless abyss?
            [/then]
        )}
        {IF_VAR algadurlinesmith not_equals yes (
            [and]
                [have_unit]
                    id=Algadur
                [/have_unit]
            [/and]
            [and]
                [have_unit]
                    id=runesmith
                [/have_unit]
            [/and]
            [then]
                {VARIABLE algadurlinesmith yes}
                [message]
                    speaker=Algadur
                    message=_"One of our runesmiths is bein' attacked! Quick, we must help 'im!"
                [/message]
            [/then]
        )}
        {IF_VAR algadurlinestart not_equals yes (
            [and]
                [have_unit]
                    id=Algadur
                [/have_unit]
            [/and]
            [then]
                [message]
                    side=$hoplite_enemyside
                    race=orc
                    message=_"I repeat again, bearded maggots - Her Majesty Galatea ordered us to search this cave for some sort of workshop. Either you hand over the territory willingly, or we gonna keep butchering your puny kind, hehe."
                [/message]
                [message]
                    speaker=Algadur
                    message=_"A true dwarf nevers surrenders to trash like you, ya surface-dwellin' pigs! If I'm goin' down, then I'm sure as hell bringin' ye all with me!" #wmllint: no spellcheck
                [/message]
                {VARIABLE algadurlinestart yes}
            [/then]
        )}
        #patron lines:
        [if]
            [have_unit]
                id=Jeremias
                side=$hoplite_enemyside
            [/have_unit]
            [then]
                [message]
                    speaker=Jeremias
                    message=_"I'm far too old for this..."
                [/message]
            [/then]
        [/if]
        [if]
            [have_unit]
                id=inferno8
                side=$hoplite_enemyside
            [/have_unit]
            [then]
                [message]
                    speaker=inferno8
                    message=_"(singing) Ah, there's no better thing in this mortal world than fire
Destruction, passion, all-consuming desire
The human body was such a tire
I prefer being a walking flame, a state of existence much higher
Beware my abyssal flames' ire
Cause if you get in way you'll be no more than ash on a pyre!"
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"A singing... fire elemental?"
                [/message]
                [message]
                    speaker=inferno8
                    message=_"I am no mere elemental! I am The Eighth Inferno himself - once a mere human mage, I have ascended to this flawless fiery form!"
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"You traded your own body to become this? You are... certainly quite the pyromaniac."
                [/message]
                [message]
                    speaker=inferno8
                    message=_"A mortal like you wouldn't understand the sheer perfection of flame. As long as I consume matter, I am immortal! And now... you shall be next to become fuel for my flames! You heard me sing, now prepare to get singed!"
                [/message]
            [/then]
        [/if]
        [if]
            [have_unit]
                id=inferno8_matriarch
                side=$hoplite_enemyside
            [/have_unit]
            [then]
                [message]
                    speaker=inferno8_matriarch
                    message=_"Is that... one of the sun-worshippers? Good to see my prey is in this world too."
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"Sun-worshippers? What are you talking about? In Sparta we have our own gods, and I know not about these 'sun-worshippers' you speak of."
                [/message]
                [message]
                    speaker=inferno8_matriarch
                    message=_"Hmmm, never seen a 'Sparta' on the invasion maps... But no matter! I'm in the mood for some good ol' fashioned killing, and your armor looks close enough to that of my prey. You will suffice as a replacement! Now prepare to die, human!"
                [/message]
            [/then]
        [/if]
        [if]
            [have_unit]
                id=Heindal
                side=$hoplite_enemyside
            [/have_unit]
            [then]
                #TODO: change this line for other classes that don't have shields!
                [message]
                    speaker=Heindal
                    message=_"Who are you supposed to be, hiding behind your shield like a coward?"
                [/message]
                [message]
                    id=Hoplite
                    message=_"You can lecture me on cowardice once you have slain half as many men and beasts as I have. You speak to $protagonist_name1|, $spartan_classname_lowercase1| from Sparta. Now stand aside!"
                [/message]
                [message]
                    speaker=Heindal
                    message=_"Killing rats doesn't make you a fighter, you loudmouth!"
                [/message]
                [message]
                    id=Hoplite
                    message=_"I gave you a chance to stand aside, you're not getting a second one. Now taste cold steel!"
                [/message]
            [/then]
        [/if]
        [if]
            [have_unit]
                id=amakri
                side=$hoplite_enemyside
            [/have_unit]
            [then]
                [message]
                    speaker=amakri
                    message=_"TODO!!!"
                [/message]
            [/then]
        [/if]
        {IF_VAR elizabethmet not_equals yes (
            [and]
                [have_unit]
                    id=Elizabeth
                [/have_unit]
            [/and]
            [then]
                [store_unit]
                    [filter]
                        id=Elizabeth
                    [/filter]
                    variable=tmp_elizabeth_position
                    kill=no
                [/store_unit]
                {SCROLL_TO $tmp_elizabeth_position.x $tmp_elizabeth_position.y}
                {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
                {MOVE_UNIT id=Hoplite,Hoplite2 $tmp_elizabeth_position.x $tmp_elizabeth_position.y}
                {CLEAR_VARIABLE tmp_elizabeth_position}
                [message]
                    speaker=Elizabeth
                    image="portraits/humans/mage-red+female.png~BLEND(0,0,0,0.95)"
                    message=_"So you have finally arrived. I hope the message glyphs I scattered nearby were of help to you. You may be wondering who I am, so let me get that out of the way..."
                [/message]
                [remove_object]
                    id=Elizabeth
                    object_id=conceal
                [/remove_object]
                [modify_unit]
                    [filter]
                        id=Elizabeth
                    [/filter]
                    name=_"Elizabeth"
                    {TRAIT_LOYAL}
                [/modify_unit]

                #TODO: expand/improve the dialog once I improve archmage/elizabeth to better fit into the Spartan story
                #right now the dialog is rather WIP

                [message]
                    speaker=Elizabeth
                    message=_"<i>*ahem*</i> I am Elizabeth, a Red Mage from Alduin Academy. And you are?"
                [/message]
                #using ifdef here didn't work, using if/have_unit
                [if]
                    [have_unit]
                        id=Hoplite2
                    [/have_unit]
                    [then]
                        [message]
                            id=Hoplite
                            message=_"I am $protagonist_name1|, a $spartan_classname_lowercase1| from Sparta."
                        [/message]
                        {IF_VAR spartan_selected_character1 equals $spartan_selected_character2 (
                        [then]
                        [message]
                            id=Hoplite2
                            message=_"And I am $protagonist_name2|, also a Spartan $spartan_classname_lowercase2| like him."
                        [/message]
                        [/then]
                        [else]
                        [message]
                            id=Hoplite2
                            message=_"And I am $protagonist_name2|, a $spartan_classname_lowercase2|, also from Sparta."
                        [/message]
                        [/else]
                        )}
                    [/then]
                    [else]
                        [message]
                            id=Hoplite
                            message=_"I am $protagonist_name1|, a $spartan_classname_lowercase1| from Sparta."
                        [/message]
                    [/else]
                [/if]
                [if]
                    [have_unit]
                        id=Algadur
                    [/have_unit]
                    [then]
                    #using ifdef here didn't work, using if/have_unit
                    [if]
                        [have_unit]
                            id=Hoplite2
                        [/have_unit]
                        [then]
                        [message]
                            speaker=Algadur
                            message=_"And I'm Algadur, shield-brother of $protagonist_name1| and $protagonist_name2| here. Those two saved my life from orcs, so I've been fighting alongside them since then."
                        [/message]
                        [/then]
                        [else]
                        [message]
                            speaker=Algadur
                            message=_"And I'm Algadur, shield-brother of $protagonist_name1| here. He saved my life from orcs, so I've been fighting alongside him since then."
                        [/message]
                        [/else]
                    [/if]
                    [/then]
                    [else]
                    [/else]
                [/if]
                [message]
                    speaker=Elizabeth
                    message=_"Sparta, you say? None of the maps of the Great Continent mention any such places... Where is it located exactly?"
                [/message]
                [message]
                    id=Hoplite
                    message=_"Sparta is not located on the Great Continent, nor anywhere in Irdya for that matter. I am from a different world altogether."
                [/message]
                [message]
                    speaker=Elizabeth
                    message=_"I see. So, $protagonist_name1|, what brings you to Irdya?"
                [/message]
                #using ifdef here didn't work, using if/have_unit
                [if]
                    [have_unit]
                        id=Hoplite2
                    [/have_unit]
                    [then]
                        [message]
                            id=Hoplite
                            message=_"Not long ago, Sparta has been attacked by Galatea. She brainwashed orcs, necromancers, and other beings from Irdya and used them for the invasion. While attacking, she accused of abducting her creator. His name is Mallion, I think. "
                        [/message]
                        [message]
                            id=Hoplite2
                            message=_"We managed to repel her invasion and I followed her into a portal to this world. Then I found a cave, where apparently Galatea's lair is local, then fought through dozens of her troops, found another smaller portal and ended up here."
                        [/message]
                    [/then]
                    [else]
                        [message]
                            id=Hoplite
                            message=_"Not long ago, Sparta has been attacked by Galatea. She brainwashed orcs, necromancers, and other beings from Irdya and used them for the invasion. While attacking, she accused of abducting her creator. His name is Mallion, I think. We managed to repel her invasion and I followed her into a portal to this world. Then I found a cave, where apparently Galatea's lair is local, then fought through dozens of her troops, found another smaller portal and ended up here."
                        [/message]
                    [/else]
                [/if]
                [message]
                    speaker=Elizabeth
                    message=_"Understood... Wait, did you just say Mallion?"
                [/message]
                [message]
                    id=Hoplite
                    message=_"Yes, what about him?"
                [/message]
                [message]
                    speaker=Elizabeth
                    message=_"I've actually entered the cave to investigate the rumors about Mallion. I heard that he has been doing magical experiments to open portals to different worlds. Though back then I haven't heard anything about this 'Galatea' you speak of, nor were the locals under her control yet."
                [/message]
                [message]
                    speaker=Elizabeth
                    message=_"Then eventually, I stumbled onto a purple portal, got a bit too curious... and well, here I am now. *sigh* There is nothing I desire more than getting out of this nightmare."
                [/message]

                #using ifdef here didn't work, using if/have_unit
                [if]
                    [have_unit]
                        id=Hoplite2
                    [/have_unit]
                    [then]
                        [message]
                            id=Hoplite
                            message=_"Admittedly, me and $protagonist_name2| got too curious with portals too. Since you have been stuck here longer than I, tell me what you know of this place. Is there a possibility of escape?"
                        [/message]
                        [message]
                            speaker=Elizabeth
                            message=_"There is, but... Well, how do I put it... there is one of the Grim Reaper's chambers ahead, with a portal back to the mortal world. I, obvious enough, am in no way skilled enough to tackle such a being alone. And that's where you two come in."
                        [/message]
                        [message]
                            id=Hoplite2
                            message=_"You think a few mortal warriors have a chance of fighting Death himself?! I... I am quite flattered, but..."
                        [/message]
                    [/then]
                    [else]
                        [message]
                            id=Hoplite
                            message=_"Admittedly I got too curious with portals too. Since you have been stuck here longer than I, tell me what you know of this place. Is there a possibility of escape?"
                        [/message]
                        [message]
                            speaker=Elizabeth
                            message=_"There is, but... Well, how do I put it... there is one of the Grim Reaper's chambers ahead, with a portal back to the mortal world. I, obvious enough, am in no way skilled enough to tackle such a being alone. And that's where you come in."
                        [/message]
                        [message]
                            id=Hoplite
                            message=_"You think a mortal warrior like me has a chance of fighting Death himself?! I... I am quite flattered, but..."
                        [/message]
                    [/else]
                [/if]

                [message]
                    speaker=Algadur
                    message=_"You want us to fight Death himself?! Are ya out of yer damn mind, woman?!"
                [/message]
                [message]
                    speaker=Elizabeth
                    message=_"Yes, I fully understand that isn't exactly the best-sounding idea, but what choice do we have? We could sit here for eternity and slowly go insane, <b>or</b> we could gamble our souls for a chance to leave this place. The latter option isn't exactly that great, but it seems to me like he lesser of two evils."
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"I suppose you are right, we have not much left to lose and a lot to gain. Very well, time to make the impossible possible!"
                [/message]
                [message]
                    speaker=Algadur
                    message=_"Argh, fine, I guess ye're givin' us no choice, lass... Very well, let's do 'tis." #wmllint: no spellcheck
                [/message]
                {ACHIEVEMENT_MESSAGE elizabeth}
                {SPARTAN_ACHIEVEMENT_MESSAGE_IF_CLASS_MATCHES sorcerer elizabeth_sorcerer 1}
                {SPARTAN_ACHIEVEMENT_MESSAGE_IF_CLASS_MATCHES sorcerer elizabeth_sorcerer 2}

                {SPARTAN_SMOOTH_REPLACE_MUSIC ooze.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
                {SPARTAN_SMOOTH_REPLACE_MUSIC the_deep_path.ogg 1000 0}
#endif
                {VARIABLE elizabethmet yes}
            [/then]
        )}
        {IF_VAR elizabeth_cooldown less_than 1 (
            [and]
                {VARIABLE_CONDITIONAL Elizabeth_stored.x greater_than 0}
            [/and]
            [and]
                {VARIABLE_CONDITIONAL hoplite_depth greater_than 0}
                [or]
                    {VARIABLE_CONDITIONAL elizabethstays not_equals yes}
                [/or]
            [/and]
            [then]
                [unstore_unit]
                    variable=Elizabeth_stored
                    find_vacant=yes
                    x,y=6,10
                [/unstore_unit]
                {CLEAR_VARIABLE Elizabeth_stored}
                [animate_unit]
                    flag=post_teleport
                    [filter]
                        id=Elizabeth
                    [/filter]
                [/animate_unit]
                {IF_VAR elizabethstays equals yes (
                    [then]
                        [message]
                            speaker=Elizabeth
                            message=_"Hey, you're back! How's your trip to the underworld been? Fine, you say? Good to hear that."
                        [/message]
                        {CLEAR_VARIABLE elizabethstays}
                    [/then]
                    [else]
                        {RANDOM 1..3}
                        {IF_VAR random equals 1 (
                            [then]
                                [message]
                                    speaker=Elizabeth
                                    message=_"Hey, I'm back! Hope I didn't miss anything important..."
                                [/message]
                            [/then]
                        )}
                        {IF_VAR random equals 2 (
                            [then]
                                [message]
                                    speaker=Elizabeth
                                    message=_"Whew, I'm back! Did I miss much of the fun? No? Good to know."
                                [/message]
                            [/then]
                        )}
                        {IF_VAR random equals 3 (
                            [then]
                                [message]
                                    speaker=Elizabeth
                                    message=_"Man, that was quite the rest! Too bad I now have to fight again..."
                                [/message]
                            [/then]
                        )}
                    [/else]
                )}
                {CLEAR_VARIABLE Elizabeth_stored}
            [/then]
        )}
        {IF_VAR algadur_cooldown less_than 1 (
            [and]
                {VARIABLE_CONDITIONAL Algadur_stored.x greater_than 0}
            [/and]
            [and]
                {VARIABLE_CONDITIONAL hoplite_depth greater_than 0}
                [or]
                    {VARIABLE_CONDITIONAL algadurstays not_equals yes}
                [/or]
            [/and]
            [then]
                [unstore_unit]
                    variable=Algadur_stored
                    find_vacant=yes
                    x,y=6,10
                [/unstore_unit]
                {CLEAR_VARIABLE Algadur_stored}
                {IF_VAR algadurstays equals yes (
                    [then]
                        [message]
                            speaker=Algadur
                            message=_"Ye're back! Glad ta see ya in one piece, lad."
                        [/message]
                        {CLEAR_VARIABLE algadurstays}
                    [/then]
                    [else]
                        {RANDOM 1..3}
                        {IF_VAR random equals 1 (
                            [then]
                                [message]
                                    speaker=Algadur
                                    message=_"I'm back, sorry for keepin' ya waiting'."
                                [/message]
                            [/then]
                        )}
                        {IF_VAR random equals 2 (
                            [then]
                                [message]
                                    speaker=Algadur
                                    message=_"I'm back and ready ta fight! Now, whose head should I chop off 'tis time?"
                                [/message]
                            [/then]
                        )}
                        {IF_VAR random equals 3 (
                            [then]
                                [message]
                                    speaker=Algadur
                                    message=_"I'm back. How am I, ye ask? Don't worry, lad, 'tis just a flesh wound, survived worse."
                                [/message]
                            [/then]
                        )}
                    [/else]
                )}
                {CLEAR_VARIABLE Algadur_stored}
            [/then]
        )}
        {IF_VAR chaos_line1 not_equals yes (
            [and]
                [have_unit]
                    side=$hoplite_enemyside
                    type=Hoplite_Chaosinvader
                [/have_unit]
            [/and]
            [and]
                {VARIABLE_CONDITIONAL bossfight not_equals yes}
            [/and]
            [and]
                [not]
                    [have_unit]
                        id=Donovan
                    [/have_unit]
                [/not]
            [/and]
            [then]
                [if]
                    [have_unit]
                        side=$hoplite_allyside
                        ability=hoplite_companion
                    [/have_unit]
                    [or]
                        [have_unit]
                            id=Hoplite2
                        [/have_unit]
                    [/or]
                    [then]
                        [message]
                            type=Hoplite_Chaosinvader
                            # wmllint: local spelling Chaaaarge
                            message=_"Look, brothers! It is the very heretics Brother Donovan warned us about! Let us show these heathen wretches the might of Uria! Chaaaarge!"
                        [/message]
                    [/then]
                    [else]
                        [message]
                            type=Hoplite_Chaosinvader
                            message=_"Look, brothers! It is the very heretic Brother Donovan warned us about! Let us show this heathen wretch the might of Uria! Chaaaarge!"
                        [/message]
                    [/else]
                [/if]
                [message]
                    speaker=Algadur
                    # wmllint: local spelling demon-worshippin
                    message=_"These demon-worshippin' lunatics are 'ere too?! Bloody hell, they must've overrun half the caves already!"
                [/message]
                {VARIABLE chaos_line1 yes}
            [/then]
        )}
        {IF_VAR donovanmet not_equals yes (
            [and]
                [have_unit]
                    id=Donovan
                    side=$hoplite_enemyside
                [/have_unit]
            [/and]
            [then]
                {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}

                [message]
                    speaker=Donovan
                    message=_"Halt in the name of Her Majesty Galatea! Too long have you been an obstacle to her plans, but I will not allow you to interfere in our ice magic experiments too!"
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"I won't let yet another one of Galatea's brainwashed warriors stand in my way, and I certainly not let you keep amassing your ice statue army either. Bring it on!"
                [/message]
                [message]
                    speaker=Donovan
                    message=_"You are no match for the power of ice magic, as I will now demonstrate."
                [/message]
                [message]
                    speaker=Donovan
                    message=_"Kill the intruder!"
                [/message]

                {SPARTAN_SMOOTH_REPLACE_MUSIC mad-mad-men.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
                {SPARTAN_SMOOTH_REPLACE_MUSIC battle-epic.ogg 1000 0}
#endif
            [/then]
        )}

        #old dialog

        {IF_VAR donovanmet not_equals yes (
            [and]
                [have_unit]
                    id=Donovan_old
                    side=$hoplite_enemyside
                [/have_unit]
            [/and]
            [then]
                {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
                [hide_unit]
                    side=$hoplite_allyside
                [/hide_unit]
                {MOVE_UNIT id=Hoplite,Hoplite2 6 7}

                #TODO: properly rewrite the character or outright replace him. currently just made him not quite a chaos empire member

                #	[message]
                #	        speaker=Donovan
                #	        message=_"Halt in the name of Uria, soldier! The armor you're wearing is not of the standard approved by the imperial armory. Explain yourself!"
                #	[/message]
                #	[message]
                #	        id=Hoplite,Hoplite2
                #	        message=_"I am not from this empire you speak of. I am a hoplite from Sparta."
                #	[/message]
                #	[message]
                #	        speaker=Donovan
                #	        message=_"Oh, so are not part of the imperial army, right... Well, we are quite eager to hire some mercenaries, to replace the regiments lost #due to our recent conquest. Capable warriors like you are in high demand but short supply, after all. Here's the offer: pledge your allegiance #to our glorious empire, and you shall receive the honor of serving our goddess Uria as a fellow knight of chaos, and a payment of 55 Urvathan #silver a month."
                #	[/message]
                #	[message]
                #	        id=Hoplite,Hoplite2
                #	        message=_"My allegiance is to Sparta, and Sparta only. Nor do I worship gods outside our pantheon. Now stand aside, knight, I am on a very #important quest."
                #	[/message]
                #	[message]
                #	        speaker=Donovan
                #	        message=_"You... you dare to reject my generosity, you ungrateful heathen wretch?! Are you truly so blind as to not see that Uria is the one and #only true god?! Hrmph... very well, if you refuse to serve her in life, then you shall have to serve her in death! En garde, heretic! May Uria #have mercy on your soul, for I will not!"
                #	[/message]

                #temporary dialog until character gets rewritten or more likely replaced

                [message]
                    speaker=Donovan
                    message=_"Halt in the name of Her Majesty Galatea, worthy foe! Too long have you been an obstacle to her plans, so I shall put an end to you!"
                [/message]
                [message]
                    id=Hoplite,Hoplite2
                    message=_"I won't let yet another brainwashed warrior stand in my way, bring it on!"
                [/message]
                [message]
                    speaker=Donovan
                    message=_"Very well then. Charge!"
                [/message]

                {SPARTAN_SMOOTH_REPLACE_MUSIC mad-mad-men.ogg 1000 0}
#ifndef SPARTAN_MUSIC_FOUND
                {SPARTAN_SMOOTH_REPLACE_MUSIC battle-epic.ogg 1000 0}
#endif
                [unhide_unit]
                    side=$hoplite_allyside
                [/unhide_unit]
                {HOPLITE_UNSTORE_COMPANIONS}
            [/then]
        )}
        [if]
            [have_unit]
                id=merchant
            [/have_unit]
            [then]
                #this macro is in the orb shop file, to make it easier to manage the dialog
                {SPARTAN_MERCHANT_DIALOG}
            [/then]
        [/if]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Hoplite_Spider_Queen
        [/filter]
        [message]
            speaker=unit
            message=_"Damn you, $spartan_classname_lowercase1|! Damn you Athena for turning me into this! Damn you Galatea for giving me useless troops! Damn you AAAAAAAAAAAAAAAAAAAAALL!!!!..." #wmllint: no spellcheck
        [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Hoplite_Archmage
            [not]
                [filter_wml]
                    variation=shaxtal
                [/filter_wml]
            [/not]
        [/filter]
        {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 500 0}
#ifdef MULTIPLAYER
        [message]
            speaker=unit
            message=_"All the effort I put in to protect these priceless tomes from Galatea, ended by two of demon assassins..."
        [/message]
        [message]
            id=Hoplite
            message=_"Once again, neither of us is a demon!"
        [/message]
        [message]
            id=Hoplite2
            message=_"Nor are we on Galatea's side for that matter."
        [/message]

        {SPARTAN_DIALOG_MP_DEPENDING_ON_CLASS sorcerer (
        [message]
            speaker=unit
            message=_"If you are actually telling the truth, I have one... last wish. Take the most valuable spellbooks with you (points to a specific bookshelf) these ones, so they don't fall into the enemy's hands. You two are quite skilled mages, but I believe these books will help you improve even further."
        [/message]

        ) (
        [message]
            speaker=unit
            message=_"If you are actually telling the truth, I have one... last wish. Take the most valuable spellbooks with you (points to a specific bookshelf) these ones, so they don't fall into the enemy's hands. One of you is clearly a skilled mage, and even the other seems to show some magical potential."
        [/message]
        ) (
        [message]
            speaker=unit
            message=_"If you are actually telling the truth, I have one... last wish. Take the most valuable spellbooks with you (points to a specific bookshelf) these ones, so they don't fall into the enemy's hands. You two don't exactly look like mages, but somehow I sense a lot of magical potential in you, perhaps you can make use of them..."
        [/message]
        )}
#else
        [message]
            speaker=unit
            #	   message=_"All the effort I put in to preserve the little I could save from the Alduin academy, ended by one demon assassin..."
            message=_"All the effort I put in to protect these priceless tomes from Galatea, ended by one demon assassin..."
        [/message]
        [message]
            id=Hoplite,Hoplite2
            message=_"Once again, I am not a demon, nor am I on Galatea's side!"
        [/message]
        [if]
        {VARIABLE_CONDITIONAL spartan_selected_character1 equals sorcerer}
        [then]
        [message]
            speaker=unit
            message=_"If you are actually telling the truth, I have one... last wish. Take the most valuable spellbooks with you (points to a specific bookshelf) these ones, so they don't fall into the enemy's hands. You are clearly quite a skilled mage, but I believe these books will help you improve even further."
        [/message]
        [/then]
        [else]
        [message]
            speaker=unit
            message=_"If you are actually telling the truth, I have one... last wish. Take the most valuable spellbooks with you (points to a specific bookshelf) these ones, so they don't fall into the enemy's hands. You don't exactly look like a mage, but somehow I sense a lot of magical potential in you, perhaps you can make use of them..."
        [/message]
        [/else]
        [/if]
#endif
        [message]
            speaker=unit
            message=_"And if you ever run into... my apprentice Elizabeth, please don't tell her... that you... fatally wounded me. I don't want to continue the cycle of pointless bloodshed that I started..."
        [/message]
        [message]
            id=Hoplite,Hoplite2
            # wmllint: local spelling Pyromancy
#ifdef MULTIPLAYER
            message=_"Very well, we will honor your request. (takes the books) Let's see... 'Advanced Teleportation', 'Enthralling', 'Pyromancy' and more. Definitely worth giving it a read."
#else
            message=_"Very well, I will honor your request. (takes the books) Let's see... 'Advanced Teleportation', 'Enthralling', 'Pyromancy' and more. Definitely worth giving it a read."
#endif
        [/message]

        #TODO idea: add option to spare the archmage if you have the healing potion upgrade
        #TODO: sparing the archmage could be one of the steps required to get true ending

        #	[message]
        #	   speaker=unit
        #	   message=_"You have won this fight, but that does not mean won the war. If the Chaos Empire seizes the Prometheus' Heart, then they will only be even closer to their goals. *sigh* All the effort I put in to preserve the little I could save from the Alduin academy, only to soon go to waste. If you truly intend to destroy the place, at least spare the spellbooks..."
        #	[/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Hoplite_Ares
        [/filter]
        [message]
            speaker=unit
            message=_"You've proven yourself more than worthy. Take the holy armaments and continue your quest!"
        [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Hoplite_Archmage
            [filter_wml]
                variation=shaxtal
            [/filter_wml]
        [/filter]
        {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 500 0}
        [message]
            speaker=unit
            message=_"Error: critical condition. Reporting mission failure. Initiating shutdown and memory wipe."
        [/message]
    [/event]
    #TODO: investigate whether this dialog even triggers properly
    [event]
        name=die
        id=shaxtal_death_dialog
        first_time_only=yes
        [filter]
            type=Hoplite_Archmage
            [filter_wml]
                variation=shaxtal
            [/filter_wml]
        [/filter]
        [message]
            speaker=Elizabeth
            message=_"Wow... just wow... to think we have just brought down this abomination..."
        [/message]
        [message]
            speaker=Algadur
            message=_"Aye, find it hard ta believe it too."
        [/message]
        [message]
            speaker=Elizabeth
            message=_"We may have barely escaped the Chaos Empire's grip, but at the same time made them view us as more than just mere rabble. We must find the gem as soon as we can, and flee as far as possible, else this won't be the worst we'll see of their wrath."
        [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Hoplite_Donovan
        [/filter]
        {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 500 0}
        [if]
            [have_unit]
                id=Hoplite2
            [/have_unit]
            [then]
                {IF_VAR spartan_selected_character1 equals $spartan_selected_character2 (
                [then]
                [message]
                    speaker=unit
                    message=_"I lost... lost to two $spartan_classname_lowercase1|s, even with all the ice magic I had... I failed be useful to Galatea..."
                [/message]
                [/then]
                [else]
                [message]
                    speaker=unit
                    message=_"I lost... lost to a $spartan_classname_lowercase1| and a $spartan_classname_lowercase2|, even with all the ice magic I had... I failed be useful to Galatea..."
                [/message]
                [/else]
                )}
            [/then]
            [else]
                [message]
                    speaker=unit
                    message=_"I lost... lost to one damn $spartan_classname_lowercase1|, even with all the ice magic I had... I failed be useful to Galatea..."
                [/message]
            [/else]
        [/if]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Hoplite_Scylla
        [/filter]
        {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 500 0}
        [message]
            speaker=unit
            message=_"You may have besssted me, human, but know that the other Stormtails will avenge my death..." #wmllint: no spellcheck
        [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Hoplite_Warlock
        [/filter]
        [message]
            speaker=unit
            #	   message=_"Hail... Uria..."
            message=_"Hail... Galatea..."
        [/message]
    [/event]
    [event]
        name=die
        first_time_only=yes
        [filter]
            type=Hoplite_Donovan
        [/filter]
        [if]
            [have_unit]
                id=Algadur
            [/have_unit]
            [then]
                [message]
                    speaker=Algadur
                    #	   message=_"Serves 'im right, that lunatic! Them bloody demon-worshippers deserve far worse than death for what they've done ta my kind!"
                    message=_"Serves 'im right, that Galatea-worshipping lunatic!"
                [/message]
            [/then]
        [/if]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Hoplite_Grimreaper
        [/filter]
        {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 1000 0}
        [message]
            speaker=unit
            message=_"..."
        [/message]
        [delay]
            time=500
        [/delay]
        [message]
            speaker=unit
            message=_"Very well, mortal, that was rather entertaining. You have earned the right to return to the mortal realm, and retain your existence for now. I have to leave now, as there are still thousands of souls left for me to harvest..."
        [/message]
    [/event]
    #Galatea last breath event for the boss version:
    [event]
        name=last breath
        id=galatea_death_dialog
        first_time_only=yes
        [filter]
            id=Galatea
            side=$hoplite_enemyside
            ability=hoplite_boss
        [/filter]
        {SPARTAN_SMOOTH_REPLACE_MUSIC silence.ogg 500 0}
        {FLASH_WHITE (
            [sound]
                name=lightning.ogg
            [/sound]
            [sound]
                name=mace.wav
            [/sound]
            {VARIABLE reaper_being_unstored yes}
            [kill]
                side=$hoplite_enemyside
                [not]
                    id=$unit.id#to avoid some bugs with events
                [/not]
                animate=no
                fire_event=yes
            [/kill]
            {CLEAR_VARIABLE reaper_being_unstored}
            {TRANSFORM_UNIT id=Galatea Hoplite_Galatea_defeated}
        )}

#        [delay]
#            time=3000
#        [/delay]

#        {SPARTAN_SMOOTH_REPLACE_MUSIC sing.ogg 500 0}

        [if]
        {VARIABLE_CONDITIONAL spartan_pact_overlord greater_than 0}
        [then]
        {SPARTAN_SMOOTH_REPLACE_MUSIC eternal.ogg 500 0}
        [delay]
            time=3000
        [/delay]
        [store_unit]
            [filter]
                id=Hoplite,Hoplite2
            [/filter]
            variable=hoplite_protagonist_portraits
            kill=no
        [/store_unit]
        [message]
            speaker=unit
            message=_"I have failed... my armies are gone, my enchanted armor is shattered, yet worst of all I failed to save Mallion... Before you kill me-"
        [/message]
        [message]
            speaker=Hoplite
            image="$hoplite_protagonist_portraits[0].profile|~BLIT(portraits/cloaked2.png~BLEND(0,0,0,1)~O(50%))" 
            message=_"You have outlived your usefulness for now, by $protagonist_name1|'s hands I will strike you down."
        [/message]
        [store_unit]
            [filter]
                id=Galatea
            [/filter]
            variable=tmp_galatea_loc
            kill=no
        [/store_unit]
        {MOVE_UNIT id=Hoplite $tmp_galatea_loc.x $tmp_galatea_loc.y}
        #possessed player character hits Galatea several times to finish her off
        {REPEAT 3 (
        [animate_unit]
            flag=attack
            hits=yes
            [filter]
                id=Hoplite
            [/filter]
            [primary_attack]
                range=melee
            [/primary_attack]
            [facing]
                [filter]
                    id=Galatea
                [/filter]
            [/facing]
            [animate]
            flag=defend
            hits=yes
            [filter]
                id=Galatea
            [/filter]
            [facing]
                [filter]
                    id=Xerxix
                [/filter]
            [/facing]
            [/animate]
        [/animate_unit]
        )}

        [/then]
        [else]

        {SPARTAN_SMOOTH_REPLACE_MUSIC Returning_in_Time.ogg 500 0}
        [delay]
            time=3000
        [/delay]

        [message]
            speaker=unit
            message=_"I have failed... my armies are gone, my enchanted armor is shattered, yet worst of all I failed to save Mallion... Before you kill me, please... at least tell me why your kind abducted my creator."
        [/message]
        [message]
            id=Hoplite,Hoplite2
            message=_"As we tried to tell you countless times before, we did not capture Mallion, nor even know where or who he is. I swear that in the name of Athena."
        [/message]
        [message]
            speaker=unit
            message=_"But I have sensed his beating heart in Sparta! I am entirely certain of that!"
        [/message]
        [message]
            id=Hoplite,Hoplite2
            message=_"So you were not lying about that then? Strange... Perhaps someone deceived you with some kind of false replica?"
        [/message]
        [message]
            speaker=unit
            message=_"If you really were telling the truth, then that would mean... all this bloodshed... was completely pointless... No... no... no... What have I done?!..."
        [/message]
        #Galatea tells about her interactions with the Merchant and gives a lot of clues, without outright stating it was him

        ##using into_the_shadows.ogg music again as a subtle hint about the Merchant
        #{SPARTAN_SMOOTH_REPLACE_MUSIC into_the_shadows.ogg 2000 0}
        [message]
            id=Hoplite,Hoplite2
            message=_"Tell me at least, what made you decide to invade our world specifically in search of your creator? He was in Irdya before, was he not? Of all the worlds that may possibly exist, why ours?"
        [/message]
        [delay]
            time=500
        [/delay]
        [message]
            speaker=unit
            message=_"Not too long ago, Mallion went missing. I knew he did some experiments in this cave, so it was the place I began to search first. I have not been yet able to find Mallion's own workshop... however, I stumbled onto something... or should I say someone else."
        [/message]
        [message]
            speaker=unit
            #the "old friend of Mallion" part is a lie from the Merchant
            message=_"I could not see his face, but I could sense a very unusual aura from him. He said he was an old friend of Mallion, and he told me my creator was in danger, a prisoner in another world... your world."
        [/message]
        [message]
            speaker=unit
            message=_"He told me I would not a stand a chance against your armies alone... but he offered me a deal. He sold me unimaginable powers, made whole armies bend to my will, and taught me Mallion's spells for traveling between worlds."
        [/message]
        [message]
            id=Hoplite,Hoplite2
            message=_"Who is he?"
        [/message]
        [message]
            speaker=unit
            message=_"He..."
        [/message]
        #Xerxix arrives to kill Galatea before she can reveal too much info to the player
        {SPARTAN_SMOOTH_REPLACE_MUSIC overlive.ogg 500 0}

        {SPARTAN_SPAWN_MENTOR 6 10}
        [message]
            speaker=Xerxix
            message=_"IT'S A TRAP!!! STAY BACK!!!"
        [/message]

        [store_unit]
            [filter]
                id=Galatea
            [/filter]
            variable=tmp_galatea_loc
            kill=no
        [/store_unit]
        {MOVE_UNIT id=Xerxix $tmp_galatea_loc.x $tmp_galatea_loc.y}
        #Xerxix hits Galatea several times to finish her off
        {REPEAT 5 (
        [animate_unit]
            flag=attack
            hits=yes
            [filter]
                id=Xerxix
            [/filter]
            [primary_attack]
                name=staff
            [/primary_attack]
            [facing]
                [filter]
                    id=Galatea
                [/filter]
            [/facing]
            [animate]
            flag=defend
            hits=yes
            [filter]
                id=Galatea
            [/filter]
            [facing]
                [filter]
                    id=Xerxix
                [/filter]
            [/facing]
            [/animate]
        [/animate_unit]
        )}
        [/else]
        [/if]
        {CLEAR_VARIABLE tmp_galatea_loc}
        {CLEAR_VARIABLE hoplite_protagonist_portraits}
    [/event]
    [event]
        id=spartan_cutscene_after_galatea_death
        first_time_only=yes
        [if]
        {VARIABLE_CONDITIONAL spartan_pact_overlord greater_than 0}
        [then]
        [store_unit]
            [filter]
                id=Hoplite,Hoplite2
            [/filter]
            variable=hoplite_protagonist_portraits
            kill=no
        [/store_unit]
            [if]
            [have_unit]
                id=Algadur
                [or]
                    id=Elizabeth
                [/or]
            [/have_unit]
            [then]
            [message]
                id=Algadur
                message=_"By Thursagan's beard! W-what is going on..."
            [/message]
            [message]
                id=Elizabeth
                message=_"No... no... "
            [/message]
    
            [message]
                id=Hoplite
                message=_"I... I'm losing control... He has almost fully taken my body, I... he... could kill you!!!... Run!!!"
            [/message]
            [message]
                id=Algadur
                message=_"It pains me ta lose a shield-brother, but I'll do as ye command."
            [/message]
    
            {MOVE_UNIT id=Algadur 6 10}
            [kill]
                id=Algadur
                animate=no
                fire_event=no
            [/kill]

            [message]
                id=Elizabeth
                message=_"Very well... It pains me to leave you here, but I will do as you say."
            [/message]
    
            {MOVE_UNIT id=Elizabeth 6 10}
            [kill]
                id=Elizabeth
                animate=no
                fire_event=no
            [/kill]

            [message]
                caption=_"Unknown Voice"
                image="portraits/cloaked2.png~BLEND(0,0,0,1)~O(50%)"
                message=_"Do not worry, puppet, I have no interest in your allies."
            [/message]
    
            [/then]
            [/if]

            [message]
                speaker=Hoplite
                image="$hoplite_protagonist_portraits[0].profile|~BLIT(portraits/cloaked2.png~BLEND(0,0,0,1)~O(50%))" 
                message=_"Now, with Galatea out of the picture, it's time to return again, and continue the cycle anew."
            [/message]

            {FLASH_WHITE (
                [sound]
                    name=lightning.ogg
                [/sound]
                #portal looks like the underworld portal for now
                #TODO: maybe use a different sprite, but keep it purple as a hint that it's made by the Merchant
                [item]
                    image="scenery/summoning-center.png~GS()~CS(150,0,180)~NO_TOD_SHIFT()"
                    x,y=6,2
                [/item]
            )}

            {MOVE_UNIT id=Hoplite 6 2}
            {MOVE_UNIT id=Hoplite2 6 2}

            {SPARTAN_VICTORY_REWARD 1}
            {VARIABLE_OP spartan_orbshop_data1.pact_of_overlord_wins add 1}
#ifdef MULTIPLAYER
#ifndef LOCALMP
            {SPARTAN_VICTORY_REWARD 2}
            {VARIABLE_OP spartan_orbshop_data2.pact_of_overlord_wins add 1}
#endif
#endif
            {ACHIEVEMENT_MESSAGE overlord_ending}

            {SPARTAN_SYNC_ORBSHOP_DATA}


            [fire_event]
                id=spartan_victory_achievements
            [/fire_event]
            {SPARTAN_REWIND_TIME_ENDING}

        [/then]
        [else]

        [message]
            id=Hoplite,Hoplite2
            message=_"Xerxix?! What in the name of Athena are you doing?! I was trying to get information out of her!"
        [/message]
        [message]
            speaker=Xerxix
            #Xerxix is lying here
            #ifdef MULTIPLAYER
            message=_"A pretty face and some lies is all it took for you to get distracted from killing her! You two are too naive, $protagonist_name1| and $protagonist_name2|. She was just buying time to cast an even deadlier spell! Had I been a second too late she would have vaporized you!"
            #else
            message=_"A pretty face and some lies is all it took for you to get distracted from killing her! You are too naive, $protagonist_name1|. She was just buying time to cast an even deadlier spell! Had I been a second too late she would have vaporized you!"
            #endif
        [/message]
        [message]
            id=Hoplite,Hoplite2
            message=_"If you say so..."
        [/message]
        {SPARTAN_SMOOTH_REPLACE_MUSIC homeward_bound.ogg 1000 0}
        [message]
            speaker=Xerxix
            message=_"Anyway, that... risky delay aside, congratulations on defeating the evil queen! Irdya is now saved thanks to your valiant efforts!"
        [/message]
        [message]
            id=Hoplite,Hoplite2
            message=_"Now that my mission is done, do you know how I can return to my world again?"
        [/message]
        [message]
            speaker=Xerxix
            message=_"I think I can find the right spell in her book..."
        [/message]
        [delay]
            time=2000
        [/delay]
        [message]
            speaker=Xerxix
            message=_"Aha, found it! She wrote down the spell here, now, I shall open the portal for you!"
        [/message]

        {FLASH_WHITE (
            [sound]
                name=lightning.ogg
            [/sound]
            #portal looks like the underworld portal for now
            #TODO: maybe use a different sprite, but keep it purple as a hint that it's made by the Merchant
            [item]
                image="scenery/summoning-center.png~GS()~CS(150,0,180)~NO_TOD_SHIFT()"
                x,y=6,2
            [/item]
        )}
        [message]
            speaker=Xerxix
            message=_"It worked! Now just step into the portal and you will be back home!"
        [/message]
        [message]
            id=Hoplite,Hoplite2
            message=_"Thank you, Xerxix."
        [/message]
        [if]
        [have_unit]
            id=Algadur
        [/have_unit]
        [then]
            [message]
                id=Algadur
                #ifdef MULTIPLAYER
                message=_"It has been an honor to fight alongside ya, $protagonist_name1| and $protagonist_name2|! Ye were the best shield-brothers I ever had!"
                #else
                message=_"It has been an honor to fight alongside ya, $protagonist_name1|! Ye were the best shield-brother I ever had!"
                #endif
            [/message]
        [/then]
        [/if]

        [if]
        [have_unit]
            id=Elizabeth
        [/have_unit]
        [then]
        [message]
            speaker=Elizabeth
            #ifdef MULTIPLAYER
            message=_"Thank you again for helping me return to the mortal world, $protagonist_name1| and $protagonist_name2|!"
            #else
            message=_"Thank you again for helping me return to the mortal world, $protagonist_name1|!"
            #endif
        [/message]
        [/then]
        [/if]

        [if]
            [have_unit]
                id=Algadur
                [or]
                    id=Elizabeth
                [/or]
            [/have_unit]
            [then]
            [message]
                id=Hoplite,Hoplite2
                message=_"I was glad to have you on my side too. But now I must go back to my homeland."
            [/message]
            [/then]
        [/if]

        #remove the "no swapping/orders" ability that Xerxix had for the tutorial, to avoid him softlocking the exit

        [object]
            silent=yes
            duration=forever
            [filter]
                id=Xerxix
            [/filter]
            [effect]
                apply_to=remove_ability
                [abilities]
                    {SPARTAN_ALLY_IMMOVABLE}
                [/abilities]
            [/effect]
        [/object]

        #the ending cutscene creates a moveto event for the portal

        [event]
            name=moveto
            [filter]
                side=$hoplite_playerside
                x,y=6,2
            [/filter]
            {SPARTAN_VICTORY_REWARD 1}
#ifdef MULTIPLAYER
#ifndef LOCALMP
            {SPARTAN_VICTORY_REWARD 2}
#endif
#endif
            [fire_event]
                id=spartan_victory_achievements
            [/fire_event]
            {SPARTAN_REWIND_TIME_ENDING}
        [/event]
        [/else]
        [/if]
        {CLEAR_VARIABLE hoplite_protagonist_portraits}
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            id=inferno8
            side=$hoplite_enemyside
        [/filter]
        [message]
            speaker=unit
            message=_"As they say, the fire that burns twice as bright... burns half as long..."
        [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            id=inferno8_matriarch
            side=$hoplite_enemyside
        [/filter]
        [message]
            speaker=unit
            message=_"Argh, not only did I not find my original prey, but I even failed to kill a substitute... The dark gods won't be pleased with me in the afterlife..."
        [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            id=Heindal
            side=$hoplite_enemyside
        [/filter]
        [message]
            speaker=unit
            message=_"You scumbag ... arggghh."
        [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            id=amakri
            side=$hoplite_enemyside
        [/filter]
        [message]
            speaker=unit
            message=_"TODO!!!"
        [/message]
    [/event]
    [event]
        name=spartan_enthrall
        first_time_only=yes
        [filter]
            id=Jeremias
        [/filter]
        [message]
            speaker=unit
            message=_"Um, I'll help, but only if the danger stays, like, really far away from me."
        [/message]
    [/event]
    [event]
        name=spartan_enthrall
        first_time_only=yes
        [filter]
            id=inferno8
        [/filter]
        [message]
            speaker=unit
            message=_"Somehow my rage towards you... just disappeared. My apologies about the whole 'trying to burn you to death' situation. I decided that from now on I will burn your enemies instead!"
        [/message]
        [message]
            speaker=second_unit
            message=_"Very well."
        [/message]
    [/event]
    [event]
        name=spartan_enthrall
        first_time_only=yes
        [filter]
            id=inferno8_matriarch
        [/filter]
        [message]
            speaker=unit
            message=_"<i>*blushes*</i> A mind control spell? My, my, you're a far more interesting man than you seemed at first glance, not like those boring sun-worshippers I mistook you for. *giggles*"
        [/message]
        [message]
            speaker=second_unit
            message=_"Wait, you saw through the spell?"
        [/message]
        [message]
            speaker=unit
            message=_"Yes, spells like that are somewhat common in my homeland, so I've gotten good at repelling them. But honestly I am impressed enough that I'll tag along with you anyway!"
        [/message]
        [message]
            speaker=unit
            message=_"I can do all sorts of things for you even without the spell *winks*"
        [/message]
        [if]
            [have_unit]
                id=Elizabeth
            [/have_unit]
            [then]
                [message]
                    speaker=second_unit
                    message=_"Erm, well... While I do admit you are quite attractive..."
                [/message]
                [message]
                    speaker=Elizabeth
                    message=_"Snap out of it, $protagonist_name$second_unit.side||! She tried to kill us not to long ago, don't just fall for her seduction!"
                [/message]
                [message]
                    speaker=unit
                    message=_"Don't ruin the moment, damn it! Are you perhaps... jealous? *giggles*"
                [/message]
                [message]
                    speaker=Elizabeth
                    message=_"..."
                [/message]
                [message]
                    speaker=second_unit
                    message=_"Alright, ladies, let's just return to combat for now, we can sort this out later."
                [/message]
                [message]
                    speaker=unit
                    message=_"Very well. Time to slice your enemies into tiny bits!"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=second_unit
                    message=_"Erm, well... While I do admit you are quite attractive, we're also in the middle of a battle right now, not exactly the best time nor place for what you are suggesting."
                [/message]
                [message]
                    speaker=unit
                    message=_"Very well, we can discuss this some other time. Time to slice your enemies into tiny bits!"
                [/message]
            [/else]
        [/if]
    [/event]
    [event]
        name=spartan_enthrall
        first_time_only=yes
        [filter]
            id=Heindal
        [/filter]
        [message]
            speaker=unit
            message=_"Maybe you are not such a loudmouth after all... I'll join you."
        [/message]
    [/event]
    [event]
        name=spartan_enthrall
        first_time_only=yes
        [filter]
            id=amakri
        [/filter]
        [message]
            speaker=unit
            message=_"TODO!!!"
        [/message]
    [/event]
    [event]
        name=die
        first_time_only=yes
        [filter]
            type=Hoplite_Grimreaper
        [/filter]
        [message]
            speaker=Elizabeth
            message=_"(heavy breathing) We... did it? My goodness, we actually did it!"
        [/message]
        [message]
            speaker=Algadur
            message=_"Ta think I'd 'ave ta fight the Death it-bloody-self! 'tis was quite the day, admittedly."
        [/message]
        [message]
            id=Hoplite,Hoplite2
            message=_"No time for chit-chat, we must hurry to the portal at once!"
        [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Algadur
            type=Hoplite_Steelclad
        [/filter]
        [message]
            speaker=unit
            message=_"Argh... ye orcish swines won't get me today. I'll shall avenge my brothers later, but now I must run..."
        [/message]
        {MOVE_UNIT id=Algadur 6 2}
        [kill]
            id=Algadur
            animate=no
            fire_event=no
        [/kill]
    [/event]
    [event]
        name=last breath
        first_time_only=no
        [filter]
            side=$hoplite_allyside
            ability=hoplite_companion
        [/filter]
        [switch]
            variable=unit.type
            [case]
                value=Hoplite_Elizabeth
                [message]
                    speaker=unit
                    message=_"Uh... I'm pretty darn wounded. Got to go now, I'll catch up with you later!"
                [/message]
                #curse makes allies take 1 depth longer to respawn
                [if]
                    {VARIABLE_CONDITIONAL unit.status.unhealable equals yes}
                    [then]
                        [message]
                            speaker=unit
                            message=_"Damn it, I'm cursed! I will take longer to recover than usual..."
                        [/message]
                    [/then]
                [/if]
                {MOVE_UNIT type=Hoplite_Elizabeth 6 10}
                [store_unit]
                    [filter]
                        id=Elizabeth
                    [/filter]
                    variable=Elizabeth_stored
                    kill=yes
                [/store_unit]
                {VARIABLE Elizabeth_stored.hitpoints $Elizabeth_stored.max_hitpoints}
                {CLEAR_VARIABLE Elizabeth_stored.status.poisoned}
                {CLEAR_VARIABLE Elizabeth_stored.status.slowed}
                {VARIABLE elizabeth_cooldown 3}
                {IF_VAR companion_recovery_unlocked1 equals yes (
                    [or]
                        {VARIABLE_CONDITIONAL companion_recovery_unlocked2 equals yes}
                    [/or]
                    [then]
                        {VARIABLE elizabeth_cooldown 2}
                    [/then]
                )}
                {IF_VAR companion_recoveryII_unlocked1 equals yes (
                    [or]
                        {VARIABLE_CONDITIONAL companion_recoveryII_unlocked2 equals yes}
                    [/or]
                    [then]
                        {VARIABLE elizabeth_cooldown 1}
                    [/then]
                )}
                #curse makes allies take 1 depth longer to respawn
                {IF_VAR Elizabeth_stored.status.unhealable equals yes (
                    [then]
                        {VARIABLE_OP elizabeth_cooldown add 1}
                    [/then]
                )}
            [/case]
            [case]
                value=Hoplite_Steelclad2
                [message]
                    speaker=unit
                    message=_"I 'ave to go heal my wounds, and catch up with ye later. I ain't gonna be of any use to ya dead."
                [/message]
                #curse makes allies take 1 depth longer to respawn
                [if]
                    {VARIABLE_CONDITIONAL unit.status.unhealable equals yes}
                    [then]
                        [message]
                            speaker=unit
                            message=_"Argh, I'm cursed! Gonna take longer ta recover than usual..."
                        [/message]
                    [/then]
                [/if]
                {MOVE_UNIT type=Hoplite_Steelclad2 6 10}
                [store_unit]
                    [filter]
                        id=Algadur
                    [/filter]
                    variable=Algadur_stored
                    kill=yes
                [/store_unit]
                {VARIABLE Algadur_stored.hitpoints $Algadur_stored.max_hitpoints}
                {CLEAR_VARIABLE Algadur_stored.status.poisoned}
                {CLEAR_VARIABLE Algadur_stored.status.slowed}
                {VARIABLE algadur_cooldown 3}
                {IF_VAR companion_recovery_unlocked1 equals yes (
                    [or]
                        {VARIABLE_CONDITIONAL companion_recovery_unlocked2 equals yes}
                    [/or]
                    [then]
                        {VARIABLE algadur_cooldown 2}
                    [/then]
                )}
                {IF_VAR companion_recoveryII_unlocked1 equals yes (
                    [or]
                        {VARIABLE_CONDITIONAL companion_recoveryII_unlocked2 equals yes}
                    [/or]
                    [then]
                        {VARIABLE algadur_cooldown 1}
                    [/then]
                )}
                #curse makes allies take 1 depth longer to respawn
                {IF_VAR Algadur_stored.status.unhealable equals yes (
                    [then]
                        {VARIABLE_OP algadur_cooldown add 1}
                    [/then]
                )}
            [/case]
        [/switch]
    [/event]
    [event]
        name=die
        id=algadur_axe_line
        first_time_only=yes
        [filter]
            [not]
                ability=hoplite_boss
            [/not]
        [/filter]
        [filter_second]
            side=$hoplite_playerside
        [/filter_second]
        [filter_second_attack]
            name=axe
        [/filter_second_attack]
        [filter_condition]
            [have_unit]
                id=Algadur
            [/have_unit]
        [/filter_condition]
        [message]
            speaker=Algadur
            message=_"I see ye wield an axe too, eh? Good choice!"
        [/message]
        {VARIABLE algadur_line_axe yes}
    [/event]
    [event]
        name=die
        id=algadur_axe_boss_line
        first_time_only=yes
        [filter]
            ability=hoplite_boss
        [/filter]
        [filter_second]
            side=$hoplite_playerside
        [/filter_second]
        [filter_second_attack]
            name=axe
        [/filter_second_attack]
        [filter_condition]
            [have_unit]
                id=Algadur
            [/have_unit]
        [/filter_condition]
        [message]
            speaker=Algadur
            message=_"As ye've just demonstrated, a good axe can fell even the mightiest of foes!"
        [/message]
        {VARIABLE algadur_line_axe_boss yes}
    [/event]
    #for when Algadur kills a tough orc, like a Warlord:
    [event]
        name=die
        id=algadur_lvl3_orc_line
        first_time_only=yes
        [filter]
            level=3
            race=orc
        [/filter]
        [filter_second]
            id=Algadur
        [/filter_second]
        [message]
            speaker=Algadur
            message=_"This is for the brothers you and your kind have slain, you oversized gnat!"
        [/message]
        {VARIABLE algadur_line_lvl3orc yes}
    [/event]
    [event]
        name=spartan_custom_predescent_events
        id=spartan_pre_descent_dialog
        first_time_only=yes
        [filter_condition]
            [have_unit]
                id=Jeremias
                side=$hoplite_enemyside
            [/have_unit]
        [/filter_condition]
        #dialog if jeremias unit survives
        [message]
            speaker=Jeremias
            message=_"That was close! Damn heroes."
        [/message]
        [message]
            speaker=Jeremias
            message=_"And the mess they make. Who's supposed to clean up after them?"
        [/message]
    [/event]
    [event]
        id=spartan_charybdis_death
        name=die
        first_time_only=no
        [filter]
            id=Charybdis
        [/filter]
        [message]
            speaker=Scylla
            message=_"You will pay for killing my favorite pet, human bassstard!" #wmllint: no spellcheck
        [/message]
        #TODO: maybe summon reinforcements here
    [/event]
    #dialog moved from level generation file
    [event]
        id=spartan_portaldialog_return
        first_time_only=no
        {IF_VAR elizabeth_line_return not_equals yes (
            [and]
                [have_unit]
                    id=Elizabeth
                [/have_unit]
            [/and]
            [then]
                [message]
                    speaker=Elizabeth
                    message=_"Fresh air! Freedom, at last! This better not be a dream again... (pinches herself) Yep, this is real. Whew..."
                [/message]
                [delay]
                    time=500
                [/delay]
                [message]
                    speaker=Elizabeth
                    message=_"Now that I'm back, I wonder just how much the world has changed while I was gone, just how many years have passed, and how Master Arcanus is doing without me..."
                [/message]

                {IF_VAR archmage_spared equals yes (
                    [then]
                        #TODO: expand this dialog later
                        [message]
                            id=Hoplite
                            message=_"He was alive and well last time I saw him at least."
                        [/message]
                    [/then]
                    [elseif]
                        {VARIABLE_CONDITIONAL archmage_beaten equals yes}
                        [then]
                            #TODO: maybe improve the dialog later too
                            [message]
                                id=Hoplite
                                message=_"<i>*somberly looks down*</i>"
                            [/message]
                            {IF_VAR algadur_line_archmage equals yes (
                                [then]
                                    [message]
                                        speaker=Algadur
                                        message=_"<i>*somberly looks down*</i>"
                                    [/message]
                                [/then]
                            )}
                            [message]
                                speaker=Elizabeth
                                message=_"What's with your expression all of the sudden?"
                            [/message]
                            [message]
                                id=Hoplite
                                message=_"<i>*sigh*</i> He is... no longer with us."
                            [/message]
                            [message]
                                speaker=Elizabeth
                                message=_"<span size='large'>W-Wait what, he died while I was in the underworld? *sobs* No, it can't be... What a cruel irony, I escape the underworld only to find my mentor dead...</span>"
                            [/message]
                            [message]
                                id=Hoplite
                                message=_"His last wish was for me to guard his most prized spellbooks so they do not fall in Galatea's hands."
                            [/message]
                            [message]
                                speaker=Elizabeth
                                message=_"I see..."
                            [/message]
                        [/then]
                    [/elseif]
                    [else]
                        #in the rare condition (like debug) where elizabeth returns to the underworld while the archmage is neither killed nor spared, say nothing
                    [/else]
                )}

                {VARIABLE elizabeth_line_return yes}
            [/then]
        )}
        {IF_VAR algaur_line_return not_equals yes (
            [and]
                [have_unit]
                    id=Algadur
                [/have_unit]
            [/and]
            [then]
                [message]
                    speaker=Algadur
                    message=_"Whew... back to good ol' caves."
                [/message]
                {VARIABLE algadur_line_return yes}
            [/then]
        )}
    [/event]
#enddef
