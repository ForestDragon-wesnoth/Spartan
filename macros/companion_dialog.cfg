#textdomain wesnoth-Hoplite
{~add-ons/Spartan/macros/utils.cfg}
#define HOPLITE_UNSTORE_COMPANIONS
	{IF_VAR algadur_stored.x greater_than 0 (
	[then]
        [unstore_unit]
            variable=algadur_stored
	    find_vacant=yes
	    x,y=6,10
        [/unstore_unit]
	{CLEAR_VARIABLE algadur_stored}
	[/then]
	)}
	{IF_VAR elizabeth_stored.x greater_than 0 (
	[then]
        [unstore_unit]
            variable=elizabeth_stored
	    find_vacant=yes
	    x,y=6,10
        [/unstore_unit]
	{CLEAR_VARIABLE elizabeth_stored}
	[animate_unit]
		flag=post_teleport
		[filter]
		         id=Elizabeth
		[/filter]
	[/animate_unit]
	[/then]
	)}
#enddef
[event]
    id=hoplite_depthdescent_dialog
    first_time_only=no
       {IF_VAR algadur_line_underworld not_equals yes (
       [and]
       {VARIABLE_CONDITIONAL hoplite_depth less_than 0 }
       [/and]
       [and]
       [have_unit]
           id=Algadur
       [/have_unit]
       [/and]
       [then]
       [message]
           speaker=Algadur
           message=_"By the blazes, my beard be damned! Just where in the bloody hell are we?!"
       [/message]
       [delay]
           time=1000
       [/delay]
       [message]
           speaker=Algadur
           message=_"(shaking) D... did ye hear that?... Aaaa! Ghosts! I be damned! I knew 'tis would go horribly, I knew it!... Looks like we have no bloody choice but ta chop whatever shadow moves until we get some bloody answers! If we die here, we shall at least show 'em all we 'ave!"
       [/message]
       [message]
           id=Hoplite,Hoplite2
           message=_"Very well, time to fight our way out of here!"
       [/message]
       {VARIABLE algadur_line_underworld yes}
       [/then])}

    [if]
    {VARIABLE_CONDITIONAL archmagemet not_equals yes}
	[and]
	[have_unit]
	  id=Archmage
	  [not]
	  [filter_wml]
	     variation=shaxtal
	  [/filter_wml]
	  [/not]
	[/have_unit]
	[/and]
	[then]
	{REPLACE_SCENARIO_MUSIC silence.ogg}
	[message]
	   speaker=Archmage
	   message=_"So the Chaos Empire finally found my hiding place... (looks at the hoplite) I know what you are, abomination! I won't let you lay a finger on my precious books, you Uria-worshipping scum!"
	[/message]
	[message]
	   id=Hoplite,Hoplite2
	   message=_"I know not what is this Chaos Empire you speak of, nor am I part of it."
	[/message]
	[message]
	   speaker=Archmage
	   message=_"Lies! You expect me to believe that a single soldier could possibly have fought his way here through the dozens of orcs, undead and other minions of the empire? You are clearly a disguised assassin sent by them to kill me and destroy the books!"
	[/message]

        [if]
        [have_unit]
            id=Elizabeth
        [/have_unit]
        [then]
        #rare dialog if you somehow get elizabeth before encountering archmage, like when using debug
        [message]
            speaker=Elizabeth
            message=_"Master, calm down!"
        [/message]
	    [message]
	       speaker=Archmage
	       message=_"E-Elizabeth?! Where have you been for so long?"
	    [/message]
        [message]
            speaker=Elizabeth
            message=_"I was stuck in the underworld, entered a portal I shouldn't have. But it's thanks to this man that I managed to escape it. I fought side by side with him, and I assure you, he can be trusted."
        [/message]
	    [message]
	       speaker=Archmage
	       message=_"Very well."
	    [/message]
        {SPARTAN_BOSSMUSICEND}
	    #archmage becomes peaceful:
	    [modify_unit]
	    	[filter]
	    		side=$hoplite_enemyside
	    	[/filter]
	    	side=$hoplite_allyside
	    [/modify_unit]
        {VARIABLE archmage_beaten yes}
        [remove_item]
            image="scenery/trapdoor-closed.png"
            x,y=6,2
        [/remove_item]
        [item]
            image="scenery/trapdoor-open.png"
            x,y=6,2
        [/item]

        {CLEAR_VARIABLE bossfight}

	    {VARIABLE archmage_beaten yes}
    	{VARIABLE elizabeth_line_archmage yes}#for filtering later
	    [/then]
	    [else]

        [message]
            id=Hoplite,Hoplite2
            message=_"I'd rather not spill more blood than necessary, but if it is a fight you want, it's a fight you will get!"
        [/message]

        {IF_VAR algadur_line_archmage not_equals yes (
        [and]
        [have_unit]
            id=Algadur
        [/have_unit]
        [/and]
        [then]
        [message]
            speaker=Algadur
            message=_"If ye wanna kill him, you'll have ta face me too!"
        [/message]
	{VARIABLE algadur_line_archmage yes}
	[/then])}
        {REPLACE_SCENARIO_MUSIC burning.ogg}
#ifndef SPARTAN_MUSIC_FOUND
        {REPLACE_SCENARIO_MUSIC battle-epic.ogg}
#endif
    [/else]
    [/if]
	{VARIABLE archmagemet yes}
	[/then]
    [/if]
    [if]
    {VARIABLE_CONDITIONAL archmagemet2 not_equals yes}
	[and]
	[have_unit]
	  id=Archmage
	  [filter_wml]
	     variation=shaxtal
	  [/filter_wml]
	[/have_unit]
	[/and]
	[then]
        {HOPLITE_UNSTORE_COMPANIONS}
        {REPLACE_SCENARIO_MUSIC overlive.ogg}
#ifndef SPARTAN_MUSIC_FOUND
        {REPLACE_SCENARIO_MUSIC frantic.ogg}
#endif
        [if]
        [have_unit]
            id=Elizabeth
        [/have_unit]
        [then]
        [message]
            speaker=Elizabeth
            message=_"Master? Is that you? Do... do you remember me?"
        [/message]
	{SCROLL_TO 6 4}
        [delay]
	   time=1000
	[/delay]
	[message]
	   speaker=Archmage
	   message=_"(in a metallic female voice) You being so eager to call <b>me</b> master is appreciated, dear, but if you were referring to this old man, then I would like to inform you that he is no more. His husk is now merely another disposable drone for the empire."
	[/message]
        [message]
            speaker=Algadur
            message=_"My beard be damned! Look at this thing's bloody face!"
        [/message]
        [message]
            speaker=Elizabeth
            message=_"Wh... just what the hell are you?!"
        [/message]
	[message]
	   speaker=Archmage
	   message=_"Have you been living under a rock, Elizabeth? Never seen a shaxtal in your entire life?"
	[/message]
        [message]
            speaker=Elizabeth
            message=_"How... how do you know my name?"
        [/message]
	[message]
	   speaker=Archmage
	   message=_"Ah, it just so happens that I may have had the pleasure of knowing you in a past life of sorts. Unlike you, however, I'm now near the top of the current hierarchy, while you still remain near the very bottom like the failure that you are."
	[/message]
        [message]
            speaker=Elizabeth
            message=_"Wha... I..."
        [/message]
	[message]
	   speaker=Archmage
	   message=_"More importantly, you have been sentenced to death for interfering with the empire's geopolitical expansion. If you surrender, we promise to make your death quick and painless. If you won't, then I can assure you that I will truly make you regret make such a foolish choice."
	[/message]
	[if]
	[have_unit]
	   id=Algadur
	[/have_unit]
	[then]
        [message]
            speaker=Algadur
            message=_"Surrender ta you?! Blazes no! I'd shave my beard before I become braindead enough ta accept that! Prepare ta taste my axe, abomination!"
        [/message]
	[/then]
	[else]
        [message]
            speaker=Elizabeth
            message=_"Surrender to you?! Hell no! I'd rather die than lick your imperial boots!"
        [/message]
	[/else]
	[/if]
	[delay]
	    time=500
	[/delay]
	[message]
	   speaker=Archmage
	   message=_"Enemies of Uria truly do never learn... very well, if you want to lay your worthless lives for your worthless cause, then so be it! My warm blood bath is already prepared, so I'll leave killing you to this mindless drone."
	[/message]
	[delay]
	   time=500
	[/delay]
	[message]
	   speaker=Archmage
	   message=_"(switches to a male metallic voice) Initiating protocol 21B. Weapon systems online. Report to Uria's Fire after completion of the objective."
	[/message]
	{VARIABLE elizabeth_line_archmage2 yes}
	[/then]
	[else]
	[message]
	   speaker=Archmage
	   message=_"(in a female metallic voice) Were you expecting to encounter this old man here? Well, he is no more. His husk is now merely another disposable drone for the empire..."
	[/message]
        [message]
            speaker=Algadur
            message=_"My beard be damned! Look at this thing's bloody face!"
        [/message]
	[message]
	   speaker=Archmage
	   message=_"...and more importantly, you have been sentenced to death for interfering with the empire's geopolitical expansion. If you surrender, we promise to make your death quick and painless. If you won't, then I can assure you that I will truly make you regret make such a foolish choice."
	[/message]
        [message]
            speaker=Algadur
            message=_"Surrender ta you?! Blazes no! I'd shave my beard before I become braindead enough ta accept that! Prepare ta taste my axe, abomination!"
        [/message]
	[delay]
	    time=500
	[/delay]
	[message]
	   speaker=Archmage
	   message=_"The heretics truly do never learn... very well, if you want to lay your worthless lives for your 'cause', then so be it! My warm blood bath is already prepared, so I'll leave killing you to this mindless drone."
	[/message]
	[message]
	   speaker=Archmage
	   message=_"(switches to a male metallic voice) Initiating protocol 21B. Weapon systems online. Report to Uria's Fire after completion of the objective."
	[/message]
	[/else]
    [/if]
	[if]
	[have_unit]
	   id=Algadur,Elizabeth
	[/have_unit]
	[else]
	[message]
	   speaker=Archmage
	   message=_"(in a female metallic voice) Were you expecting to encounter this old man here? Well, he is no more. His husk is now merely another disposable drone for the empire."
	[/message]
	[message]
	   speaker=Archmage
	   message=_"More importantly, however, you have been sentenced to death for interfering with the empire's geopolitical expansion. If you surrender, we promise to make your death quick and painless. If you won't, then I can assure you that I will truly make you regret make such a foolish choice."
	[/message]
	[delay]
	    time=500
	[/delay]
	[message]
	   speaker=Archmage
	   message=_"You refuse? The heretics truly do never learn... very well, if you want to lay your worthless life for your worthless cause, then so be it! My warm blood bath is already prepared, so I'll leave killing you to this mindless drone."
	[/message]
	[message]
	   speaker=Archmage
	   message=_"(switches to a male metallic voice) Initiating protocol 21B. Weapon systems online. Report to Uria's Fire after completion of the objective."
	[/message]
	[/else]
	[/if]
        {REPLACE_SCENARIO_MUSIC gathering_storm.ogg}
#ifndef SPARTAN_MUSIC_FOUND
        {REPLACE_SCENARIO_MUSIC battle-epic.ogg}
#endif
	{VARIABLE archmagemet2 yes}
	[/then]
    [/if]
	{IF_VAR reaper_beaten not_equals yes (
	[and]
	{VARIABLE_CONDITIONAL hoplite_depth equals -10}
	[/and]
	[then]
        {HOPLITE_UNSTORE_COMPANIONS}
        [delay]
	   time=500
	[/delay]
	{UNIT $hoplite_enemyside (Hoplite_Grimreaper) 6 4 (
        id=Reaper
	name=_"Grim Reaper"
	facing=s
	animate=yes
	{IS_HERO}
        )}
        [if]
        [have_unit]
          id=Hoplite2
        [/have_unit]
        [then]
            [object]
		silent=yes
		duration=forever
		[filter]
		  id=Reaper
		[/filter]
		[effect]
		  apply_to=hitpoints
		  increase=50%
		  increase_total=50%
	        [/effect]
		[effect]
		  apply_to=attack
		  range=melee
		  increase_damage=2
	        [/effect]
            [/object]
	[/then]
	[/if]
	{REPLACE_SCENARIO_MUSIC silence.ogg}
	[if]
	[have_unit]
	   id=Algadur
	[/have_unit]
	[then]
	[message]
	   speaker=Reaper
	   message=_"Who do we have here? A hoplite, a dwarf and a red mage, three mortals foolish enough to enter the land of the dead. If you so truly desire to quicken your demise, then I shall gladly arrange that. Your souls will make a fine addition to my collection!"
	[/message]
	[/then]
	[else]
	[message]
	   speaker=Reaper
	   message=_"Who do we have here? A hoplite, and a red mage, two mortals foolish enough to enter the land of the dead. If you so truly desire to quicken your demise, then I shall gladly arrange that. Your souls will make a fine addition to my collection!"
	[/message]
	[/else]
	[/if]
        {REPLACE_SCENARIO_MUSIC moleman.ogg}
#ifndef SPARTAN_MUSIC_FOUND
        {REPLACE_SCENARIO_MUSIC battle-epic.ogg}
#endif
	[/then])}
	{IF_VAR hoplite_depth equals 40 (
	[then]
        {REPLACE_SCENARIO_MUSIC into_the_shadows.ogg}
        {HOPLITE_UNSTORE_COMPANIONS}
	{MOVE_UNIT id=Hoplite,Hoplite2 6 5}
	{MOVE_UNIT ability=hoplite_companion 6 5}
	[if]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[and]
	[have_unit]
	  id=Elizabeth
	[/have_unit]
	[/and]
	[then]
	[message]
	          speaker=Algadur
		  message=_"By the gods' beards! Is 'tis what I think it is? So we 'ave found the Ruby of Fire?"
        [/message]
	[message]
	          speaker=Elizabeth
		  message=_"Not quite. It is the Prometheus' Heart, a gem similar to the Ruby of Fire in nature. Its power doesn't quite hold up to that of its more famous counterpart, but it is still rather impressive."
        [/message]
	[/then]
	[elseif]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[and]
	[not]
	[have_unit]
	  id=Elizabeth
	[/have_unit]
	[/not]
	[/and]
	[then]
	[message]
	          speaker=Algadur
		  message=_"By the gods' beards! Is 'tis what I think it is? So we 'ave found the Ruby of Fire?"
        [/message]
	[/then]
	[/elseif]
	[elseif]
	[have_unit]
	  id=Elizabeth
	[/have_unit]
	[and]
	[not]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[/not]
	[/and]
	[then]
	[message]
	          speaker=Elizabeth
		  message=_"My goodness, it's the Prometheus' Heart, a not unlike the Ruby of Fire! Its power doesn't quite hold up to that of its more famous counterpart, but it is still rather impressive."
        [/message]
	[/then]
	[/elseif]
	[/if]
	[remove_item]
	  x,y=6,4
	[/remove_item]
	[item]
	  x,y=6,4
	  image="items/brazier.png"
	[/item]
        [sound]
          name=fanfare-short.wav
        [/sound]
	{IF_VAR hoplite_maxenergy greater_than 0 (
	[then]
        {VARIABLE_OP hoplite_energy add 50}
        {VARIABLE_OP hoplite_maxenergy add 50}
	{SET_LABEL 10 1 "Energy: $hoplite_energy|/$hoplite_maxenergy|"}
	[/then])}
	{IF_VAR hoplite_maxenergy1 greater_than 0 (
	[then]
        {VARIABLE_OP hoplite_energy1 add 50}
        {VARIABLE_OP hoplite_maxenergy1 add 50}
	{SET_LABEL 9 1 "Side 1 Energy: $hoplite_energy1|/$hoplite_maxenergy1|"}
        {VARIABLE_OP hoplite_energy2 add 50}
        {VARIABLE_OP hoplite_maxenergy2 add 50}
	{SET_LABEL 10 1 "Side 2 Energy: $hoplite_energy2|/$hoplite_maxenergy2|"}
	[/then])}
        [object]
          name="Prometheus' Heart"
          image="items/prometheus-fire1.png"
          duration=forever
          description=_"A gem containing untold power, but of which you can only harness a small portion. +50 maximum energy for the rest of the playthrough."
          [filter]
             id=Hoplite
          [/filter]
        [/object]
	[if]
	[have_unit]
	   id=Algadur
	[/have_unit]
	[then]
	[message]
	          speaker=Algadur
		  message=_"Now that we got 'tis beauty, we must hurry up an' leave the leave before any of the demon-worshipers catch up ta us!"
        [/message]
	[message]
	          speaker=Elizabeth
		  message=_"Indeed, we can't waste a minute. However, going down into the dungeon could also be also a promising option. After all, the surface is probably overrun by the Chaos Empire. (to the hoplite) What do you think?"
        [/message]
	[/then]
	[else]
	[message]
	          speaker=Elizabeth
		  message=_"Now that we got this gem, we must hurry up and leave the leave before any of Uria's worshipers catch up to us, we can't waste a minute. However, going down into the dungeon could also be also a promising option. After all, the surface is probably overrun by the Chaos Empire. What do you think?"
        [/message]
	[/else]
	[/if]
        {REPLACE_SCENARIO_MUSIC kreepor.ogg}
#ifndef SPARTAN_MUSIC_FOUND
        {REPLACE_SCENARIO_MUSIC underground.ogg}
#endif
        {MOVE_UNIT id=Hoplite,Hoplite2 6 2}
#dialog: choose, oh hoplite, do you leave the dungeon to keep the mighty gem you have acquired, or descend even deeper into this endless abyss?	 
	[/then])}
	{IF_VAR algadurlinesmith not_equals yes (
	[and]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[/and]
	[and]
	[have_unit]
	  id=runesmith
	[/have_unit]
	[/and]
	[then]
	{VARIABLE algadurlinesmith yes}
	[message]
	          speaker=Algadur
		  message=_"One of our runesmiths is bein' attacked! Quick, we must help 'im!"
        [/message]
	[/then])}
	{IF_VAR algadurlinestart not_equals yes (
	[and]
	[have_unit]
	  id=Algadur
	[/have_unit]
	[/and]
	[then]
	[message]
	          speaker=Algadur
		  message=_"Bring it on, ya surface-dwellin' pigs! If I'm goin' down, then I ain't goin' down without a fight!"
        [/message]
	{VARIABLE algadurlinestart yes}
	[/then])}
	{IF_VAR elizabethmet not_equals yes (
	[and]
	[have_unit]
	  id=Elizabeth
	[/have_unit]
	[/and]
	[then]
	    {SCROLL_TO 6 5}
            {REPLACE_SCENARIO_MUSIC silence.ogg}
	    [delay]
	      time=500
	    [/delay]
	    {MOVE_UNIT id=Hoplite,Hoplite2 6 5}
	    [message]
	       speaker=Elizabeth
	       image="portraits/humans/mage-red+female.png~BLEND(0,0,0,0.95)"
	       message=_"So you have finally arrived. I hope the message glyphs I scattered nearby were of help to you. You may be wondering who I may be, so let me get that out of the way..."
	    [/message]
            [remove_object]
		[filter]
		  id=Elizabeth
		[/filter]
		object_id=conceal
            [/remove_object]
	    [modify_unit]
	    [filter]
	       id=Elizabeth
	    [/filter]
	    name=_"Elizabeth"
	    [/modify_unit]
	    [if]
	    [have_unit]
	       id=Algadur
	    [/have_unit]
	    [then]
	    [message]
	       speaker=Elizabeth
	       message=_"*ahem* I am Elizabeth, red mage of the formerly existing Alduin academy..."
	    [/message]
	    [message]
	       speaker=Algadur
	       message=_"Alduin academy? Ya mean the one that the demon-worshippers razed ta the ground?"
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"Yes, *sigh* that one. And who may you be, dwarf?"
	    [/message]
	    [message]
	       speaker=Algadur
	       message=_"Name's Algadur, been a soldier for some time, our outpost got attacked, and then I got my sorry arse saved by 'tis lad. A 'hoplite' as they call 'im. I wonder, how did ya even get stuck in 'tis hellhole."
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"Long story short, I got teleported here by a demonic portal that I've been researching. *sigh* There is nothing I desire more than getting out of this nightmare."
	    [/message]
	    [message]
	       speaker=Algadur
	       message=_"And why did ya lead us here with yer 'glyphs'?"
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"Ahem, how do I put it, there is one of the reapers' chambers ahead, with a portal back to the mortal world. I, obvious enough, am in no way skilled enough to tackle such a being alone. And that's where you two come in."
	    [/message]
	    [message]
	       speaker=Algadur
	       message=_"So ye're makin' us ye cannon fodder? Who do ya think ye are, lass?!"
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"I fully understand that isn't exactly the best-sounding idea, but what choice do we have? We could sit here for eternity and slowly go insane, <b>or</b> we could gamble our souls for a chance to leave this place. The latter option isn't exactly that great, but seems to me like the lesser of two evils."
	    [/message]
	    [message]
	       speaker=Algadur
	       message=_"I guess ye're givin' us no choice, lass... Very well, let's do 'tis."
	    [/message]
	    [/then]
	    [else]
	    [message]
	       speaker=Elizabeth
	       message=_"*ahem* I am Elizabeth, red mage of the formerly existing Alduin academy. You may be wondering how I got here. Long story short, I got teleported here by a demonic portal that I've been researching. *sigh* There is nothing I desire more than getting out of this nightmare."
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"You may be wondering why I've guided you here. Well, how do I put it, there is one of the reapers' chambers ahead, with a portal back to the mortal world. I, obvious enough, am in no way skilled enough to tackle such a being alone. And that's where you come in."
	    [/message]
	    [message]
	       speaker=Elizabeth
	       message=_"Yes, I fully understand that isn't exactly the best-sounding idea, but what choice do we have? We could sit here for eternity and slowly go insane, <b>or</b> we could gamble our souls for a chance to leave this place. The latter option isn't exactly that great, but seems to me like the lesser of two evils."
	    [/message]
	    [/else]
	    [/if]
#  	    {UNIT $hoplite_allyside (Hoplite_Fireguardian) 5 5 (
#	    placement=map
#     	    passable=yes
#            )}
#  	    {UNIT $hoplite_allyside (Hoplite_Fireguardian) 7 5 (
#	    placement=map
#     	    passable=yes
#            )}
            {ACHIEVEMENT_MESSAGE _"The Mage: recruit Elizabeth." elizabeth}
            {REPLACE_SCENARIO_MUSIC ooze.ogg}
#ifndef SPARTAN_MUSIC_FOUND
            {REPLACE_SCENARIO_MUSIC the_deep_path.ogg}
#endif
	    {VARIABLE elizabethmet yes}
	[/then])}
	{IF_VAR elizabeth_cooldown less_than 1 (
	[and]
	{VARIABLE_CONDITIONAL elizabeth_stored.x greater_than 0}
	[/and]
	[and]
	{VARIABLE_CONDITIONAL hoplite_depth greater_than 0}
	[or]
	{VARIABLE_CONDITIONAL elizabethstays not_equals yes}
	[/or]
	[/and]
	[then]
        [unstore_unit]
            variable=elizabeth_stored
	    find_vacant=yes
	    x,y=6,10
        [/unstore_unit]
	{CLEAR_VARIABLE elizabeth_stored}
	[animate_unit]
		flag=post_teleport
		[filter]
		         id=Elizabeth
		[/filter]
	[/animate_unit]
	{IF_VAR elizabethstays equals yes (
	[then]
	[message]
	        speaker=Elizabeth
	        message=_"Hey, you're back! How's your trip to the underworld been? Fine, you say? Good to hear that."
	[/message]
	{CLEAR_VARIABLE elizabethstays}
	[/then]
	[else]
	{RANDOM 1..3}
	{IF_VAR random equals 1 (
	[then]
	[message]
	        speaker=Elizabeth
	        message=_"Hey, I'm back! Hope I didn't miss anything important..."
	[/message]
	[/then])}
	{IF_VAR random equals 2 (
	[then]
	[message]
	        speaker=Elizabeth
	        message=_"Whew, I'm back! Did I miss much of the fun? No? Good to know."
	[/message]
	[/then])}
	{IF_VAR random equals 3 (
	[then]
	[message]
	        speaker=Elizabeth
	        message=_"Man, that was quite the rest! Too bad I now have to fight again..."
	[/message]
	[/then])}
	[/else])}
	{CLEAR_VARIABLE elizabeth_stored}
	[/then])}
	{IF_VAR algadur_cooldown less_than 1 (
	[and]
	{VARIABLE_CONDITIONAL algadur_stored.x greater_than 0}
	[/and]
	[and]
	{VARIABLE_CONDITIONAL hoplite_depth greater_than 0}
	[or]
	{VARIABLE_CONDITIONAL algadurstays not_equals yes}
	[/or]
	[/and]
	[then]
        [unstore_unit]
            variable=algadur_stored
	    find_vacant=yes
	    x,y=6,10
        [/unstore_unit]
	{CLEAR_VARIABLE algadur_stored}
	{IF_VAR algadurstays equals yes (
	[then]
	[message]
	        speaker=Algadur
	        message=_"Ye're back! Glad ta see ya in one piece, lad."
	[/message]
	{CLEAR_VARIABLE algadurstays}
	[/then]
	[else]
	{RANDOM 1..3}
	{IF_VAR random equals 1 (
	[then]
	[message]
	        speaker=Algadur
	        message=_"I'm back, sorry for keepin' ya waiting'."
	[/message]
	[/then])}
	{IF_VAR random equals 2 (
	[then]
	[message]
	        speaker=Algadur
	        message=_"I'm back and ready ta fight! Now, whose head will we chop off 'tis time?"
	[/message]
	[/then])}
	{IF_VAR random equals 3 (
	[then]
	[message]
	        speaker=Elizabeth
	        message=_"I'm back. How am I, ye ask? Don't worry, lad, 'tis just a flesh wound."
	[/message]
	[/then])}
	[/else])}
	{CLEAR_VARIABLE algadur_stored}
	[/then])}
	{IF_VAR chaos_line1 not_equals yes (
	[and]
	[have_unit]
	  side=$hoplite_enemyside
	  type=Hoplite_Chaosinvader
	[/have_unit]
	[/and]
	[and]
	{VARIABLE_CONDITIONAL bossfight not_equals yes}
	[/and]
	[and]
	[not]
	[have_unit]
	    id=Donovan
	[/have_unit]
	[/not]
	[/and]
	[then]
	[if]
	[have_unit]
	    side=$hoplite_allyside
	    ability=hoplite_companion
	[/have_unit]
	[or]
	[have_unit]
	    id=Hoplite2
	[/have_unit]
	[/or]
	[then]
	[message]
	        type=Hoplite_Chaosinvader
	        message=_"Look, brothers! It is the very heretics Brother Donovan warned us about! Let us show these heathen wretches the might of Uria! Chaaaarge!"
	[/message]
	[/then]
	[else]
	[message]
	        type=Hoplite_Chaosinvader
	        message=_"Look, brothers! It is the very heretic Brother Donovan warned us about! Let us show this heathen wretch the might of Uria! Chaaaarge!"
	[/message]
	[/else]
	[/if]
	[message]
	        speaker=Algadur
	        message=_"These demon-worshipin' lunatics are 'ere too?! Bloody hell, they must've overrun half the caves already!"
	[/message]
	{VARIABLE chaos_line1 yes}
	[/then])}
        {IF_VAR donovanmet not_equals yes (
	[and]
	[have_unit]
	  id=Donovan
	  side=$hoplite_enemyside
	[/have_unit]
	[/and]
	[then]
	{REPLACE_SCENARIO_MUSIC silence.ogg}
	[hide_unit]
	    side=$hoplite_allyside
	[/hide_unit]
	{MOVE_UNIT id=Hoplite,Hoplite2 6 7}
	[message]
	        speaker=Donovan
	        message=_"Halt in the name of Uria, soldier! The armor you're wearing is not of the standard approved by the imperial armory. Explain yourself!"
	[/message]
	[message]
	        id=Hoplite,Hoplite2
	        message=_"I am not from this empire you speak of. I am a hoplite from Sparta."
	[/message]
	[message]
	        speaker=Donovan
	        message=_"Oh, so are not part of the imperial army, right... Well, we are quite eager to hire some mercenaries, to replace the regiments lost due to our recent conquest. Capable warriors like you are in high demand but short supply, after all. Here's the offer: pledge your allegiance to our glorious empire, and you shall receive the honor of serving our goddess Uria as a fellow knight of chaos, and a payment of 55 Urvathan silver a month."
	[/message]
	[message]
	        id=Hoplite,Hoplite2
	        message=_"My allegiance is to Sparta, and Sparta only. Nor do I worship gods outside our pantheon. Now stand aside, knight, I am on a very important quest."
	[/message]
	[message]
	        speaker=Donovan
	        message=_"You... you dare to reject my generosity, you ungrateful heathen wretch?! Are you truly so blind as to not see that Uria is the one and only true god?! Hrmph... very well, if you refuse to serve her in life, then you shall have to serve her in death! En garde, heretic! May Uria have mercy on your soul, for I will not!"
	[/message]
        {REPLACE_SCENARIO_MUSIC march-of-the-droids.ogg}
#ifndef SPARTAN_MUSIC_FOUND
        {REPLACE_SCENARIO_MUSIC battle-epic.ogg}
#endif
	[unhide_unit]
	    side=$hoplite_allyside
	[/unhide_unit]
        {HOPLITE_UNSTORE_COMPANIONS}
	[/then]
	)}
[/event]
